# ğŸ”§ è¨­å‚™æƒæä¿®å¾©æŒ‡å—

## ğŸš¨ å•é¡Œåˆ†æ

### ç”¨æˆ¶å ±å‘Šçš„å•é¡Œ
ç”¨æˆ¶åæ˜ ï¼š"åœ¨è¨­å‚™ç®¡ç†ä¸­ï¼Œæˆ‘é»æ“Šé–‹å§‹æƒæå’Œæƒæè¨­å‚™éƒ½æ²’æœ‰åæ‡‰ã€‚"

### æ ¹æœ¬åŸå› 
ç¶“éè¨ºæ–·ï¼Œç™¼ç¾äº†ä»¥ä¸‹å•é¡Œï¼š

1. **éŒ¯èª¤çš„APIç«¯é»**ï¼šWiFiScannerä¸­ä½¿ç”¨äº†`/health`ç«¯é»ï¼Œä½†VRæœå‹™å™¨çš„æ­£ç¢ºç«¯é»æ˜¯`/api/health`
2. **è¨­å‚™æœå‹™ç¼ºå¤±**ï¼š`device-connection.tsx`ä¸­èª¿ç”¨äº†`deviceService.scanForDevices()`ï¼Œä½†è©²æ–¹æ³•åœ¨`device-manager.ts`ä¸­ä¸å­˜åœ¨
3. **ç«¯å£æ–‡æª”éŒ¯èª¤**ï¼šå¤šè™•æ–‡æª”ä»ç„¶é¡¯ç¤ºç«¯å£5000ï¼Œå¯¦éš›ä½¿ç”¨çš„æ˜¯ç«¯å£5001
4. **å°å‡ºå•é¡Œ**ï¼š`deviceService`æ²’æœ‰æ­£ç¢ºå¾`device-manager.ts`å°å‡º

## âœ… ä¿®å¾©æªæ–½

### 1. **ä¿®å¾©WiFiScanner APIç«¯é»**
```typescript
// ä¿®å¾©å‰ (éŒ¯èª¤)
const response = await fetch(`http://${ip}:${port}/health`, {

// ä¿®å¾©å¾Œ (æ­£ç¢º)
const response = await fetch(`http://${ip}:${port}/api/health`, {
```

### 2. **æ·»åŠ deviceServiceæ–¹æ³•**
åœ¨`lib/device-manager.ts`ä¸­æ·»åŠ äº†ä»¥ä¸‹æ–¹æ³•ï¼š
```typescript
// æƒæè¨­å‚™çš„åˆ¥åæ–¹æ³•ï¼ˆå…¼å®¹èˆŠä»£ç¢¼ï¼‰
async scanForDevices(): Promise<NetworkDevice[]> {
  // å¯¦ç¾çœŸå¯¦çš„è¨­å‚™æƒæé‚è¼¯
  // åŒ…å«VRæœå‹™å™¨ç™¼ç¾å’Œæ¨¡æ“¬è¨­å‚™
}

// é€£æ¥åˆ°è¨­å‚™çš„åˆ¥åæ–¹æ³•
async connectToDevice(ipAddress: string, authCode?: string): Promise<DeviceInfo> {
  // å¯¦ç¾è¨­å‚™é€£æ¥é‚è¼¯
}

// ç§»é™¤è¨­å‚™çš„åˆ¥åæ–¹æ³•
async removeDevice(deviceId: string): Promise<void> {
  // å¯¦ç¾è¨­å‚™ç§»é™¤é‚è¼¯
}
```

### 3. **æ·»åŠ æ­£ç¢ºçš„å°å‡º**
```typescript
export const deviceManager = new DeviceManager()
export const deviceService = deviceManager // ç‚ºäº†å…¼å®¹æ€§ï¼Œå°å‡ºåˆ¥å
export default deviceManager
export type { Device, DeviceScanResult, NetworkDevice, DeviceInfo }
```

### 4. **ä¿®å¾©ç«¯å£æ–‡æª”**
ä¿®å¾©äº†ä»¥ä¸‹ä½ç½®çš„ç«¯å£è™Ÿï¼š
- `components/wifi-scanner.tsx`: é˜²ç«ç‰†ç«¯å£æç¤º
- `components/device-management-modal.tsx`: å…©è™•ç«¯å£5000éŒ¯èª¤æç¤º

### 5. **æ·»åŠ é¡å‹å®šç¾©**
æ·»åŠ äº†ç¼ºå¤±çš„æ¥å£å®šç¾©ï¼š
```typescript
interface NetworkDevice {
  id: string
  deviceName: string
  deviceType: string
  ipAddress: string
  manufacturer: string
  isVRDevice: boolean
  rssi: number
  lastSeen: string
}

interface DeviceInfo {
  id: string
  name: string
  type: "standalone_vr" | "mobile_vr" | "desktop"
  brand: string
  model: string
  ipAddress: string
  macAddress: string
  status: "online" | "offline" | "connecting" | "error"
  firmwareVersion: string
  connectionType: "wifi" | "bluetooth" | "usb"
  capabilities: string[]
  currentTime: number
  lastSeen: string
  isAuthenticated: boolean
  authCode: string
  batteryLevel?: number
}
```

## ğŸ§ª æ¸¬è©¦æ–¹æ³•

### 1. **ç¢ºèªå¾Œç«¯æœå‹™é‹è¡Œ**
```bash
# æª¢æŸ¥VRæœå‹™å™¨æ˜¯å¦é‹è¡Œ
curl http://localhost:5001/api/health

# é æœŸè¼¸å‡º
{"status":"ok","timestamp":...,"server":"VRä¸€é«”åŒ–æœå‹™å™¨",...}
```

### 2. **æ¸¬è©¦è¨­å‚™ç™¼ç¾API**
```bash
# æ¸¬è©¦è¨­å‚™ç™¼ç¾ç«¯é»
curl http://localhost:5001/api/discover

# é æœŸè¼¸å‡º
{"deviceName":"VR Sync Server","deviceType":"server",...}
```

### 3. **å‰ç«¯è¨­å‚™æƒææ¸¬è©¦**
1. è¨ªå• http://localhost:3000
2. é»æ“Š"è¨ªå®¢æ¨¡å¼"ç™»éŒ„
3. å‰å¾€"è¨­å‚™ç®¡ç†"æ¨™ç±¤
4. é»æ“Š"æ·»åŠ è¨­å‚™"æŒ‰éˆ•
5. åœ¨å½ˆå‡ºçš„æ¨¡æ…‹æ¡†ä¸­é¸æ“‡"Wi-Fiæƒæ"æ¨™ç±¤
6. é»æ“Š"ğŸ” é–‹å§‹Wi-Fiæƒæ"æŒ‰éˆ•

### 4. **é æœŸçµæœ**
- æƒæé€²åº¦æ¢é–‹å§‹é¡¯ç¤º
- æ§åˆ¶å°é¡¯ç¤ºæƒææ—¥èªŒï¼š
  ```
  é–‹å§‹Wi-Fiç¶²çµ¡æƒæ...
  æº–å‚™æƒæ X å€‹IPåœ°å€
  æ­£åœ¨æƒæ localhost:5001...
  âœ… ç™¼ç¾è¨­å‚™: localhost - VR Sync Server
  æƒæå®Œæˆï¼Œç™¼ç¾ 1 å€‹è¨­å‚™
  ```
- ç•Œé¢é¡¯ç¤ºç™¼ç¾çš„VR Sync Serverè¨­å‚™
- å¯ä»¥é»æ“Š"é€£æ¥"æŒ‰éˆ•é€²è¡Œé€£æ¥

## ğŸ“Š ä¿®å¾©æ•ˆæœå°æ¯”

| å•é¡Œé …ç›® | ä¿®å¾©å‰ | ä¿®å¾©å¾Œ |
|----------|--------|--------|
| APIç«¯é» | âŒ `/health` (404éŒ¯èª¤) | âœ… `/api/health` (æ­£å¸¸) |
| deviceServiceæ–¹æ³• | âŒ ä¸å­˜åœ¨ | âœ… å®Œæ•´å¯¦ç¾ |
| ç«¯å£æ–‡æª” | âŒ 5000 (éŒ¯èª¤) | âœ… 5001 (æ­£ç¢º) |
| é¡å‹å®šç¾© | âŒ ç¼ºå¤± | âœ… å®Œæ•´å®šç¾© |
| æƒæåŠŸèƒ½ | âŒ æ²’æœ‰åæ‡‰ | âœ… æ­£å¸¸å·¥ä½œ |
| è¨­å‚™ç™¼ç¾ | âŒ æ‰¾ä¸åˆ°è¨­å‚™ | âœ… ç™¼ç¾VRæœå‹™å™¨ |

## ğŸ” æ•…éšœæ’é™¤

### å¦‚æœæƒæä»ç„¶æ²’æœ‰åæ‡‰ï¼š

1. **æª¢æŸ¥æ§åˆ¶å°éŒ¯èª¤**
   - æ‰“é–‹ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·
   - æŸ¥çœ‹Consoleæ¨™ç±¤ä¸­çš„éŒ¯èª¤ä¿¡æ¯
   - æŸ¥çœ‹Networkæ¨™ç±¤ä¸­çš„APIè«‹æ±‚

2. **ç¢ºèªå¾Œç«¯æœå‹™**
   ```bash
   # æª¢æŸ¥é€²ç¨‹æ˜¯å¦é‹è¡Œ
   ps aux | grep "node.*vr-server"
   
   # æª¢æŸ¥ç«¯å£æ˜¯å¦å ç”¨
   lsof -i :5001
   ```

3. **é‡å•Ÿç³»çµ±**
   ```bash
   # åœæ­¢ç¾æœ‰æœå‹™
   pkill -f "node.*vr-server"
   
   # é‡æ–°å•Ÿå‹•
   npm run vr
   ```

4. **æª¢æŸ¥ç¶²çµ¡**
   - ç¢ºèªé˜²ç«ç‰†å…è¨±ç«¯å£5001
   - ç¢ºèªè¨­å‚™åœ¨åŒä¸€Wi-Fiç¶²çµ¡
   - å˜—è©¦ç›´æ¥è¨ªå• http://localhost:5001/api/health

### å¸¸è¦‹éŒ¯èª¤åŠè§£æ±ºæ–¹æ¡ˆï¼š

1. **CORSéŒ¯èª¤**
   - å¾Œç«¯å·²é…ç½®CORSå…è¨±æ‰€æœ‰ä¾†æº
   - å¦‚æœä»æœ‰å•é¡Œï¼Œé‡å•Ÿå¾Œç«¯æœå‹™

2. **ç¶²çµ¡è¶…æ™‚**
   - æª¢æŸ¥è¨­å‚™ç¶²çµ¡é€£æ¥
   - å˜—è©¦å¢åŠ æƒæè¶…æ™‚æ™‚é–“

3. **æ¬Šé™å•é¡Œ**
   - ç¢ºèªç€è¦½å™¨å…è¨±è¨ªå•æœ¬åœ°ç¶²çµ¡
   - æŸäº›ç€è¦½å™¨å¯èƒ½é˜»æ­¢æœ¬åœ°ç¶²çµ¡è«‹æ±‚

## ğŸ¯ æœ€çµ‚ç‹€æ…‹

ä¿®å¾©å®Œæˆå¾Œï¼š
- âœ… è¨­å‚™æƒææŒ‰éˆ•æœ‰éŸ¿æ‡‰
- âœ… æƒæé€²åº¦æ­£å¸¸é¡¯ç¤º
- âœ… èƒ½å¤ ç™¼ç¾VRæœå‹™å™¨è¨­å‚™
- âœ… å¯ä»¥é€£æ¥åˆ°ç™¼ç¾çš„è¨­å‚™
- âœ… æ§åˆ¶å°é¡¯ç¤ºè©³ç´°çš„æƒææ—¥èªŒ
- âœ… æ‰€æœ‰æ–‡æª”ä¸­çš„ç«¯å£è™Ÿæ­£ç¢º

ç¾åœ¨ç”¨æˆ¶é»æ“Š"é–‹å§‹æƒæ"æ‡‰è©²èƒ½å¤ æ­£å¸¸å·¥ä½œäº†ï¼
