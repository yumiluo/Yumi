(()=>{var e={};e.id=931,e.ids=[931],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8893:e=>{"use strict";e.exports=require("buffer")},1282:e=>{"use strict";e.exports=require("child_process")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},8216:e=>{"use strict";e.exports=require("net")},9801:e=>{"use strict";e.exports=require("os")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},1568:e=>{"use strict";e.exports=require("zlib")},5826:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>o,routeModule:()=>m,tree:()=>d}),s(908),s(1216),s(5866);var i=s(3191),a=s(8716),l=s(7922),n=s.n(l),r=s(5231),c={};for(let e in r)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>r[e]);s.d(t,c);let d=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,908)),"/Users/luoyumin/VR3/Yumi/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,1216)),"/Users/luoyumin/VR3/Yumi/app/layout.tsx"],loading:[()=>Promise.resolve().then(s.bind(s,9644)),"/Users/luoyumin/VR3/Yumi/app/loading.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/luoyumin/VR3/Yumi/app/page.tsx"],u="/page",h={require:s,loadChunk:()=>Promise.resolve()},m=new i.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},264:(e,t,s)=>{Promise.resolve().then(s.bind(s,9833))},9833:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>em});var i=s(326),a=s(7577),l=s(772),n=s(3071),r=s(9210),c=s(567),d=s(2634),o=s(9758),u=s(2881);let h=(0,u.Z)("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);var m=s(361);let x=(0,u.Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),p=(0,u.Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var g=s(4893);let j=(0,u.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var v=s(1059),b=s(1608),y=s(949),f=s(4014),w=s(4061),N=s(4432),S=s(4019),C=s(7506),k=s(3855),z=s(1291),A=s(4215);let D=(0,u.Z)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),V=(0,u.Z)("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),T=(0,u.Z)("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),Z=(0,u.Z)("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),E=(0,u.Z)("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);function I({videoId:e,title:t,onPlay:s,onPause:r,onStop:d,onSeek:o,onVolumeChange:u,onReady:h,isPlaying:m=!1,currentTime:x=0,duration:p=0,volume:j=100,isMuted:y=!1}){let f=(0,a.useRef)(null),[w,N]=(0,a.useState)(null),[S,C]=(0,a.useState)(!1),[k,A]=(0,a.useState)(null),[I,R]=(0,a.useState)(!1),P=e=>{w&&S&&(w.setVolume(e),u?.(e))},O=e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`;return k?i.jsx(n.Zb,{className:"w-full",children:(0,i.jsxs)(n.aY,{className:"p-6 text-center",children:[i.jsx("div",{className:"text-red-500 mb-4",children:i.jsx(z.Z,{className:"h-12 w-12 mx-auto"})}),i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"播放器錯誤"}),i.jsx("p",{className:"text-gray-600 mb-4",children:k}),i.jsx(l.z,{onClick:()=>window.location.reload(),children:"重新載入"})]})}):(0,i.jsxs)(n.Zb,{className:"w-full",children:[(0,i.jsxs)(n.Ol,{children:[(0,i.jsxs)(n.ll,{className:"flex items-center justify-between",children:[i.jsx("span",{children:t}),i.jsx(c.C,{variant:"outline",children:"YouTube 360\xb0"})]}),i.jsx(n.SZ,{children:"使用YouTube播放器播放360度旅遊影片"})]}),(0,i.jsxs)(n.aY,{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"relative",children:[i.jsx("div",{ref:f,className:"w-full aspect-video bg-gray-900 rounded-lg overflow-hidden"}),!S&&i.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-75",children:(0,i.jsxs)("div",{className:"text-center text-white",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),i.jsx("p",{children:"載入YouTube播放器中..."})]})})]}),(0,i.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[i.jsx(l.z,{size:"sm",variant:"outline",onClick:()=>{},disabled:!S,title:"向左旋轉",children:i.jsx(D,{className:"h-4 w-4"})}),i.jsx(l.z,{size:"sm",variant:"outline",onClick:()=>{w&&S&&(w.stopVideo(),d?.())},disabled:!S,title:"停止",children:i.jsx(b.Z,{className:"h-4 w-4"})}),i.jsx(l.z,{size:"sm",onClick:m?()=>{w&&S&&(w.pauseVideo(),r?.())}:()=>{w&&S&&(w.playVideo(),s?.())},disabled:!S,title:m?"暫停":"播放",children:m?i.jsx(v.Z,{className:"h-4 w-4"}):i.jsx(g.Z,{className:"h-4 w-4"})}),i.jsx(l.z,{size:"sm",variant:"outline",onClick:()=>{},disabled:!S,title:"向右旋轉",children:i.jsx(V,{className:"h-4 w-4"})})]}),(0,i.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[i.jsx(l.z,{size:"sm",variant:"ghost",onClick:()=>{w&&S&&(y?w.unMute():w.mute())},disabled:!S,title:y?"取消靜音":"靜音",children:y?i.jsx(T,{className:"h-4 w-4"}):i.jsx(Z,{className:"h-4 w-4"})}),i.jsx("input",{type:"range",min:"0",max:"100",value:j,onChange:e=>P(parseInt(e.target.value)),disabled:!S,className:"w-24"}),(0,i.jsxs)("span",{className:"text-sm text-gray-600 w-12 text-center",children:[j,"%"]})]}),i.jsx("div",{className:"flex justify-center",children:(0,i.jsxs)(l.z,{size:"sm",variant:"outline",onClick:()=>{w&&S&&(I?(w.exitFullscreen(),R(!1)):(w.requestFullscreen(),R(!0)))},disabled:!S,title:I?"退出全螢幕":"全螢幕",children:[i.jsx(E,{className:"h-4 w-4"}),I?"退出全螢幕":"全螢幕"]})}),S&&(0,i.jsxs)("div",{className:"text-center text-sm text-gray-600",children:[i.jsx("span",{children:O(x)}),i.jsx("span",{className:"mx-2",children:"/"}),i.jsx("span",{children:O(p)})]}),i.jsx("div",{className:"text-center text-xs text-gray-500 bg-blue-50 p-2 rounded",children:"\uD83D\uDCA1 提示：使用滑鼠拖拽或觸控手勢來旋轉360度影片視角"})]})]})}let R={亞洲:["日本","中國","韓國","泰國","越南","新加坡","馬來西亞","印尼","菲律賓","印度","台灣","香港","澳門","蒙古","北韓","南韓","柬埔寨","寮國","緬甸","文萊","東帝汶","斯里蘭卡","孟加拉","尼泊爾","不丹","馬爾地夫","巴基斯坦","阿富汗","伊朗","伊拉克","科威特","沙烏地阿拉伯","阿曼","葉門","阿聯酋","卡達","巴林","約旦","黎巴嫩","敘利亞","以色列","巴勒斯坦","塞浦路斯","土耳其","喬治亞","亞美尼亞","亞塞拜然","哈薩克","烏茲別克","土庫曼","吉爾吉斯","塔吉克"],歐洲:["法國","德國","英國","義大利","西班牙","荷蘭","比利時","瑞士","奧地利","希臘","葡萄牙","愛爾蘭","丹麥","芬蘭","瑞典","挪威","冰島","波蘭","捷克","斯洛伐克","匈牙利","羅馬尼亞","保加利亞","克羅埃西亞","斯洛維尼亞","波士尼亞","塞爾維亞","蒙特內哥羅","北馬其頓","阿爾巴尼亞","愛沙尼亞","拉脫維亞","立陶宛","白俄羅斯","烏克蘭","摩爾多瓦","俄羅斯","盧森堡","列支敦斯登","摩納哥","安道爾","聖馬利諾","梵蒂岡","馬爾他"],中東:["沙烏地阿拉伯","伊朗","伊拉克","科威特","阿曼","葉門","阿聯酋","卡達","巴林","約旦","黎巴嫩","敘利亞","以色列","巴勒斯坦","塞浦路斯","土耳其","埃及"],非洲:["埃及","摩洛哥","南非","肯亞","坦尚尼亞","奈及利亞","迦納","阿爾及利亞","突尼西亞","利比亞","蘇丹","南蘇丹","衣索比亞","索馬利亞","吉布地","厄利垂亞","烏干達","盧安達","蒲隆地","中非共和國","查德","喀麥隆","加彭","剛果共和國","剛果民主共和國","安哥拉","尚比亞","辛巴威","波札那","納米比亞","馬達加斯加","模里西斯","塞席爾","葛摩","馬利","布吉納法索","尼日","查德","馬利","茅利塔尼亞","塞內加爾","甘比亞","幾內亞比索","幾內亞","獅子山","賴比瑞亞","象牙海岸","多哥","貝南","尼日","喀麥隆","赤道幾內亞","聖多美和普林西比","加彭","剛果共和國","剛果民主共和國","中非共和國","查德","喀麥隆","奈及利亞","尼日","查德","蘇丹","南蘇丹","衣索比亞","厄利垂亞","吉布地","索馬利亞","肯亞","烏干達","盧安達","蒲隆地","坦尚尼亞","馬達加斯加","模里西斯","塞席爾","葛摩","馬約特","留尼旺","聖赫勒拿","阿森松","特里斯坦-達庫尼亞"],北美洲:["美國","加拿大","墨西哥","格陵蘭","百慕達","聖皮埃與密克隆群島"],南美洲:["巴西","阿根廷","智利","秘魯","哥倫比亞","委內瑞拉","厄瓜多","玻利維亞","巴拉圭","烏拉圭","蓋亞那","蘇利南","法屬蓋亞那","福克蘭群島","南喬治亞和南桑威奇群島"],大洋洲:["澳洲","紐西蘭","斐濟","巴布亞紐幾內亞","所羅門群島","萬那杜","新喀里多尼亞","諾福克島","聖誕島","科科斯群島","諾魯","密克羅尼西亞","馬紹爾群島","帛琉","關島","北馬里亞納群島","美屬薩摩亞","東加","薩摩亞","庫克群島","紐埃","托克勞","瓦利斯和富圖納","皮特凱恩群島","法屬波利尼西亞"],北極:["格陵蘭","冰島","挪威","瑞典","芬蘭","俄羅斯","加拿大","美國"],南極:["南極洲"]};function P(e){let t=e.toLowerCase();for(let[e,s]of Object.entries(R))if(s.some(e=>e.toLowerCase()===t))return e;for(let[e,s]of Object.entries(R))if(s.some(e=>t.includes(e.toLowerCase())||e.toLowerCase().includes(t)))return e;return"亞洲"}let O="vr-travel-videos";class M{static getAllVideos(){try{let e=localStorage.getItem(O);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return[]}}static addVideo(e){try{let t=this.getAllVideos();if(t.some(t=>t.id===e.id)||t.length>=50)return!1;let s=P(e.country),i={...e,category:s,addedAt:new Date().toISOString(),viewCount:0};return t.unshift(i),localStorage.setItem(O,JSON.stringify(t)),!0}catch(e){return!1}}static getVideosByCategory(e){return this.getAllVideos().filter(t=>t.category===e)}static getAllCategories(){return Object.keys(R)}static getCategoryStats(){let e=this.getAllVideos(),t={};return Object.keys(R).forEach(s=>{t[s]=e.filter(e=>e.category===s).length}),t}static updateVideo(e,t){try{let s=this.getAllVideos(),i=s.findIndex(t=>t.id===e);if(-1===i)return!1;return t.country&&t.country!==s[i].country&&(t.category=P(t.country)),s[i]={...s[i],...t},localStorage.setItem(O,JSON.stringify(s)),!0}catch(e){return!1}}static removeVideo(e){try{let t=this.getAllVideos(),s=t.filter(t=>t.id!==e);if(s.length===t.length)return!1;return localStorage.setItem(O,JSON.stringify(s)),!0}catch(e){return!1}}static getVideoById(e){return this.getAllVideos().find(t=>t.id===e)||null}static getVideosByCountry(e){return this.getAllVideos().filter(t=>t.country===e)}static getVideosByTag(e){return this.getAllVideos().filter(t=>t.tags.some(t=>t.toLowerCase().includes(e.toLowerCase())))}static searchVideos(e){let t=this.getAllVideos(),s=e.toLowerCase();return t.filter(e=>e.title.toLowerCase().includes(s)||e.description.toLowerCase().includes(s)||e.country.toLowerCase().includes(s)||e.category.toLowerCase().includes(s)||e.tags.some(e=>e.toLowerCase().includes(s)))}static incrementViewCount(e){return this.updateVideo(e,{viewCount:(this.getVideoById(e)?.viewCount||0)+1})}static getPopularVideos(e=10){return this.getAllVideos().sort((e,t)=>t.viewCount-e.viewCount).slice(0,e)}static getRecentVideos(e=10){return this.getAllVideos().sort((e,t)=>new Date(t.addedAt).getTime()-new Date(e.addedAt).getTime()).slice(0,e)}static clearAllVideos(){try{return localStorage.removeItem(O),!0}catch(e){return!1}}static getStorageStats(){let e=this.getAllVideos(),t=[...new Set(e.map(e=>e.country))],s=[...new Set(e.map(e=>e.category))],i=e.reduce((e,t)=>e+t.tags.length,0),a=e.reduce((e,t)=>e+t.viewCount,0);return{totalVideos:e.length,totalCountries:t.length,totalCategories:s.length,totalTags:i,totalViews:a,averageViews:e.length>0?Math.round(a/e.length):0,storageUsage:`${e.length}/50`,countries:t,categories:s,categoryStats:this.getCategoryStats()}}static hasStorageSpace(){return this.getAllVideos().length<50}static exportVideos(){try{let e=this.getAllVideos();return JSON.stringify(e,null,2)}catch(e){return"[]"}}static importVideos(e){try{let t=JSON.parse(e);if(!Array.isArray(t))throw Error("無效的數據格式");let s=t.filter(e=>e&&"string"==typeof e.id&&"string"==typeof e.title&&"string"==typeof e.embedUrl);if(0===s.length)throw Error("沒有有效的影片數據");if(s.length>50)throw Error(`影片數量超過限制 (50)`);let i=s.map(e=>({...e,category:e.category||P(e.country||"未知"),addedAt:e.addedAt||new Date().toISOString(),viewCount:e.viewCount||0}));return localStorage.setItem(O,JSON.stringify(i)),!0}catch(e){return!1}}}let q="AIzaSyDOo1gTzt44lV1bZR5K5l-OThTm8XmBsmQ";function $({onVideoSelected:e,onClose:t}){let[s,r]=(0,a.useState)(""),[c,d]=(0,a.useState)([]),[o,u]=(0,a.useState)(!1),[h,m]=(0,a.useState)(null),[p,j]=(0,a.useState)([]),[v,b]=(0,a.useState)(null),[y,f]=(0,a.useState)(!1),[w,D]=(0,a.useState)(!1),V=e=>{let t=[e,...p.filter(t=>t!==e)].slice(0,5);j(t),localStorage.setItem("youtube-recent-searches",JSON.stringify(t))},T=async e=>{if(e.trim()){if(!q){m("請先設定YouTube API Key"),(0,A.Am)({title:"配置錯誤",description:"請在組件中設定真實的YouTube API Key",variant:"destructive"});return}u(!0),m(null),d([]);try{let t=await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(e+" 360 VR travel")}&type=video&videoDefinition=high&maxResults=20&key=${q}`);if(!t.ok)throw Error(`YouTube API錯誤: ${t.status}`);let s=await t.json();if(!s.items||0===s.items.length){m("沒有找到相關的360度旅遊影片");return}let i=s.items.map(e=>e.id.videoId).join(","),a=await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails,statistics,status&id=${i}&key=${q}`);if(!a.ok)throw Error(`獲取影片詳情失敗: ${a.status}`);let l=(await a.json()).items.filter(e=>{let t=e.snippet.title.toLowerCase(),s=e.snippet.description.toLowerCase(),i=e.snippet.tags||[];return t.includes("360")||t.includes("vr")||s.includes("360")||s.includes("vr")||i.some(e=>e.toLowerCase().includes("360")||e.toLowerCase().includes("vr"))}).map(e=>{let t=Z(e.snippet.title,e.snippet.description),s=E(e.contentDetails.duration),i=`https://www.youtube.com/embed/${e.id}?rel=0&enablejsapi=1&playsinline=1&vr=1`;return{id:e.id,title:e.snippet.title,description:e.snippet.description,thumbnail:e.snippet.thumbnails.high?.url||e.snippet.thumbnails.medium?.url,duration:s,country:t,category:P(t),tags:e.snippet.tags||[],embedUrl:i,publishedAt:e.snippet.publishedAt,channelTitle:e.snippet.channelTitle,addedAt:new Date().toISOString(),viewCount:0,embeddable:e.status?.embeddable===!0}});if(0===l.length){m("沒有找到符合條件的360度旅遊影片");return}d(l),V(e),(0,A.Am)({title:"搜索完成",description:`找到 ${l.length} 個360度旅遊影片`})}catch(e){m(`搜索失敗: ${e instanceof Error?e.message:"未知錯誤"}`),(0,A.Am)({title:"搜索失敗",description:e instanceof Error?e.message:"未知錯誤",variant:"destructive"})}finally{u(!1)}}},Z=(e,t)=>{let s=(e+" "+t).toLowerCase();for(let e of["日本","中國","韓國","泰國","越南","新加坡","馬來西亞","印尼","菲律賓","印度","法國","德國","英國","義大利","西班牙","荷蘭","比利時","瑞士","奧地利","希臘","埃及","摩洛哥","南非","肯亞","坦尚尼亞","奈及利亞","迦納","美國","加拿大","墨西哥","巴西","阿根廷","智利","秘魯","哥倫比亞","澳洲","紐西蘭","斐濟","巴布亞紐幾內亞"])if(s.includes(e.toLowerCase()))return e;return s.includes("tokyo")||s.includes("東京")?"日本":s.includes("paris")||s.includes("巴黎")?"法國":s.includes("london")||s.includes("倫敦")?"英國":s.includes("new york")||s.includes("紐約")?"美國":s.includes("sydney")||s.includes("雪梨")?"澳洲":"未知地區"},E=e=>{let t=e.match(/PT(\d+H)?(\d+M)?(\d+S)?/);if(!t)return"未知";let s=t[1]?parseInt(t[1].replace("H","")):0,i=t[2]?parseInt(t[2].replace("M","")):0,a=t[3]?parseInt(t[3].replace("S","")):0;return s>0?`${s}:${i.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`:`${i}:${a.toString().padStart(2,"0")}`},R=()=>{s.trim()&&T(s.trim())},O=t=>{b(t),f(!0),D(!1);try{M.addVideo(t)?(0,A.Am)({title:"視頻已添加",description:`${t.title} 已自動分類到 ${t.category} 並存儲到本地`}):(0,A.Am)({title:"視頻已存在",description:"此視頻已在您的收藏中",variant:"default"})}catch(e){(0,A.Am)({title:"存儲失敗",description:"無法將視頻存儲到本地",variant:"destructive"})}e(t),setTimeout(()=>{f(!1)},2e3)},$=e=>{r(e),T(e)};return v?i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[i.jsx("h2",{className:"text-2xl font-bold",children:"播放360度旅遊影片"}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[i.jsx(l.z,{variant:"outline",size:"sm",onClick:()=>{b(null),f(!1),D(!1)},children:"返回搜索"}),i.jsx(l.z,{variant:"ghost",size:"sm",onClick:t,children:i.jsx(S.Z,{className:"h-4 w-4"})})]})]}),(0,i.jsxs)("div",{className:"p-6",children:[(0,i.jsxs)("div",{className:"mb-4 p-4 bg-blue-50 rounded-lg",children:[i.jsx("h3",{className:"font-semibold text-lg mb-2",children:v.title}),(0,i.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[(0,i.jsxs)("span",{children:["地區: ",v.country]}),(0,i.jsxs)("span",{children:["時長: ",v.duration]}),(0,i.jsxs)("span",{children:["頻道: ",v.channelTitle]})]})]}),(0,i.jsxs)("div",{className:"relative",children:[y&&i.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-75 z-10 rounded-lg",children:(0,i.jsxs)("div",{className:"text-center text-white",children:[i.jsx(C.Z,{className:"h-16 w-16 animate-spin mx-auto mb-4"}),i.jsx("p",{className:"text-lg",children:"正在載入視頻..."}),i.jsx("p",{className:"text-sm opacity-75",children:"請稍候，這可能需要幾秒鐘"})]})}),(0,i.jsxs)("div",{className:"mb-2 p-2 bg-yellow-50 border border-yellow-50 rounded text-xs text-yellow-800",children:[i.jsx("strong",{children:"調試信息:"})," Video ID: ",v.id," | 標題: ",v.title]}),i.jsx("div",{className:"mb-4",children:i.jsx("iframe",{width:"100%",height:"400",src:`https://www.youtube.com/embed/${v.id}?rel=0&enablejsapi=1&playsinline=1&vr=1`,title:v.title,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0})}),(0,i.jsxs)("div",{className:"mt-4",children:[i.jsx("h4",{className:"text-sm font-medium mb-2",children:"高級播放器（實驗性）:"}),i.jsx(I,{videoId:v.id,title:v.title,onPlay:()=>{D(!0),f(!1)},onPause:()=>{D(!1)},onStop:()=>{D(!1),f(!1)},onReady:()=>{f(!1)},isPlaying:w})]})]}),(0,i.jsxs)("div",{className:"mt-6 flex justify-center gap-4",children:[(0,i.jsxs)(l.z,{onClick:()=>e(v),className:"bg-blue-600 hover:bg-blue-700",children:[i.jsx(k.Z,{className:"mr-2 h-4 w-4"}),"添加到播放列表"]}),(0,i.jsxs)(l.z,{variant:"outline",onClick:()=>window.open(`https://www.youtube.com/watch?v=${v.id}`,"_blank"),children:[i.jsx(g.Z,{className:"mr-2 h-4 w-4"}),"在YouTube中觀看"]})]})]})]})}):i.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[i.jsx("h2",{className:"text-2xl font-bold",children:"從YouTube搜索VR/360度旅遊影片"}),i.jsx(l.z,{variant:"ghost",size:"sm",onClick:t,children:"✕"})]}),(0,i.jsxs)("div",{className:"p-6",children:[(0,i.jsxs)("div",{className:"flex gap-2 mb-6",children:[i.jsx(N.I,{placeholder:"輸入搜索關鍵詞，如：360 VR travel Japan",value:s,onChange:e=>r(e.target.value),onKeyPress:e=>"Enter"===e.key&&R(),className:"flex-1"}),(0,i.jsxs)(l.z,{onClick:R,disabled:o||!s.trim(),children:[o?i.jsx(C.Z,{className:"mr-2 h-4 w-4 animate-spin"}):i.jsx(x,{className:"mr-2 h-4 w-4"}),"搜索"]})]}),p.length>0&&(0,i.jsxs)("div",{className:"mb-6",children:[i.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"最近搜索:"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:p.map((e,t)=>i.jsx(l.z,{variant:"outline",size:"sm",onClick:()=>$(e),className:"text-xs",children:e},t))})]}),h&&i.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,i.jsxs)("div",{className:"flex items-center",children:[i.jsx(z.Z,{className:"h-5 w-5 text-red-500 mr-2"}),i.jsx("span",{className:"text-red-700",children:h})]})}),c.length>0&&(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold",children:["搜索結果 (",c.length,")"]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto",children:c.map(e=>(0,i.jsxs)(n.Zb,{className:"hover:shadow-md transition-shadow",children:[i.jsx(n.Ol,{className:"p-4",children:i.jsx("img",{src:e.thumbnail,alt:e.title,className:"w-full h-32 object-cover rounded"})}),(0,i.jsxs)(n.aY,{className:"p-4",children:[i.jsx(n.ll,{className:"text-sm font-semibold mb-2 line-clamp-2",children:e.title}),(0,i.jsxs)("div",{className:"space-y-2 text-xs text-gray-600",children:[(0,i.jsxs)("p",{children:["地區: ",e.country]}),(0,i.jsxs)("p",{children:["時長: ",e.duration]}),(0,i.jsxs)("p",{children:["頻道: ",e.channelTitle]})]}),(0,i.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,i.jsxs)(l.z,{size:"sm",onClick:()=>O(e),className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[i.jsx(g.Z,{className:"mr-1 h-3 w-3"}),"播放影片"]}),(0,i.jsxs)(l.z,{size:"sm",variant:"outline",onClick:()=>window.open(`https://www.youtube.com/watch?v=${e.id}`,"_blank"),children:[i.jsx(g.Z,{className:"mr-1 h-3 w-3"}),"預覽"]})]})]})]},e.id))})]}),o&&(0,i.jsxs)("div",{className:"text-center py-8",children:[i.jsx(C.Z,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),i.jsx("p",{className:"text-gray-600",children:"正在搜索YouTube VR/360度旅遊影片..."})]}),!o&&0===c.length&&!h&&(0,i.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[i.jsx(x,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),i.jsx("p",{children:"輸入關鍵詞開始搜索360度旅遊影片"}),i.jsx("p",{className:"text-sm mt-2",children:"建議搜索：360 VR travel Japan, 360 VR travel France 等"})]})]})]})})}let Y=(0,u.Z)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),L=(0,u.Z)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),F=({isVisible:e,isMobileDevice:t,isVRHeadset:s})=>e?i.jsx("div",{className:"absolute inset-0 z-20 flex items-center justify-center bg-black bg-opacity-50 transition-opacity duration-1000",children:(0,i.jsxs)("div",{className:"text-center text-white bg-black bg-opacity-70 p-6 rounded-lg max-w-md",children:[i.jsx("div",{className:"text-4xl mb-4",children:"\uD83C\uDFA5"}),i.jsx("h3",{className:"text-xl font-bold mb-3",children:"VR 360\xb0 沉浸式體驗"}),i.jsx("div",{className:"space-y-2 text-sm opacity-90",children:t||s?(0,i.jsxs)(i.Fragment,{children:[i.jsx("p",{children:"• 轉動頭部來控制360度視角"}),i.jsx("p",{children:"• 支持陀螺儀和設備方向感應"}),i.jsx("p",{children:"• 自動適配手機和VR頭顯"}),i.jsx("p",{children:"• 點擊屏幕或按返回鍵退出VR"})]}):(0,i.jsxs)(i.Fragment,{children:[i.jsx("p",{children:"• 使用滑鼠拖拽來旋轉360度視角"}),i.jsx("p",{children:"• 點擊全屏按鈕獲得最佳VR體驗"}),i.jsx("p",{children:"• 支持VR頭顯設備"}),i.jsx("p",{children:"• 按ESC鍵或懸停右上角退出VR模式"})]})}),i.jsx("div",{className:"mt-4 text-xs opacity-75",children:"提示將在3秒後自動消失..."})]})}):null;function _({videoId:e,title:t,embedUrl:s,onPlay:r,onPause:d,onStop:o,onSeek:u,onVolumeChange:h,isPlaying:m=!1,currentTime:x=0,duration:p=0,volume:j=100,isMuted:y=!1}){let f=(0,a.useRef)(null),[w,N]=(0,a.useState)(null),[S,C]=(0,a.useState)(!1),[k,A]=(0,a.useState)(null),[V,I]=(0,a.useState)(!1),[R,P]=(0,a.useState)(!1),[O,M]=(0,a.useState)(!0),[q,$]=(0,a.useState)(!1),[_,U]=(0,a.useState)(!1),[W,J]=(0,a.useState)(!1),[B,H]=(0,a.useState)({alpha:0,beta:0,gamma:0}),[G,Q]=(0,a.useState)({x:0,y:0,z:0}),[X,K]=(0,a.useState)(!0),ee=async()=>{try{if("undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission){let e=await DeviceOrientationEvent.requestPermission();"granted"===e&&J(!0)}else J(!0)}catch(e){}},et=e=>{w&&S&&(w.setVolume(e),h?.(e))},es=()=>{P(!R),R?(document.body.style.overflow="auto",document.documentElement.style.overflow="auto",document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),document.body.classList.remove("vr-mode"),J(!1)):(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen(),document.body.classList.add("vr-mode"),K(!0),(q||_)&&ee())},ei=e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`;return k?i.jsx(n.Zb,{className:"w-full",children:(0,i.jsxs)(n.aY,{className:"p-6 text-center",children:[i.jsx("div",{className:"text-red-500 mb-4",children:i.jsx(z.Z,{className:"h-12 w-12 mx-auto"})}),i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"播放器錯誤"}),i.jsx("p",{className:"text-gray-600 mb-4",children:k}),(0,i.jsxs)("div",{className:"mb-4",children:[i.jsx("h4",{className:"text-sm font-medium mb-2",children:"備用播放器:"}),i.jsx("iframe",{width:"100%",height:"300",src:`https://www.youtube.com/embed/${e}?rel=0&enablejsapi=1&playsinline=1&vr=1`,title:t,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0})]}),(0,i.jsxs)("div",{className:"flex gap-2 justify-center",children:[i.jsx(l.z,{onClick:()=>window.location.reload(),children:"重新載入"}),i.jsx(l.z,{onClick:()=>A(null),variant:"outline",children:"重試播放器"})]})]})}):R?(0,i.jsxs)("div",{className:"fixed inset-0 z-50 bg-black",children:[i.jsx("div",{className:"w-full h-full relative",children:i.jsx("iframe",{src:`https://www.youtube.com/embed/${e}?autoplay=1&rel=0&modestbranding=1&playsinline=1&vr=1&enablejsapi=1&controls=1&fs=1&iv_load_policy=3&cc_load_policy=0&showinfo=0&origin=${window.location.origin}`,title:t,className:"absolute inset-0 w-full h-full",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen",allowFullScreen:!0,style:{border:"none",margin:0,padding:0,display:"block"}})}),i.jsx(F,{isVisible:X,isMobileDevice:q,isVRHeadset:_}),!q&&i.jsx("div",{className:"absolute top-4 right-4 z-10 opacity-0 hover:opacity-100 transition-opacity duration-300",children:(0,i.jsxs)(l.z,{onClick:es,variant:"outline",size:"sm",className:"bg-black bg-opacity-70 text-white border-white hover:bg-opacity-90",children:[i.jsx(Y,{className:"mr-2 h-4 w-4"}),"退出VR"]})}),(q||_)&&i.jsx("div",{className:"absolute inset-0 z-10",onClick:()=>{es()},style:{pointerEvents:"auto"}}),W&&(0,i.jsxs)("div",{className:"absolute bottom-4 left-4 z-20 text-white text-xs bg-black bg-opacity-50 p-2 rounded",children:[i.jsx("div",{children:"頭部追蹤已啟用"}),(0,i.jsxs)("div",{children:["X: ",G.x.toFixed(1),"\xb0"]}),(0,i.jsxs)("div",{children:["Y: ",G.y.toFixed(1),"\xb0"]}),(0,i.jsxs)("div",{children:["Z: ",G.z.toFixed(1),"\xb0"]})]})]}):(0,i.jsxs)(n.Zb,{className:"w-full",children:[(0,i.jsxs)(n.Ol,{children:[(0,i.jsxs)(n.ll,{className:"flex items-center justify-between",children:[i.jsx("span",{children:t}),(0,i.jsxs)("div",{className:"flex gap-2",children:[i.jsx(c.C,{variant:"outline",children:"YouTube 360\xb0"}),i.jsx(c.C,{variant:"outline",children:"VR Ready"})]})]}),i.jsx(n.SZ,{children:"使用A-Frame VR播放器播放360度旅遊影片"})]}),(0,i.jsxs)(n.aY,{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"relative",children:[i.jsx("div",{ref:f,className:"w-full aspect-video bg-gray-900 rounded-lg overflow-hidden"}),!S&&i.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-75",children:(0,i.jsxs)("div",{className:"text-center text-white",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),i.jsx("p",{children:"載入YouTube播放器中..."})]})})]}),(0,i.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[i.jsx(l.z,{size:"sm",variant:"outline",onClick:()=>{},disabled:!S,title:"向左旋轉",children:i.jsx(D,{className:"h-4 w-4"})}),i.jsx(l.z,{size:"sm",variant:"outline",onClick:()=>{w&&S&&(w.stopVideo(),o?.())},disabled:!S,title:"停止",children:i.jsx(b.Z,{className:"h-4 w-4"})}),i.jsx(l.z,{size:"sm",onClick:m?()=>{w&&S&&(w.pauseVideo(),d?.())}:()=>{w&&S&&(w.playVideo(),r?.())},disabled:!S,title:m?"暫停":"播放",children:m?i.jsx(v.Z,{className:"h-4 w-4"}):i.jsx(g.Z,{className:"h-4 w-4"})}),i.jsx(l.z,{size:"sm",variant:"outline",onClick:()=>{},disabled:!S,title:"向右旋轉",children:i.jsx(D,{className:"h-4 w-4"})})]}),i.jsx("div",{className:"flex justify-center",children:(0,i.jsxs)(l.z,{size:"lg",onClick:es,disabled:!S,className:"bg-purple-600 hover:bg-purple-700 text-white",children:[i.jsx(L,{className:"mr-2 h-4 w-4"}),"進入VR模式"]})}),(0,i.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[i.jsx(l.z,{size:"sm",variant:"ghost",onClick:()=>{w&&S&&(y?w.unMute():w.mute())},disabled:!S,title:y?"取消靜音":"靜音",children:y?i.jsx(T,{className:"h-4 w-4"}):i.jsx(Z,{className:"h-4 w-4"})}),i.jsx("input",{type:"range",min:"0",max:"100",value:j,onChange:e=>et(parseInt(e.target.value)),disabled:!S,className:"w-24"}),(0,i.jsxs)("span",{className:"text-sm text-gray-600 w-12 text-center",children:[j,"%"]})]}),i.jsx("div",{className:"flex justify-center",children:(0,i.jsxs)(l.z,{size:"sm",variant:"outline",onClick:()=>{w&&S&&(V?(w.exitFullscreen(),I(!1)):(w.requestFullscreen(),I(!0)))},disabled:!S,title:V?"退出全螢幕":"全螢幕",children:[i.jsx(E,{className:"h-4 w-4"}),V?"退出全螢幕":"全螢幕"]})}),S&&(0,i.jsxs)("div",{className:"text-center text-sm text-gray-600",children:[i.jsx("span",{children:ei(x)}),i.jsx("span",{className:"mx-2",children:"/"}),i.jsx("span",{children:ei(p)})]}),i.jsx("div",{className:"text-center text-xs text-gray-500 bg-blue-50 p-2 rounded",children:'\uD83D\uDCA1 提示：點擊"進入VR模式"體驗360度沉浸式觀看，使用滑鼠拖拽或VR控制器旋轉視角'}),i.jsx("div",{className:"text-center",children:(0,i.jsxs)(l.z,{size:"sm",variant:"ghost",onClick:()=>M(!O),className:"text-gray-500",children:[O?i.jsx(Y,{className:"h-4 w-4"}):i.jsx(L,{className:"h-4 w-4"}),O?"隱藏控制":"顯示控制"]})})]})]})}var U=s(64),W=s(9669),J=s(3495);let B=(0,u.Z)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);var H=s(1405);let G=(0,u.Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var Q=s(5091);let X=(0,u.Z)("Bluetooth",[["path",{d:"m7 7 10 10-5 5V2l5 5L7 17",key:"1q5490"}]]);var K=s(7702);class ee extends K.EventEmitter{constructor(e={}){super(),this.ws=null,this.reconnectAttempts=0,this.heartbeatTimer=null,this.reconnectTimer=null,this.isConnecting=!1,this.messageQueue=[],this.connectionPool=new Map,this.config={url:e.url||"ws://localhost:3001",reconnectInterval:e.reconnectInterval||1e3,maxReconnectAttempts:e.maxReconnectAttempts||10,heartbeatInterval:e.heartbeatInterval||3e4,timeout:e.timeout||5e3}}async connect(){if(this.isConnecting||this.ws?.readyState===WebSocket.OPEN)return!0;this.isConnecting=!0;try{return this.ws=new WebSocket(this.config.url),new Promise(e=>{let t=setTimeout(()=>{this.emit("error",Error("Connection timeout")),e(!1)},this.config.timeout);this.ws.onopen=()=>{clearTimeout(t),this.isConnecting=!1,this.reconnectAttempts=0,this.emit("connected"),this.startHeartbeat(),this.flushMessageQueue(),e(!0)},this.ws.onclose=t=>{this.isConnecting=!1,this.stopHeartbeat(),this.emit("disconnected",t),this.scheduleReconnect(),e(!1)},this.ws.onerror=t=>{this.isConnecting=!1,this.emit("error",t),e(!1)},this.ws.onmessage=e=>{try{let t=JSON.parse(e.data);this.emit("message",t),this.emit(t.type,t.data)}catch(e){this.emit("error",Error("Invalid message format"))}}})}catch(e){return this.isConnecting=!1,this.emit("error",e),!1}}send(e,t,s){let i={type:e,data:t,timestamp:Date.now(),id:s};return this.ws?.readyState===WebSocket.OPEN?(this.ws.send(JSON.stringify(i)),!0):(this.messageQueue.push(i),!1)}async sendWithResponse(e,t,s=5e3){return new Promise((i,a)=>{let l=Math.random().toString(36).substr(2,9),n=setTimeout(()=>{this.removeListener(`response:${l}`,i),a(Error("Response timeout"))},s);this.once(`response:${l}`,e=>{clearTimeout(n),i(e)}),this.send(e,t,l)})}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.stopHeartbeat(),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}getConnectionState(){if(!this.ws)return"disconnected";switch(this.ws.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"connected";case WebSocket.CLOSING:return"closing";case WebSocket.CLOSED:return"closed";default:return"unknown"}}isConnected(){return this.ws?.readyState===WebSocket.OPEN}startHeartbeat(){this.heartbeatTimer=setInterval(()=>{this.isConnected()&&this.send("heartbeat",{timestamp:Date.now()})},this.config.heartbeatInterval)}stopHeartbeat(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}scheduleReconnect(){if(this.reconnectAttempts>=this.config.maxReconnectAttempts){this.emit("maxReconnectAttemptsReached");return}this.reconnectTimer=setTimeout(()=>{this.reconnectAttempts++,this.connect()},this.config.reconnectInterval*Math.pow(2,this.reconnectAttempts))}flushMessageQueue(){for(;this.messageQueue.length>0;){let e=this.messageQueue.shift();this.ws?.send(JSON.stringify(e))}}createConnectionPool(e){return e.forEach(e=>{if(!this.connectionPool.has(e)){let t=new WebSocket(e);this.connectionPool.set(e,t)}}),this.connectionPool}getConnectionPoolStatus(){let e={};return this.connectionPool.forEach((t,s)=>{e[s]=this.getConnectionState()}),e}}let et=new ee;class es extends K.EventEmitter{constructor(){super(),this.devices=new Map,this.activeConnections=new Map,this.scanInProgress=!1,this.connectionPool=new Map,this.deviceCapabilities=new Map,this.initializeWebSocket(),this.setupEventHandlers()}initializeWebSocket(){et.on("connected",()=>{this.emit("websocketConnected"),this.syncDeviceStates()}),et.on("disconnected",()=>{this.emit("websocketDisconnected")}),et.on("deviceDiscovered",e=>{this.addDevice(e)}),et.on("deviceStatusChanged",e=>{this.updateDeviceStatus(e.deviceId,e.status,e.metadata)})}setupEventHandlers(){et.on("message",e=>{switch(e.type){case"deviceList":this.updateDeviceList(e.data);break;case"deviceUpdate":this.updateDevice(e.data);break;case"deviceRemoved":this.removeDevice(e.data.deviceId)}})}async scanDevices(e={}){if(this.scanInProgress)throw Error("Device scan already in progress");this.scanInProgress=!0,this.emit("scanStarted");try{let t=await et.sendWithResponse("scanDevices",{methods:e.methods||["wifi","bluetooth"],timeout:e.timeout||1e4,filterTypes:e.filterTypes});if(t.success)return this.updateDeviceList(t.devices),this.emit("scanCompleted",t.devices),t.devices;throw Error(t.error||"Device scan failed")}catch(e){throw this.emit("scanError",e),e}finally{this.scanInProgress=!1,this.emit("scanStopped")}}async connectDevice(e){let t=this.devices.get(e);if(!t)return{success:!1,device:{},error:"Device not found"};if("connected"===t.status)return{success:!0,device:t,connectionId:e};try{this.updateDeviceStatus(e,"connecting");let s=await et.sendWithResponse("connectDevice",{deviceId:e,deviceType:t.type,connectionMethod:t.connectionMethod});if(s.success)return this.updateDeviceStatus(e,"connected"),this.activeConnections.set(e,t),this.emit("deviceConnected",t),{success:!0,device:t,connectionId:s.connectionId};return this.updateDeviceStatus(e,"error"),{success:!1,device:t,error:s.error}}catch(s){return this.updateDeviceStatus(e,"error"),{success:!1,device:t,error:s instanceof Error?s.message:"Connection failed"}}}async disconnectDevice(e){let t=this.devices.get(e);if(!t||"connected"!==t.status)return!1;try{if((await et.sendWithResponse("disconnectDevice",{deviceId:e,connectionId:this.activeConnections.get(e)?.id})).success)return this.updateDeviceStatus(e,"disconnected"),this.activeConnections.delete(e),this.emit("deviceDisconnected",t),!0;return!1}catch(e){return!1}}getDevices(){return Array.from(this.devices.values())}getConnectedDevices(){return Array.from(this.activeConnections.values())}getDeviceStatus(e){let t=this.devices.get(e);return t?.status||null}addDevice(e){let t={id:e.id,name:e.name,type:e.type,ip:e.ip,macAddress:e.macAddress,status:"discovered",capabilities:e.capabilities||[],batteryLevel:e.batteryLevel,lastSeen:new Date,connectionMethod:e.connectionMethod,metadata:e.metadata};this.devices.set(t.id,t),this.emit("deviceAdded",t)}updateDevice(e){let t=this.devices.get(e.id);if(t){let s={...t,...e};this.devices.set(e.id,s),this.emit("deviceUpdated",s)}}updateDeviceStatus(e,t,s){let i=this.devices.get(e);i&&(i.status=t,i.lastSeen=new Date,s&&(i.metadata={...i.metadata,...s}),this.devices.set(e,i),this.emit("deviceStatusChanged",{deviceId:e,status:t,device:i}))}removeDevice(e){let t=this.devices.get(e);t&&(this.devices.delete(e),this.activeConnections.delete(e),this.emit("deviceRemoved",t))}updateDeviceList(e){e.forEach(e=>{this.addDevice(e)})}async syncDeviceStates(){try{let e=await et.sendWithResponse("getDeviceStates",{});e.success&&e.devices.forEach(e=>{this.updateDevice(e)})}catch(e){}}getDeviceCapabilities(e){return Array.from(this.deviceCapabilities.get(e)||[])}deviceSupports(e,t){let s=this.deviceCapabilities.get(e);return s?.has(t)||!1}getConnectionStats(){let e=Array.from(this.devices.values());return{totalDevices:e.length,connectedDevices:e.filter(e=>"connected"===e.status).length,disconnectedDevices:e.filter(e=>"disconnected"===e.status).length,errorDevices:e.filter(e=>"error"===e.status).length}}cleanupOfflineDevices(e=5){let t=new Date,s=6e4*e;this.devices.forEach((e,i)=>{t.getTime()-e.lastSeen.getTime()>s&&this.removeDevice(i)})}reset(){this.devices.clear(),this.activeConnections.clear(),this.connectionPool.clear(),this.deviceCapabilities.clear(),this.scanInProgress=!1,this.emit("reset")}}let ei=new es,ea=0,el=new Map,en=e=>{if(el.has(e))return;let t=setTimeout(()=>{el.delete(e),eo({type:"REMOVE_TOAST",toastId:e})},1e6);el.set(e,t)},er=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?en(s):e.toasts.forEach(e=>{en(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},ec=[],ed={toasts:[]};function eo(e){ed=er(ed,e),ec.forEach(e=>{e(ed)})}function eu({...e}){let t=(ea=(ea+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>eo({type:"DISMISS_TOAST",toastId:t});return eo({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||s()}}}),{id:t,dismiss:s,update:e=>eo({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function eh(){let[e,t]=(0,a.useState)([]),[s,o]=(0,a.useState)({isScanning:!1,progress:0,currentMethod:"",discoveredCount:0,errorCount:0}),[u,p]=(0,a.useState)("disconnected"),[g,j]=(0,a.useState)("all"),[v,b]=(0,a.useState)(!1),f=(0,a.useCallback)(async(e=["wifi","bluetooth"])=>{if(!s.isScanning)try{o(t=>({...t,isScanning:!0,progress:0,currentMethod:e.join(", "),discoveredCount:0,errorCount:0}));let s=setInterval(()=>{o(e=>e.progress<90?{...e,progress:e.progress+10}:e)},200),i=await ei.scanDevices({methods:e,timeout:1e4});clearInterval(s),o(e=>({...e,progress:100})),t(i),eu({title:"掃描完成",description:`發現 ${i.length} 個設備`,variant:"default"})}catch(e){o(e=>({...e,isScanning:!1,errorCount:e.errorCount+1})),eu({title:"掃描失敗",description:e instanceof Error?e.message:"未知錯誤",variant:"destructive"})}finally{setTimeout(()=>{o(e=>({...e,isScanning:!1}))},1e3)}},[s.isScanning]),w=(0,a.useCallback)(async e=>{try{let t=await ei.connectDevice(e);t.success?eu({title:"連接成功",description:`${t.device.name} 已連接`,variant:"default"}):eu({title:"連接失敗",description:t.error||"無法連接到設備",variant:"destructive"})}catch(e){eu({title:"連接錯誤",description:e instanceof Error?e.message:"未知錯誤",variant:"destructive"})}},[]),N=(0,a.useCallback)(async e=>{try{await ei.disconnectDevice(e)?eu({title:"斷開成功",description:"設備已斷開連接",variant:"default"}):eu({title:"斷開失敗",description:"無法斷開設備連接",variant:"destructive"})}catch(e){eu({title:"斷開錯誤",description:e instanceof Error?e.message:"未知錯誤",variant:"destructive"})}},[]),S=(0,a.useCallback)(async()=>{try{let e=ei.getDevices();t(e)}catch(e){}},[]),C=(0,a.useMemo)(()=>"all"===g?e:e.filter(e=>{switch(g){case"vr":return"vr"===e.type;case"mobile":return"mobile"===e.type;case"desktop":return"desktop"===e.type;case"connected":return"connected"===e.status;case"discovered":return"discovered"===e.status;default:return!0}}),[e,g]),k=(0,a.useMemo)(()=>ei.getConnectionStats(),[e]),z=e=>{switch(e){case"connected":return i.jsx(m.Z,{className:"h-4 w-4 text-green-500"});case"connecting":return i.jsx(h,{className:"h-4 w-4 text-yellow-500 animate-pulse"});case"error":return i.jsx(W.Z,{className:"h-4 w-4 text-red-500"});case"discovered":return i.jsx(y.Z,{className:"h-4 w-4 text-blue-500"});default:return i.jsx(W.Z,{className:"h-4 w-4 text-gray-500"})}},A=e=>{switch(e){case"vr":case"desktop":default:return i.jsx(d.Z,{className:"h-4 w-4"});case"mobile":case"tablet":return i.jsx(J.Z,{className:"h-4 w-4"})}};return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)(n.Zb,{children:[(0,i.jsxs)(n.Ol,{children:[(0,i.jsxs)(n.ll,{className:"flex items-center gap-2",children:[i.jsx(B,{className:"h-5 w-5"}),"設備掃描器"]}),i.jsx(n.SZ,{children:"發現和連接VR設備、移動設備和桌面設備"})]}),(0,i.jsxs)(n.aY,{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[i.jsx(c.C,{variant:"connected"===u?"default":"destructive",children:"connected"===u?"已連接":"未連接"}),i.jsx("span",{className:"text-sm text-muted-foreground",children:"connected"===u?"WebSocket連接正常":"無法連接到服務器"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)(l.z,{variant:"outline",size:"sm",onClick:S,disabled:s.isScanning,children:[i.jsx(H.Z,{className:"h-4 w-4"}),"刷新"]}),(0,i.jsxs)(l.z,{variant:"outline",size:"sm",onClick:()=>b(!v),className:v?"bg-primary text-primary-foreground":"",children:[i.jsx(G,{className:"h-4 w-4"}),"自動刷新"]})]})]}),s.isScanning&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,i.jsxs)("span",{children:["正在掃描: ",s.currentMethod]}),(0,i.jsxs)("span",{children:[s.progress,"%"]})]}),i.jsx(U.E,{value:s.progress,className:"w-full"})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)(l.z,{onClick:()=>f(["wifi"]),disabled:s.isScanning||"connected"!==u,className:"flex-1",children:[i.jsx(Q.Z,{className:"h-4 w-4 mr-2"}),"掃描WiFi設備"]}),(0,i.jsxs)(l.z,{onClick:()=>f(["bluetooth"]),disabled:s.isScanning||"connected"!==u,className:"flex-1",children:[i.jsx(X,{className:"h-4 w-4 mr-2"}),"掃描藍牙設備"]}),(0,i.jsxs)(l.z,{onClick:()=>f(["wifi","bluetooth"]),disabled:s.isScanning||"connected"!==u,className:"flex-1",children:[i.jsx(x,{className:"h-4 w-4 mr-2"}),"掃描所有設備"]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-4 gap-4 text-center",children:[(0,i.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[i.jsx("div",{className:"text-2xl font-bold text-primary",children:k.totalDevices}),i.jsx("div",{className:"text-xs text-muted-foreground",children:"總設備"})]}),(0,i.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[i.jsx("div",{className:"text-2xl font-bold text-green-600",children:k.connectedDevices}),i.jsx("div",{className:"text-xs text-muted-foreground",children:"已連接"})]}),(0,i.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[i.jsx("div",{className:"text-2xl font-bold text-blue-600",children:k.disconnectedDevices}),i.jsx("div",{className:"text-xs text-muted-foreground",children:"未連接"})]}),(0,i.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[i.jsx("div",{className:"text-2xl font-bold text-red-600",children:k.errorDevices}),i.jsx("div",{className:"text-xs text-muted-foreground",children:"錯誤"})]})]})]})]}),(0,i.jsxs)(n.Zb,{children:[(0,i.jsxs)(n.Ol,{children:[i.jsx(n.ll,{children:"設備列表"}),(0,i.jsxs)(n.SZ,{children:["發現的設備 (",C.length,")"]})]}),i.jsx(n.aY,{children:(0,i.jsxs)(r.mQ,{value:g,onValueChange:j,children:[(0,i.jsxs)(r.dr,{className:"grid w-full grid-cols-6",children:[i.jsx(r.SP,{value:"all",children:"全部"}),i.jsx(r.SP,{value:"vr",children:"VR設備"}),i.jsx(r.SP,{value:"mobile",children:"移動設備"}),i.jsx(r.SP,{value:"desktop",children:"桌面設備"}),i.jsx(r.SP,{value:"connected",children:"已連接"}),i.jsx(r.SP,{value:"discovered",children:"已發現"})]}),i.jsx(r.nU,{value:g,className:"mt-4",children:0===C.length?i.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"all"===g?"暫無設備":`暫無${g}設備`}):i.jsx("div",{className:"grid gap-4",children:C.map(e=>(0,i.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[A(e.type),(0,i.jsxs)("div",{children:[i.jsx("div",{className:"font-medium",children:e.name}),(0,i.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.ip&&`IP: ${e.ip}`,e.macAddress&&` • MAC: ${e.macAddress}`]}),(0,i.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[i.jsx(c.C,{variant:"outline",className:"text-xs",children:e.type.toUpperCase()}),i.jsx(c.C,{variant:"outline",className:"text-xs",children:e.connectionMethod}),e.batteryLevel&&(0,i.jsxs)(c.C,{variant:"outline",className:"text-xs",children:["電池: ",e.batteryLevel,"%"]})]})]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[z(e.status),i.jsx("span",{className:"text-sm capitalize",children:e.status})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:["discovered"===e.status&&i.jsx(l.z,{size:"sm",onClick:()=>w(e.id),disabled:s.isScanning,children:"連接"}),"connected"===e.status&&i.jsx(l.z,{size:"sm",variant:"outline",onClick:()=>N(e.id),disabled:s.isScanning,children:"斷開"})]})]})]},e.id))})})]})})]})]})}function em(){let[e,t]=(0,a.useState)(null),[u,N]=(0,a.useState)([]),[S,C]=(0,a.useState)([]),[k,z]=(0,a.useState)(!1),[A,D]=(0,a.useState)(!1),[V,T]=(0,a.useState)(null),[Z,E]=(0,a.useState)("stopped"),[I,R]=(0,a.useState)(null),[P,O]=(0,a.useState)(!1),[q,Y]=(0,a.useState)(!1),[L,F]=(0,a.useState)("all"),[U,W]=(0,a.useState)("dashboard"),[J,B]=(0,a.useState)(!1),H=async()=>{try{let e=M.getAllVideos(),t=await fetch("http://localhost:3001/api/devices"),s=e.map(e=>({id:e.id,title:e.title,category:e.country,type:"youtube",duration:e.duration,thumbnail:e.thumbnail,embedUrl:e.embedUrl,country:e.country,tags:e.tags,addedAt:e.addedAt,viewCount:e.viewCount}));if(C(s),t.ok){let e=await t.json();N(e.data)}}catch(e){C(M.getAllVideos().map(e=>({id:e.id,title:e.title,category:e.country,type:"youtube",duration:e.duration,thumbnail:e.thumbnail,embedUrl:e.embedUrl,country:e.country,tags:e.tags,addedAt:e.addedAt,viewCount:e.viewCount})))}},G=async(e,s)=>{try{let i=await fetch("http://localhost:5001/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s})}),a=await i.json();if(a.success){localStorage.setItem("token",a.token),localStorage.setItem("jwt_token",a.token);let e={id:a.user.id,email:a.user.email,username:a.user.email.split("@")[0],role:"controller"===a.user.role?"admin":"user"};t(e),localStorage.setItem("user",JSON.stringify(e)),await H()}else alert(a.message||"登錄失敗")}catch(e){alert("登錄失敗: "+e.message)}},Q=async(e,t,s)=>{try{if(t!==s){alert("密碼不匹配");return}if(t.length<6){alert("密碼至少需要6個字符");return}let i=await fetch("http://localhost:5001/api/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),a=await i.json();a.success?(alert(a.message||"註冊成功，請登錄"),B(!1)):alert(a.message||"註冊失敗")}catch(e){alert("註冊失敗: "+e.message)}},X=async()=>{try{let e={id:"guest",username:"訪客",email:"",role:"guest"};t(e),localStorage.setItem("user",JSON.stringify(e)),await H()}catch(e){alert("訪客登錄失敗: "+e.message)}},K=e=>{try{M.removeVideo(e)&&H()}catch(e){}},ee=async e=>{try{if(T(e),E("playing"),0===u.length){eu({title:"視頻播放中",description:`${e.title} 正在播放（預覽模式）`});return}let t=u.find(e=>"connected"===e.status);if(!t){eu({title:"視頻播放中",description:`${e.title} 正在播放（預覽模式）`});return}try{(await fetch("http://localhost:3001/api/play",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceId:t.id,videoId:e.id})})).ok?eu({title:"播放成功",description:`${e.title} 正在設備 ${t.name} 上播放`}):eu({title:"本地播放",description:`${e.title} 正在本地播放`})}catch(t){eu({title:"本地播放",description:`${e.title} 正在本地播放`})}}catch(e){eu({title:"播放失敗",description:"無法播放視頻，請重試",variant:"destructive"})}},et=async()=>{try{(await fetch("http://localhost:3001/api/pause",{method:"POST",headers:{"Content-Type":"application/json"}})).ok?E("paused"):alert("暫停失敗")}catch(e){alert("暫停失敗: "+e)}},es=async()=>{try{(await fetch("http://localhost:3001/api/stop",{method:"POST",headers:{"Content-Type":"application/json"}})).ok?(T(null),E("stopped")):alert("停止失敗")}catch(e){alert("停止失敗: "+e)}},ei=async e=>{let t=e.target.files?.[0];if(t)try{let e=new FormData;e.append("video",t),e.append("title",t.name),e.append("category","上傳"),e.append("description","用戶上傳的視頻文件");let s=await fetch("http://localhost:3001/api/upload",{method:"POST",body:e});s.ok?(await s.json(),await H(),alert("上傳成功: "+t.name)):alert("上傳失敗")}catch(e){alert("上傳失敗: "+e.message)}},ea=async()=>{try{let e=Date.now(),t=!1,i=0;try{(await fetch("http://localhost:5001/api/health")).ok&&(t=!0,i=Date.now()-e)}catch(e){}let a=!1;try{let{io:e}=await Promise.all([s.e(432),s.e(230)]).then(s.bind(s,7432)),t=e("http://localhost:5001",{transports:["polling","websocket"],timeout:5e3,forceNew:!0});await new Promise((e,s)=>{let i=setTimeout(()=>{s(Error("WebSocket連接超時"))},5e3);t.on("connect",()=>{clearTimeout(i),a=!0,t.disconnect(),e(!0)}),t.on("connect_error",e=>{clearTimeout(i),s(e)})})}catch(e){}let l={network:{connected:t,latency:i||0},websocket:{connected:a},webgl:{webgl1:!!document.createElement("canvas").getContext("webgl"),webgl2:!!document.createElement("canvas").getContext("webgl2")},webrtc:!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)};R(l)}catch(e){R({network:{connected:!1,latency:0},websocket:{connected:!1},webgl:{webgl1:!1,webgl2:!1},webrtc:!1,error:e instanceof Error?e.message:String(e)})}};return e?(0,i.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[i.jsx("header",{className:"bg-white shadow-sm border-b",children:i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,i.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[i.jsx(d.Z,{className:"h-8 w-8 text-blue-600"}),i.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"VR視頻管理系統"}),i.jsx(c.C,{variant:A?"default":"secondary",children:A?"已連接":"未連接"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,i.jsxs)("span",{className:"text-sm text-gray-600",children:["歡迎, ",e.username]}),i.jsx(l.z,{variant:"outline",size:"sm",onClick:()=>{localStorage.removeItem("user"),t(null)},children:"登出"})]})]})})}),i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,i.jsxs)(r.mQ,{value:U,onValueChange:W,className:"space-y-6",children:[(0,i.jsxs)(r.dr,{className:"grid w-full grid-cols-5",children:[i.jsx(r.SP,{value:"dashboard",children:"儀表板"}),i.jsx(r.SP,{value:"devices",children:"設備管理"}),i.jsx(r.SP,{value:"videos",children:"視頻管理"}),i.jsx(r.SP,{value:"control",children:"播放控制"}),i.jsx(r.SP,{value:"diagnostics",children:"系統診斷"})]}),(0,i.jsxs)(r.nU,{value:"dashboard",className:"space-y-6",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,i.jsxs)(n.Zb,{children:[(0,i.jsxs)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(n.ll,{className:"text-sm font-medium",children:"連接設備"}),i.jsx(d.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,i.jsxs)(n.aY,{children:[i.jsx("div",{className:"text-2xl font-bold",children:u.length}),(0,i.jsxs)("p",{className:"text-xs text-muted-foreground",children:[u.filter(e=>"connected"===e.status).length," 在線"]})]})]}),(0,i.jsxs)(n.Zb,{children:[(0,i.jsxs)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(n.ll,{className:"text-sm font-medium",children:"視頻庫"}),i.jsx(o.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,i.jsxs)(n.aY,{children:[i.jsx("div",{className:"text-2xl font-bold",children:S.length}),(0,i.jsxs)("p",{className:"text-xs text-muted-foreground",children:[S.filter(e=>"local"===e.type).length," 本地,"," ",S.filter(e=>"youtube"===e.type).length," YouTube"]})]})]}),(0,i.jsxs)(n.Zb,{children:[(0,i.jsxs)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(n.ll,{className:"text-sm font-medium",children:"播放狀態"}),i.jsx(h,{className:"h-4 w-4 text-muted-foreground"})]}),(0,i.jsxs)(n.aY,{children:[i.jsx("div",{className:"text-2xl font-bold capitalize",children:Z}),i.jsx("p",{className:"text-xs text-muted-foreground",children:V?V.title:"無播放內容"})]})]}),(0,i.jsxs)(n.Zb,{children:[(0,i.jsxs)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(n.ll,{className:"text-sm font-medium",children:"系統狀態"}),i.jsx(m.Z,{className:"h-4 w-4 text-green-500"})]}),(0,i.jsxs)(n.aY,{children:[i.jsx("div",{className:"text-2xl font-bold text-green-600",children:"正常"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"所有服務運行中"})]})]})]}),V&&(0,i.jsxs)(n.Zb,{children:[i.jsx(n.Ol,{children:i.jsx(n.ll,{children:"當前播放"})}),i.jsx(n.aY,{children:(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[i.jsx("img",{src:V.thumbnail||"/placeholder.svg",alt:V.title,className:"w-24 h-16 object-cover rounded"}),(0,i.jsxs)("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-semibold",children:V.title}),i.jsx("p",{className:"text-sm text-gray-600",children:V.category}),i.jsx(c.C,{variant:"outline",children:Z})]})]})})]})]}),i.jsx(r.nU,{value:"devices",className:"space-y-6",children:i.jsx(eh,{})}),(0,i.jsxs)(r.nU,{value:"videos",className:"space-y-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[i.jsx("h2",{className:"text-2xl font-bold",children:"視頻管理"}),(0,i.jsxs)("div",{className:"space-x-2",children:[(0,i.jsxs)(l.z,{variant:"outline",onClick:()=>Y(!0),className:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100",children:[i.jsx(x,{className:"mr-2 h-4 w-4"}),"搜索YouTube VR影片"]}),i.jsx("input",{type:"file",accept:"video/*",onChange:ei,className:"hidden",id:"video-upload"}),(0,i.jsxs)(l.z,{onClick:()=>document.getElementById("video-upload")?.click(),children:[i.jsx(p,{className:"mr-2 h-4 w-4"}),"上傳視頻"]})]})]}),(0,i.jsxs)("div",{className:"flex flex-wrap gap-2",children:[i.jsx(l.z,{variant:"outline",size:"sm",onClick:()=>{F("all"),H()},className:`${"all"===L?"bg-blue-50 border-blue-200 text-blue-700":""}`,children:"全部"}),["亞洲","歐洲","中東","非洲","北美洲","南美洲","大洋洲","北極","南極"].map(e=>i.jsx(l.z,{variant:"outline",size:"sm",onClick:()=>{F(e),C(M.getAllVideos().filter(t=>t.country===e).map(e=>({id:e.id,title:e.title,category:e.country,type:"youtube",duration:e.duration,thumbnail:e.thumbnail,embedUrl:e.embedUrl,country:e.country,tags:e.tags,addedAt:e.addedAt,viewCount:e.viewCount})))},className:`${L===e?"bg-blue-50 border-blue-200 text-blue-700":""}`,children:e},e))]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(e=>(0,i.jsxs)(n.Zb,{className:"hover:shadow-md transition-shadow",children:[i.jsx(n.Ol,{className:"p-4",children:(0,i.jsxs)("div",{className:"relative",children:[i.jsx("img",{src:e.thumbnail||"/placeholder.svg",alt:e.title,className:"w-full h-32 object-cover rounded"}),"youtube"===e.type&&i.jsx(c.C,{className:"absolute top-2 right-2 bg-red-600",children:"YouTube"}),void 0!==e.viewCount&&e.viewCount>0&&(0,i.jsxs)("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded",children:["\uD83D\uDC41 ",e.viewCount]})]})}),(0,i.jsxs)(n.aY,{className:"p-4",children:[i.jsx("h3",{className:"font-semibold mb-2 line-clamp-2 text-sm",children:e.title}),(0,i.jsxs)("div",{className:"space-y-1 text-xs text-gray-600",children:[(0,i.jsxs)("p",{children:["地區: ",e.category]}),(0,i.jsxs)("p",{children:["時長: ",e.duration]}),(0,i.jsxs)("p",{children:["類型: ","youtube"===e.type?"YouTube 360\xb0":"本地文件"]}),e.addedAt&&(0,i.jsxs)("p",{children:["添加: ",new Date(e.addedAt).toLocaleDateString()]}),e.tags&&e.tags.length>0&&i.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:e.tags.slice(0,3).map((e,t)=>i.jsx(c.C,{variant:"outline",className:"text-xs",children:e},t))})]}),(0,i.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,i.jsxs)(l.z,{size:"sm",onClick:()=>{ee(e),W("control")},className:"flex-1",children:[i.jsx(g.Z,{className:"mr-1 h-3 w-3"}),"播放"]}),"youtube"===e.type&&i.jsx(l.z,{size:"sm",variant:"outline",onClick:()=>K(e.id),className:"text-red-600 hover:text-red-700",children:i.jsx(j,{className:"h-3 w-3"})})]})]})]},e.id))}),0===S.length&&i.jsx(n.Zb,{children:(0,i.jsxs)(n.aY,{className:"text-center py-12",children:[i.jsx(o.Z,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"沒有YouTube VR影片"}),i.jsx("p",{className:"text-gray-600 mb-4",children:"請搜索並添加YouTube VR/360度旅遊影片"}),(0,i.jsxs)(l.z,{onClick:()=>Y(!0),className:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100",children:[i.jsx(x,{className:"mr-2 h-4 w-4"}),"搜索YouTube VR影片"]})]})})]}),(0,i.jsxs)(r.nU,{value:"control",className:"space-y-6",children:[(0,i.jsxs)(n.Zb,{children:[(0,i.jsxs)(n.Ol,{children:[i.jsx(n.ll,{children:"播放控制面板"}),i.jsx(n.SZ,{children:"控制所有連接設備的視頻播放"})]}),(0,i.jsxs)(n.aY,{children:[(0,i.jsxs)("div",{className:"flex justify-center space-x-4 mb-6",children:[i.jsx(l.z,{size:"lg",disabled:!V||0===u.length,onClick:()=>"playing"===Z?et():V&&ee(V),children:"playing"===Z?(0,i.jsxs)(i.Fragment,{children:[i.jsx(v.Z,{className:"mr-2 h-5 w-5"}),"暫停"]}):(0,i.jsxs)(i.Fragment,{children:[i.jsx(g.Z,{className:"mr-2 h-5 w-5"}),"播放"]})}),(0,i.jsxs)(l.z,{size:"lg",variant:"outline",disabled:!V,onClick:es,children:[i.jsx(b.Z,{className:"mr-2 h-5 w-5"}),"停止"]}),(0,i.jsxs)(l.z,{size:"lg",variant:"destructive",disabled:0===u.length,onClick:()=>{es()},children:[i.jsx(y.Z,{className:"mr-2 h-5 w-5"}),"緊急停止"]})]}),V&&(0,i.jsxs)("div",{className:"text-center",children:[i.jsx("h3",{className:"text-lg font-semibold mb-2",children:V.title}),i.jsx(c.C,{variant:"outline",children:Z})]}),0===u.length&&i.jsx("div",{className:"text-center text-gray-500",children:i.jsx("p",{children:"請先連接VR設備才能進行播放控制"})})]})]}),(0,i.jsxs)(n.Zb,{children:[(0,i.jsxs)(n.Ol,{children:[(0,i.jsxs)(n.ll,{className:"flex items-center gap-2",children:[i.jsx(f.Z,{className:"h-5 w-5"}),"VR旅遊團同步播放"]}),i.jsx(n.SZ,{children:"創建旅遊團，與朋友一起同步觀看VR 360度旅遊視頻"})]}),(0,i.jsxs)(n.aY,{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,i.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[i.jsx(w.Z,{className:"h-8 w-8 text-blue-600 mx-auto mb-2"}),i.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u.length}),i.jsx("div",{className:"text-sm text-blue-600",children:"連接設備"})]}),(0,i.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[i.jsx(o.Z,{className:"h-8 w-8 text-green-600 mx-auto mb-2"}),i.jsx("div",{className:"text-2xl font-bold text-green-600",children:S.length}),i.jsx("div",{className:"text-sm text-green-600",children:"可用視頻"})]}),(0,i.jsxs)("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[i.jsx(f.Z,{className:"h-8 w-8 text-purple-600 mx-auto mb-2"}),i.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"0"}),i.jsx("div",{className:"text-sm text-purple-600",children:"活躍旅遊團"})]})]}),(0,i.jsxs)("div",{className:"flex flex-wrap gap-3 justify-center",children:[(0,i.jsxs)(l.z,{size:"lg",onClick:()=>Y(!0),className:"bg-blue-600 hover:bg-blue-700",children:[i.jsx(x,{className:"mr-2 h-4 w-4"}),"搜索旅遊視頻"]}),(0,i.jsxs)(l.z,{size:"lg",variant:"outline",onClick:()=>{eu({title:"旅遊團功能",description:"VR旅遊團功能已整合到現有系統中"})},children:[i.jsx(w.Z,{className:"mr-2 h-4 w-4"}),"創建旅遊團"]}),(0,i.jsxs)(l.z,{size:"lg",variant:"outline",disabled:!V,onClick:()=>{V&&eu({title:"開始旅遊團",description:`已選擇視頻: ${V.title}`})},children:[i.jsx(g.Z,{className:"mr-2 h-4 w-4"}),"開始同步播放"]})]}),(0,i.jsxs)("div",{className:"text-center text-sm text-gray-600 bg-gray-50 p-4 rounded-lg",children:[i.jsx("p",{className:"font-medium mb-2",children:"\uD83D\uDCA1 VR旅遊團功能說明"}),i.jsx("p",{children:"• 搜索並選擇VR 360度旅遊視頻"}),i.jsx("p",{children:"• 創建旅遊團邀請朋友加入"}),i.jsx("p",{children:"• 所有參與者同步觀看同一視頻"}),i.jsx("p",{children:"• 支持實時聊天和互動"})]})]})]}),V&&"youtube"===V.type&&V.embedUrl&&i.jsx(_,{videoId:V.id,title:V.title,embedUrl:V.embedUrl,onPlay:()=>E("playing"),onPause:()=>E("paused"),onStop:()=>E("stopped"),isPlaying:"playing"===Z})]}),(0,i.jsxs)(r.nU,{value:"diagnostics",className:"space-y-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[i.jsx("h2",{className:"text-2xl font-bold",children:"系統診斷"}),(0,i.jsxs)(l.z,{onClick:ea,children:[i.jsx(h,{className:"mr-2 h-4 w-4"}),"運行診斷"]})]}),I&&(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,i.jsxs)(n.Zb,{children:[i.jsx(n.Ol,{children:i.jsx(n.ll,{children:"網絡連接"})}),i.jsx(n.aY,{children:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[i.jsx("span",{children:"API連接:"}),i.jsx(c.C,{variant:I.network.connected?"default":"destructive",children:I.network.connected?"正常":"異常"})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[i.jsx("span",{children:"延遲:"}),(0,i.jsxs)("span",{children:[I.network.latency,"ms"]})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[i.jsx("span",{children:"WebSocket:"}),i.jsx(c.C,{variant:I.websocket.connected?"default":"destructive",children:I.websocket.connected?"正常":"異常"})]})]})})]}),(0,i.jsxs)(n.Zb,{children:[i.jsx(n.Ol,{children:i.jsx(n.ll,{children:"瀏覽器支持"})}),i.jsx(n.aY,{children:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[i.jsx("span",{children:"WebGL 1.0:"}),i.jsx(c.C,{variant:I.webgl.webgl1?"default":"secondary",children:I.webgl.webgl1?"支持":"不支持"})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[i.jsx("span",{children:"WebGL 2.0:"}),i.jsx(c.C,{variant:I.webgl.webgl2?"default":"secondary",children:I.webgl.webgl2?"支持":"不支持"})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[i.jsx("span",{children:"WebRTC:"}),i.jsx(c.C,{variant:I.webrtc?"default":"secondary",children:I.webrtc?"支持":"不支持"})]})]})})]})]})]})]})}),q&&i.jsx($,{onVideoSelected:e=>{try{H(),eu({title:"視頻已添加",description:`${e.title} 已自動分類到 ${e.category} 並存儲到本地`})}catch(e){eu({title:"處理失敗",description:"無法處理選中的YouTube影片",variant:"destructive"})}},onClose:()=>Y(!1)})]}):i.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:(0,i.jsxs)(n.Zb,{className:"w-full max-w-md",children:[(0,i.jsxs)(n.Ol,{className:"text-center",children:[i.jsx(n.ll,{className:"text-2xl font-bold text-gray-900",children:"VR視頻管理系統"}),i.jsx(n.SZ,{children:J?"創建新帳戶":"請登錄或以訪客身份繼續"})]}),i.jsx(n.aY,{className:"space-y-4",children:J?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-2",children:[i.jsx("input",{type:"email",placeholder:"郵箱地址",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",id:"register-email"}),i.jsx("input",{type:"password",placeholder:"密碼（至少6個字符）",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",id:"register-password"}),i.jsx("input",{type:"password",placeholder:"確認密碼",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",id:"register-confirm-password"})]}),i.jsx(l.z,{className:"w-full",onClick:()=>{Q(document.getElementById("register-email").value,document.getElementById("register-password").value,document.getElementById("register-confirm-password").value)},children:"註冊"}),i.jsx("div",{className:"text-center",children:i.jsx(l.z,{variant:"link",className:"text-blue-600 hover:text-blue-800",onClick:()=>B(!1),children:"已有帳戶？點擊登錄"})})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-2",children:[i.jsx("input",{type:"email",placeholder:"郵箱地址",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",id:"login-email"}),i.jsx("input",{type:"password",placeholder:"密碼",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",id:"login-password"})]}),i.jsx(l.z,{className:"w-full",onClick:()=>{G(document.getElementById("login-email").value,document.getElementById("login-password").value)},children:"登錄"}),i.jsx(l.z,{variant:"outline",className:"w-full bg-transparent",onClick:X,children:"訪客模式"}),i.jsx("div",{className:"text-center",children:i.jsx(l.z,{variant:"link",className:"text-blue-600 hover:text-blue-800",onClick:()=>B(!0),children:"沒有帳戶？點擊註冊"})})]})})]})})}},908:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});let i=(0,s(8570).createProxy)(String.raw`/Users/luoyumin/VR3/Yumi/app/page.tsx#default`)}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),i=t.X(0,[276,216,97,387],()=>s(5826));module.exports=i})();