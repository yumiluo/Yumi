(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[350],{9879:function(e,s,t){Promise.resolve().then(t.bind(t,703))},703:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return ec}});var a=t(7437),n=t(2265),l=t(6070),i=t(5974),r=t(2869),c=t(9374),d=t(1671),o=t(535),m=t(4508);let x=(0,o.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),u=n.forwardRef((e,s)=>{let{className:t,variant:n,...l}=e;return(0,a.jsx)("div",{ref:s,role:"alert",className:(0,m.cn)(x({variant:n}),t),...l})});u.displayName="Alert",n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("h5",{ref:s,className:(0,m.cn)("mb-1 font-medium leading-none tracking-tight",t),...n})}).displayName="AlertTitle";let h=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:(0,m.cn)("text-sm [&_p]:leading-relaxed",t),...n})});h.displayName="AlertDescription";var j=t(5186),f=t(6394);let p=(0,o.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),g=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(f.f,{ref:s,className:(0,m.cn)(p(),t),...n})});g.displayName=f.f.displayName;var v=t(9322),N=t(9202),b=t(9397),w=t(1817),y=t(1047),D=t(8867),Z=t(5805),C=t(3276),S=t(9227),k=t(1094),R=t(9897),T=t(5398),z=t(8680),M=t(3464),F=t(2339),O=t(3519),I=t(2489);let W=O.fC,Y=O.xz,Q=O.h_;O.x8;let E=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(O.aV,{ref:s,className:(0,m.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...n})});E.displayName=O.aV.displayName;let A=n.forwardRef((e,s)=>{let{className:t,children:n,...l}=e;return(0,a.jsxs)(Q,{children:[(0,a.jsx)(E,{}),(0,a.jsxs)(O.VY,{ref:s,className:(0,m.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...l,children:[n,(0,a.jsxs)(O.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(I.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});A.displayName=O.VY.displayName;let V=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,m.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};V.displayName="DialogHeader";let P=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(O.Dx,{ref:s,className:(0,m.cn)("text-lg font-semibold leading-none tracking-tight",t),...n})});P.displayName=O.Dx.displayName;let U=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(O.dk,{ref:s,className:(0,m.cn)("text-sm text-muted-foreground",t),...n})});U.displayName=O.dk.displayName;var _=t(3388),L=t(2926),q=t(7404),H=t(2759),B=t(3420),G=t(6865),J=t(9388),X=t(2431),$=t(4988);let K=e=>{let{onDeviceConnected:s,onDeviceDisconnected:t}=e,[c,o]=(0,n.useState)(!1),[m,x]=(0,n.useState)([]),[j,f]=(0,n.useState)([]),[p,g]=(0,n.useState)(null),[v,b]=(0,n.useState)(0),[w,y]=(0,n.useState)(""),[D,Z]=(0,n.useState)(!0);(0,n.useEffect)(()=>{(()=>{if(!navigator.onLine){Z(!1),g("設備當前離線，無法進行Wi-Fi掃描");return}"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||window.location.hostname.startsWith("192.168.")||window.location.hostname.startsWith("10.")||window.location.hostname.startsWith("172.")?(Z(!0),y(window.location.hostname)):(Z(!0),y("未知網絡"))})()},[]);let C=()=>{let e=[];if(e.push("localhost"),e.push("127.0.0.1"),window.location.hostname.startsWith("192.168.")){let s=window.location.hostname.split(".").slice(0,3).join(".");e.push(s)}return e.push("192.168.0","192.168.1","192.168.2","192.168.10","192.168.31","192.168.100","10.0.0","10.0.1","172.16.0","172.16.1","172.20.0","172.20.1"),Array.from(new Set(e))},S=async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5001;try{let t=new AbortController,a=setTimeout(()=>t.abort(),3e3),n=await fetch("http://".concat(e,":").concat(s,"/api/health"),{method:"GET",signal:t.signal,headers:{Accept:"application/json","Content-Type":"application/json"}});if(clearTimeout(a),n.ok){let t=await n.json();return{id:"".concat(e,"-").concat(s),name:t.deviceName||"設備 ".concat(e),ip:e,port:s,status:"available",deviceType:t.deviceType||"unknown",lastSeen:new Date().toLocaleString(),responseTime:Date.now()%100+50,deviceModel:t.deviceModel}}}catch(e){var t,a;"AbortError"===e.name||(null===(t=e.message)||void 0===t?void 0:t.includes("CORS"))||null===(a=e.message)||void 0===a||a.includes("Failed to fetch")}return null},k=(0,n.useCallback)(async()=>{if(!D){g("網絡不支持Wi-Fi掃描");return}o(!0),g(null),x([]),b(0);try{let e=C(),s=[];e.forEach(e=>{if("localhost"===e||"127.0.0.1"===e)s.push(e);else{let t=[1,2,10,100,200,207,254,255];t.forEach(t=>s.push("".concat(e,".").concat(t)));for(let a=1;a<=50;a++)t.includes(a)||s.push("".concat(e,".").concat(a))}});let t=[],a=0;for(let e=0;e<s.length;e+=10){let n=s.slice(e,e+10).map(async e=>{let t=await S(e,5001);return a++,b(a/s.length*100),t});(await Promise.allSettled(n)).forEach(e=>{"fulfilled"===e.status&&e.value&&t.push(e.value)}),await new Promise(e=>setTimeout(e,100))}x(t),0===t.length&&g("未找到設備，請確保在同一Wi-Fi網絡中，且後端服務正在運行在端口5001")}catch(e){g("掃描失敗: ".concat(e.message||"未知錯誤"))}finally{o(!1),b(0)}},[D]),T=async e=>{try{g(null),x(s=>s.map(s=>s.id===e.id?{...s,status:"connecting"}:s)),await new Promise(e=>setTimeout(e,2e3));let t={...e,status:"connected",lastSeen:new Date().toLocaleString()};f(e=>[...e,t]),x(s=>s.filter(s=>s.id!==e.id)),s(t)}catch(s){g("連接設備失敗。請重試。"),x(s=>s.map(s=>s.id===e.id?{...s,status:"available"}:s))}},z=async e=>{try{f(s=>s.filter(s=>s.id!==e)),t(e)}catch(e){g("斷開連接失敗。")}},M=e=>["quest","vive","pico","oculus","valve","index","varjo","vr","virtual","reality","headset","hmd"].some(s=>e.toLowerCase().includes(s)),F=e=>["iphone","samsung","galaxy","xiaomi","mi","huawei","honor","oppo","oneplus","vivo","realme","motorola","lg","sony","nokia","blackberry","mobile","phone","smartphone"].some(s=>e.toLowerCase().includes(s)),O=e=>{let s=e.name.toLowerCase();if(e.deviceModel)return"\uD83D\uDCF1 ".concat(e.deviceModel);if(s.includes("iphone"))return"\uD83D\uDCF1 ".concat(e.name," (iPhone)");if(s.includes("samsung")||s.includes("galaxy"))return"\uD83D\uDCF1 ".concat(e.name," (Samsung)");if(s.includes("xiaomi")||s.includes("mi "))return"\uD83D\uDCF1 ".concat(e.name," (小米)");if(s.includes("huawei")||s.includes("honor"))return"\uD83D\uDCF1 ".concat(e.name," (華為)");if(s.includes("oppo")||s.includes("oneplus"))return"\uD83D\uDCF1 ".concat(e.name," (OPPO)");if(s.includes("vivo"))return"\uD83D\uDCF1 ".concat(e.name," (vivo)");if(s.includes("realme"))return"\uD83D\uDCF1 ".concat(e.name," (realme)");return M(e.name)?"\uD83E\uDD7D ".concat(e.name," (VR設備)"):"\uD83D\uDD17 ".concat(e.name)},I=e=>"vr"===e.deviceType||M(e.name)?(0,a.jsx)(R.Z,{className:"h-5 w-5 text-blue-600"}):"mobile"===e.deviceType||F(e.name)?(0,a.jsx)(_.Z,{className:"h-5 w-5 text-green-600"}):(0,a.jsx)(B.Z,{className:"h-5 w-5 text-purple-600"}),W=e=>e<100?"text-green-600":e<500?"text-yellow-600":"text-red-600";return D?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(l.Zb,{className:"border-blue-200 bg-blue-50",children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsxs)(l.ll,{className:"flex items-center gap-2 text-blue-800",children:[(0,a.jsx)(N.Z,{className:"h-5 w-5"}),"\uD83C\uDF10 Wi-Fi網絡連接指南"]}),(0,a.jsx)(l.SZ,{className:"text-blue-700",children:"按照以下步驟連接你的設備到VR系統"})]}),(0,a.jsxs)(l.aY,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-semibold text-blue-800",children:"步驟 1: 確保在同一網絡"}),(0,a.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,a.jsx)("li",{children:"• 確保所有設備連接到同一Wi-Fi"}),(0,a.jsx)("li",{children:"• 檢查後端服務是否運行"}),(0,a.jsx)("li",{children:"• 確認防火牆允許端口5001"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-semibold text-blue-800",children:"步驟 2: 掃描並連接"}),(0,a.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,a.jsx)("li",{children:'• 點擊下方"開始Wi-Fi掃描"'}),(0,a.jsx)("li",{children:"• 系統會自動掃描本地網絡"}),(0,a.jsx)("li",{children:"• 選擇要連接的設備"})]})]})]}),(0,a.jsxs)("div",{className:"bg-blue-100 p-3 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-semibold text-blue-800 mb-2",children:"\uD83D\uDCA1 當前網絡信息"}),(0,a.jsxs)("div",{className:"text-sm text-blue-700 space-y-1",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"當前網絡:"})," ",w]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"掃描範圍:"})," 常見本地IP範圍 (192.168.x.x, 10.x.x.x, 172.x.x.x)"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"目標端口:"})," 5001 (後端服務端口)"]})]})]})]})]}),(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(L.Z,{className:"h-5 w-5"}),"Wi-Fi網絡狀態"]})}),(0,a.jsx)(l.aY,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[D?(0,a.jsx)(d.Z,{className:"h-5 w-5 text-green-600"}):(0,a.jsx)(J.Z,{className:"h-5 w-5 text-red-600"}),(0,a.jsx)("span",{className:D?"text-green-600":"text-red-600",children:D?"網絡可用":"網絡不可用"})]}),(0,a.jsxs)(r.z,{onClick:k,disabled:c||!D,className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700",children:[c?(0,a.jsx)(X.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(L.Z,{className:"h-4 w-4"}),c?"掃描中...":"\uD83D\uDE80 快速掃描"]})]})})]}),c&&(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(X.Z,{className:"h-5 w-5 animate-spin"}),"掃描進度"]})}),(0,a.jsx)(l.aY,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(H.E,{value:v,className:"w-full"}),(0,a.jsxs)("div",{className:"text-center text-sm text-gray-600",children:["正在掃描本地網絡... ",Math.round(v),"%"]}),(0,a.jsx)("div",{className:"text-xs text-gray-500 text-center",children:"快速掃描約需5秒，請耐心等待"})]})})]}),p&&(0,a.jsxs)(u,{className:"border-red-200 bg-red-50",children:[(0,a.jsx)(G.Z,{className:"h-4 w-4 text-red-600"}),(0,a.jsxs)(h,{className:"text-red-800",children:[p,(0,a.jsx)(r.z,{variant:"outline",size:"sm",onClick:()=>g(null),className:"ml-2 mt-2",children:"關閉"})]})]}),j.length>0&&(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"h-5 w-5 text-green-600"}),"已連接設備 (",j.length,")"]})}),(0,a.jsx)(l.aY,{children:(0,a.jsx)("div",{className:"space-y-3",children:j.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-green-50",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[I(e),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:O(e)}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[e.ip,":",e.port]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(i.C,{variant:"default",className:"bg-green-600",children:"已連接"}),(0,a.jsx)(r.z,{variant:"outline",size:"sm",onClick:()=>z(e.id),children:"斷開"})]})]},e.id))})})]}),m.length>0&&(0,a.jsxs)(l.Zb,{children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(L.Z,{className:"h-5 w-5 text-blue-600"}),"發現的設備 (",m.length,")"]}),(0,a.jsx)(l.SZ,{children:"點擊設備進行連接"})]}),(0,a.jsx)(l.aY,{children:(0,a.jsx)("div",{className:"space-y-3",children:m.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>"available"===e.status&&T(e),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[I(e),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:O(e)}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[e.ip,":",e.port]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)($.Z,{className:"h-4 w-4 ".concat(W(e.responseTime))}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[e.responseTime,"ms"]})]}),(0,a.jsx)(i.C,{variant:"outline",children:"vr"===e.deviceType?"\uD83E\uDD7D VR設備":"mobile"===e.deviceType?"\uD83D\uDCF1 手機":"\uD83D\uDD17 其他設備"}),(0,a.jsx)(r.z,{size:"sm",disabled:"connecting"===e.status,children:"connecting"===e.status?"連接中...":"連接"})]})]},e.id))})})]}),!c&&0===m.length&&0===j.length&&!p&&(0,a.jsx)(l.Zb,{children:(0,a.jsxs)(l.aY,{className:"text-center py-8",children:[(0,a.jsx)(L.Z,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"未發現Wi-Fi設備"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:'點擊"快速掃描"來發現同一網絡中的VR設備和手機'}),(0,a.jsxs)(r.z,{onClick:k,disabled:!D,children:[(0,a.jsx)(L.Z,{className:"mr-2 h-4 w-4"}),"快速掃描"]})]})})]}):(0,a.jsxs)(u,{className:"border-red-200 bg-red-50",children:[(0,a.jsx)(G.Z,{className:"h-4 w-4 text-red-600"}),(0,a.jsx)(h,{className:"text-red-800",children:"您的設備當前離線，無法進行Wi-Fi掃描。請檢查網絡連接。"})]})};var ee=t(3581),es=t(9801),et=t.n(es);let ea=e=>{let{onDeviceJoined:s}=e,[t,c]=(0,n.useState)(!1),[o,m]=(0,n.useState)(null),[x,j]=(0,n.useState)(null),[f,p]=(0,n.useState)(!1),g=(0,n.useRef)(null),v=(0,n.useRef)(null),N=(0,n.useRef)(null);(0,n.useEffect)(()=>{(async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){p(!1),j("您的瀏覽器不支持相機功能");return}(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(e=>e.stop()),p(!0)}catch(e){p(!1),j("無法訪問相機。請確保已授予相機權限。")}})()},[]);let b=async()=>{if(!f){j("相機不可用");return}try{c(!0),j(null),m(null);let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});N.current=e,g.current&&(g.current.srcObject=e,g.current.play()),requestAnimationFrame(y)}catch(e){"NotAllowedError"===e.name?j("相機權限被拒絕。請允許瀏覽器訪問相機。"):"NotFoundError"===e.name?j("未找到相機設備。"):j("啟動相機失敗: ".concat(e.message)),c(!1)}},w=()=>{c(!1),N.current&&(N.current.getTracks().forEach(e=>e.stop()),N.current=null),g.current&&(g.current.srcObject=null)},y=()=>{if(t&&g.current&&v.current)try{let e=g.current,s=v.current,a=s.getContext("2d");if(!a)return;s.width=e.videoWidth,s.height=e.videoHeight,a.drawImage(e,0,0,s.width,s.height);let n=a.getImageData(0,0,s.width,s.height);if(D(n))return;t&&requestAnimationFrame(y)}catch(e){}},D=e=>{try{let s=et()(e.data,e.width,e.height);if(s)return Z(s.data),!0;return!1}catch(e){return!1}},Z=e=>{try{m(e),w();let t=new URL(e),a=t.searchParams.get("code"),n=t.searchParams.get("device"),l=t.searchParams.get("type");if(a&&n&&l){let e={id:n,name:"".concat(l.toUpperCase()," Device"),type:l};s(e)}else j("無效的QR碼格式")}catch(e){j("無法解析QR碼")}};return((0,n.useEffect)(()=>()=>{N.current&&N.current.getTracks().forEach(e=>e.stop())},[]),f)?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(l.Zb,{children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(q.Z,{className:"h-5 w-5"}),"QR碼掃描器"]}),(0,a.jsx)(l.SZ,{children:"掃描設備上的QR碼來連接設備"})]}),(0,a.jsx)(l.aY,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[t&&(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("video",{ref:g,className:"w-full h-64 object-cover rounded-lg border",autoPlay:!0,playsInline:!0,muted:!0}),(0,a.jsx)("canvas",{ref:v,className:"hidden"}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)("div",{className:"border-2 border-blue-500 border-dashed w-48 h-48 rounded-lg flex items-center justify-center",children:(0,a.jsx)(q.Z,{className:"h-12 w-12 text-blue-500 opacity-50"})})})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[t?(0,a.jsxs)(r.z,{onClick:w,variant:"outline",className:"flex items-center gap-2",children:[(0,a.jsx)(J.Z,{className:"h-4 w-4"}),"停止掃描"]}):(0,a.jsxs)(r.z,{onClick:b,className:"flex items-center gap-2",children:[(0,a.jsx)(ee.Z,{className:"h-4 w-4"}),"開始掃描"]}),(0,a.jsxs)(r.z,{onClick:()=>{let e=prompt("請輸入設備連接代碼:");e&&Z("https://yourapp.com/join?code=".concat(e,"&device=MANUAL&type=vr"))},variant:"outline",className:"flex items-center gap-2",children:[(0,a.jsx)(_.Z,{className:"h-4 w-4"}),"手動輸入"]})]}),t&&(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"animate-pulse text-blue-600",children:"正在掃描QR碼..."}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"將QR碼對準掃描框"})]})]})})]}),o&&(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"h-5 w-5 text-green-600"}),"掃描成功"]})}),(0,a.jsx)(l.aY,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[(0,a.jsx)("div",{className:"font-medium text-green-800",children:"QR碼數據:"}),(0,a.jsx)("div",{className:"text-sm text-green-700 break-all",children:o})]}),(0,a.jsx)(i.C,{variant:"default",className:"bg-green-600",children:"設備已連接"})]})})]}),x&&(0,a.jsxs)(u,{className:"border-red-200 bg-red-50",children:[(0,a.jsx)(G.Z,{className:"h-4 w-4 text-red-600"}),(0,a.jsxs)(h,{className:"text-red-800",children:[x,(0,a.jsx)(r.z,{variant:"outline",size:"sm",onClick:()=>j(null),className:"ml-2 mt-2",children:"關閉"})]})]}),(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)(l.ll,{children:"使用說明"})}),(0,a.jsx)(l.aY,{children:(0,a.jsxs)("div",{className:"space-y-2 text-sm text-gray-600",children:[(0,a.jsx)("p",{children:'• 點擊"開始掃描"啟動相機'}),(0,a.jsx)("p",{children:"• 將設備上的QR碼對準掃描框"}),(0,a.jsx)("p",{children:"• 掃描成功後設備將自動連接"}),(0,a.jsx)("p",{children:'• 如果掃描失敗，可以使用"手動輸入"功能'})]})})]})]}):(0,a.jsxs)(u,{className:"border-red-200 bg-red-50",children:[(0,a.jsx)(G.Z,{className:"h-4 w-4 text-red-600"}),(0,a.jsx)(h,{className:"text-red-800",children:"您的瀏覽器不支持相機功能。請使用支持相機的瀏覽器或設備。"})]})};var en=t(1723);let el=e=>{let{sessionCode:s,onDeviceConnected:t,onDeviceDisconnected:c}=e,[o,m]=(0,n.useState)(null),[x,j]=(0,n.useState)(!1),[f,p]=(0,n.useState)([]),[g,v]=(0,n.useState)(null),[N,b]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=(0,z.io)("http://localhost:5001",{transports:["polling","websocket"],timeout:1e4,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,forceNew:!0});return e.on("connect",()=>{j(!0),v(null),b(!1),s&&e.emit("get-session-devices",{sessionCode:s})}),e.on("disconnect",()=>{j(!1),v("與服務器斷開連接")}),e.on("connect_error",e=>{v("連接錯誤: ".concat(e.message)),b(!1)}),e.on("device-joined",e=>{let s={id:e.deviceId,name:e.deviceName||"Unknown Device",type:e.deviceType||"unknown",model:e.deviceModel||"Unknown Model",connectionMethod:e.connectionMethod||"network",status:"connected",lastSeen:new Date().toLocaleString(),ip:e.ip,port:e.port,responseTime:e.responseTime};p(e=>{let t=e.findIndex(e=>e.id===s.id);if(!(t>=0))return[...e,s];{let a=[...e];return a[t]={...a[t],...s},a}}),null==t||t(s)}),e.on("device-left",e=>{p(s=>s.filter(s=>s.id!==e.deviceId)),null==c||c(e.deviceId)}),e.on("session-state",e=>{}),e.on("session-devices",e=>{e.devices&&Array.isArray(e.devices)&&p(e.devices.map(e=>({id:e.deviceId,name:e.deviceName||"Unknown Device",type:e.deviceType||"unknown",model:e.deviceModel||"Unknown Model",connectionMethod:e.connectionMethod||"network",status:e.status||"connected",lastSeen:new Date(e.lastSeen).toLocaleString(),ip:e.ip,port:e.port,responseTime:e.responseTime})))}),m(e),()=>{e.close()}},[t,c,s]),(0,n.useEffect)(()=>{o&&x&&s&&o.emit("get-session-devices",{sessionCode:s})},[o,x,s]);let w=e=>{switch(e.type){case"vr":return(0,a.jsx)(R.Z,{className:"h-5 w-5 text-blue-600"});case"mobile":return(0,a.jsx)(_.Z,{className:"h-5 w-5 text-green-600"});case"desktop":return(0,a.jsx)(B.Z,{className:"h-5 w-5 text-purple-600"});default:return(0,a.jsx)(B.Z,{className:"h-5 w-5 text-gray-600"})}},y=e=>{switch(e){case"wifi":return(0,a.jsx)(i.C,{variant:"outline",className:"border-blue-200 text-blue-700",children:"Wi-Fi"});case"qr":return(0,a.jsx)(i.C,{variant:"outline",className:"border-green-200 text-green-700",children:"QR碼"});case"network":return(0,a.jsx)(i.C,{variant:"outline",className:"border-purple-200 text-purple-700",children:"網絡"});default:return(0,a.jsx)(i.C,{variant:"outline",children:"未知"})}},D=e=>{switch(e){case"connected":return(0,a.jsx)(i.C,{variant:"default",className:"bg-green-600",children:"已連接"});case"disconnected":return(0,a.jsx)(i.C,{variant:"destructive",children:"已斷開"});case"playing":return(0,a.jsx)(i.C,{variant:"default",className:"bg-blue-600",children:"播放中"});case"paused":return(0,a.jsx)(i.C,{variant:"outline",children:"已暫停"});case"error":return(0,a.jsx)(i.C,{variant:"destructive",children:"錯誤"});default:return(0,a.jsx)(i.C,{variant:"outline",children:"未知"})}},Z=e=>e.model&&"Unknown Model"!==e.model?"".concat(e.name," (").concat(e.model,")"):e.name,C=e=>e?e<100?"text-green-600":e<500?"text-yellow-600":"text-red-600":"text-gray-600",S=e=>{o&&s&&o.emit("disconnect-device",{sessionCode:s,deviceId:e})};return N?(0,a.jsx)(l.Zb,{children:(0,a.jsx)(l.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"正在連接設備管理服務..."})]})})}):x?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)($.Z,{className:"h-5 w-5"}),"設備管理狀態"]})}),(0,a.jsxs)(l.aY,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[x?(0,a.jsx)(d.Z,{className:"h-5 w-5 text-green-600"}):(0,a.jsx)(J.Z,{className:"h-5 w-5 text-red-600"}),(0,a.jsx)("span",{className:x?"text-green-600":"text-red-600",children:x?"已連接":"未連接"})]}),(0,a.jsxs)(r.z,{onClick:()=>{o&&s&&o.emit("get-session-devices",{sessionCode:s})},variant:"outline",size:"sm",className:"flex items-center gap-2",children:[(0,a.jsx)(en.Z,{className:"h-4 w-4"}),"刷新列表"]})]}),s&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:["當前會話: ",s]})]})]}),g&&(0,a.jsxs)(u,{className:"border-red-200 bg-red-50",children:[(0,a.jsx)(G.Z,{className:"h-4 w-4 text-red-600"}),(0,a.jsx)(h,{className:"text-red-800",children:g})]}),f.length>0?(0,a.jsxs)(l.Zb,{children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Z,{className:"h-5 w-5 text-green-600"}),"已連接設備 (",f.length,")"]}),(0,a.jsx)(l.SZ,{children:"當前會話中連接的真實設備"})]}),(0,a.jsx)(l.aY,{children:(0,a.jsx)("div",{className:"space-y-3",children:f.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-green-50 hover:bg-green-100 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[w(e),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-green-800",children:Z(e)}),(0,a.jsxs)("div",{className:"text-sm text-green-700",children:["連接方式: ","wifi"===e.connectionMethod?"Wi-Fi":"qr"===e.connectionMethod?"QR碼":"網絡"]}),e.ip&&e.port&&(0,a.jsxs)("div",{className:"text-xs text-green-600",children:[e.ip,":",e.port]}),e.responseTime&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,a.jsx)($.Z,{className:"h-3 w-3 ".concat(C(e.responseTime))}),(0,a.jsxs)("span",{className:C(e.responseTime),children:[e.responseTime,"ms"]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[y(e.connectionMethod),D(e.status),(0,a.jsx)("div",{className:"text-xs text-green-600",children:e.lastSeen}),(0,a.jsx)(r.z,{variant:"outline",size:"sm",onClick:()=>S(e.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:"斷開"})]})]},e.id))})})]}):(0,a.jsx)(l.Zb,{className:"border-yellow-200 bg-yellow-50",children:(0,a.jsx)(l.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(G.Z,{className:"mx-auto h-12 w-12 text-yellow-600 mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"無設備連接"}),(0,a.jsx)("p",{className:"text-yellow-700 mb-4",children:"還沒有設備加入會話。請使用Wi-Fi掃描或QR碼掃描來邀請設備加入。"}),(0,a.jsxs)("div",{className:"text-sm text-yellow-600 space-y-1",children:[(0,a.jsx)("p",{children:"• 確保設備在同一Wi-Fi網絡中"}),(0,a.jsx)("p",{children:"• 後端服務必須在端口5001運行"}),(0,a.jsx)("p",{children:"• 支持VR頭顯和手機設備"}),(0,a.jsx)("p",{children:"• 設備會自動顯示在此列表中"})]})]})})}),(0,a.jsxs)(l.Zb,{className:"border-blue-200 bg-blue-50",children:[(0,a.jsx)(l.Ol,{children:(0,a.jsxs)(l.ll,{className:"flex items-center gap-2 text-blue-800",children:[(0,a.jsx)(L.Z,{className:"h-5 w-5"}),"設備連接說明"]})}),(0,a.jsx)(l.aY,{children:(0,a.jsxs)("div",{className:"text-sm text-blue-700 space-y-2",children:[(0,a.jsx)("p",{children:(0,a.jsx)("strong",{children:"Wi-Fi連接："})}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[(0,a.jsx)("li",{children:"使用Wi-Fi掃描發現同一網絡中的設備"}),(0,a.jsx)("li",{children:"設備會自動加入當前會話"}),(0,a.jsx)("li",{children:"支持VR頭顯、手機、桌面設備"})]}),(0,a.jsx)("p",{className:"mt-3",children:(0,a.jsx)("strong",{children:"QR碼連接："})}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[(0,a.jsx)("li",{children:"掃描會話QR碼快速加入"}),(0,a.jsx)("li",{children:"適用於所有支持相機的設備"}),(0,a.jsx)("li",{children:"無需手動配置網絡"})]}),(0,a.jsx)("p",{className:"mt-3",children:(0,a.jsx)("strong",{children:"實時同步："})}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[(0,a.jsx)("li",{children:"設備列表實時更新"}),(0,a.jsx)("li",{children:"自動顯示設備類型和型號"}),(0,a.jsx)("li",{children:"支持設備狀態監控"})]})]})})]})]}):(0,a.jsxs)(u,{className:"border-red-200 bg-red-50",children:[(0,a.jsx)(G.Z,{className:"h-4 w-4 text-red-600"}),(0,a.jsx)(h,{className:"text-red-800",children:"無法連接到設備管理服務。請檢查網絡連接和後端服務狀態。"})]})},ei=e=>{let{isOpen:s,onOpenChange:t,sessionCode:i,onDeviceConnected:c,onDeviceDisconnected:d,connectedDevices:o}=e,[m,x]=(0,n.useState)(!1),[u,h]=(0,n.useState)("wifi"),[j,f]=(0,n.useState)(null),p=t||setInternalIsOpen;return(0,a.jsxs)(W,{open:void 0!==s?s:m,onOpenChange:p,children:[(0,a.jsx)(Y,{asChild:!0,children:(0,a.jsxs)(r.z,{className:"flex items-center gap-2",children:[(0,a.jsx)(b.Z,{className:"h-4 w-4"}),"添加設備"]})}),(0,a.jsxs)(A,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(V,{children:[(0,a.jsxs)(P,{className:"flex items-center gap-2",children:[(0,a.jsx)(b.Z,{className:"h-5 w-5"}),"設備管理"]}),(0,a.jsx)(U,{children:"選擇連接方式來添加新的VR設備或手機"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(el,{sessionCode:i,onDeviceConnected:c,onDeviceDisconnected:d}),(0,a.jsxs)(F.mQ,{value:u,onValueChange:h,children:[(0,a.jsxs)(F.dr,{className:"grid w-full grid-cols-2",children:[(0,a.jsxs)(F.SP,{value:"wifi",className:"flex items-center gap-2",children:[(0,a.jsx)(L.Z,{className:"h-4 w-4"}),"Wi-Fi掃描"]}),(0,a.jsxs)(F.SP,{value:"qr",className:"flex items-center gap-2",children:[(0,a.jsx)(q.Z,{className:"h-4 w-4"}),"QR碼掃描"]})]}),(0,a.jsxs)(F.nU,{value:"wifi",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 border rounded-lg bg-blue-50",children:[(0,a.jsx)("h3",{className:"font-medium text-blue-900 mb-2",children:"Wi-Fi連接說明"}),(0,a.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[(0,a.jsx)("li",{children:"• 掃描同一Wi-Fi網絡中的設備"}),(0,a.jsx)("li",{children:"• 支持VR頭顯和手機設備"}),(0,a.jsx)("li",{children:"• 需要設備在同一本地網絡"}),(0,a.jsx)("li",{children:"• 僅用於設備發現和初始連接"})]})]}),(0,a.jsx)(K,{onDeviceConnected:e=>{c({id:e.id,name:e.name,type:e.deviceType,connectionMethod:"wifi",status:"connected",lastSeen:new Date().toLocaleString()}),p(!1)},onDeviceDisconnected:e=>{d(e)}})]}),(0,a.jsxs)(F.nU,{value:"qr",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 border rounded-lg bg-green-50",children:[(0,a.jsx)("h3",{className:"font-medium text-green-900 mb-2",children:"QR碼連接說明"}),(0,a.jsxs)("ul",{className:"text-sm text-green-800 space-y-1",children:[(0,a.jsx)("li",{children:"• 掃描設備上顯示的QR碼"}),(0,a.jsx)("li",{children:"• 支持相機掃描和手動輸入"}),(0,a.jsx)("li",{children:"• 快速連接網絡設備"}),(0,a.jsx)("li",{children:"• 適用於所有支持相機的設備"})]})]}),(0,a.jsx)(ea,{onDeviceJoined:e=>{c({...e,connectionMethod:"qr",status:"connected",lastSeen:new Date().toLocaleString()}),p(!1)}})]})]}),(0,a.jsxs)(l.Zb,{className:"border-yellow-200 bg-yellow-50",children:[(0,a.jsx)(l.Ol,{children:(0,a.jsx)(l.ll,{className:"text-yellow-800",children:"重要提示"})}),(0,a.jsx)(l.aY,{children:(0,a.jsxs)("div",{className:"text-sm text-yellow-700 space-y-2",children:[(0,a.jsx)("p",{children:(0,a.jsx)("strong",{children:"Wi-Fi功能："})}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[(0,a.jsx)("li",{children:"需要所有設備在同一Wi-Fi網絡"}),(0,a.jsx)("li",{children:"後端服務必須在端口5001運行"}),(0,a.jsx)("li",{children:"支持常見本地IP範圍掃描"}),(0,a.jsx)("li",{children:"掃描時間約30秒，請耐心等待"})]}),(0,a.jsx)("p",{className:"mt-3",children:(0,a.jsx)("strong",{children:"QR碼功能："})}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[(0,a.jsx)("li",{children:"需要相機權限"}),(0,a.jsx)("li",{children:"建議使用後置相機掃描"}),(0,a.jsx)("li",{children:"支持手動輸入設備代碼"})]}),(0,a.jsx)("p",{className:"mt-3",children:(0,a.jsx)("strong",{children:"設備管理："})}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[(0,a.jsx)("li",{children:"僅顯示真實連接的設備"}),(0,a.jsx)("li",{children:"設備斷開後會自動從列表中移除"}),(0,a.jsx)("li",{children:"支持手動斷開設備連接"})]})]})})]})]})]})]})};function er(e){let{onSessionCreated:s}=e,[t,c]=(0,n.useState)(null),[o,m]=(0,n.useState)(""),[x,f]=(0,n.useState)(!1),[p,F]=(0,n.useState)(!1),[O,I]=(0,n.useState)([]),[W,Y]=(0,n.useState)({isPlaying:!1,currentTime:0,videoId:null,videoUrl:null}),[Q,E]=(0,n.useState)(""),[A,V]=(0,n.useState)(""),[P,U]=(0,n.useState)(""),[_,L]=(0,n.useState)(!1),[q,H]=(0,n.useState)(""),[B,G]=(0,n.useState)(null),J=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=(0,z.io)("http://localhost:5001",{transports:["polling","websocket"],timeout:1e4,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,forceNew:!0});return e.on("connect",()=>{f(!0),E("")}),e.on("disconnect",()=>{f(!1),E("與服務器斷開連接")}),e.on("connect_error",e=>{E("連接錯誤: ".concat(e.message)),f(!1)}),e.on("device-joined",e=>{let s={id:e.deviceId,name:e.deviceName||"未知設備",type:e.deviceType||"unknown",status:"connected",lastSeen:new Date,connectionMethod:e.connectionMethod||"network",deviceModel:e.deviceModel};I(t=>t.find(s=>s.id===e.deviceId)?t.map(t=>t.id===e.deviceId?{...t,...s,lastSeen:new Date}:t):[...t,s]),V("設備 ".concat(e.deviceModel||e.deviceName||"未知設備"," 已加入會話"))}),e.on("device-left",e=>{I(s=>s.filter(s=>s.id!==e.deviceId)),V("設備已離開會話")}),e.on("session-created",e=>{m(e.joinCode),U("http://localhost:3000/join?code=".concat(e.joinCode)),V("會話創建成功！其他設備可以使用QR碼加入"),null==s||s(e.joinCode),G({sessionId:e.sessionId,joinCode:e.joinCode,theme:e.theme,createdAt:new Date().toLocaleString(),connectedDevices:0}),L(!1),H("")}),e.on("video-sync",e=>{J.current&&(J.current.currentTime=e.currentTime||0,e.isPlaying?J.current.play():J.current.pause())}),c(e),()=>{e.close()}},[s]);let X=async()=>{if(!q.trim()){E("請輸入旅遊主題");return}F(!0),E(""),V("");try{let e=localStorage.getItem("jwt_token")||localStorage.getItem("auth_token");if(!e){E("請先登入系統");return}let s=await M.Z.post("http://localhost:5001/api/create-session",{theme:q.trim()},{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(s.data.success){let{sessionId:e,joinCode:a,theme:n}=s.data;t&&t.emit("session-created",{sessionId:e,joinCode:a,theme:n,timestamp:Date.now()}),V("會話創建成功！其他設備可以使用QR碼加入"),G({sessionId:e,joinCode:a,theme:n,createdAt:new Date().toLocaleString(),connectedDevices:0}),L(!1),H("")}else E(s.data.message||"創建會話失敗")}catch(t){var e,s;(null===(e=t.response)||void 0===e?void 0:e.status)===401?E("認證失敗，請重新登入"):(null===(s=t.response)||void 0===s?void 0:s.status)===400?E(t.response.data.message||"請求參數錯誤"):E("創建會話失敗，請檢查網絡或重新登入")}finally{F(!1)}},$=()=>{(null==B?void 0:B.joinCode)&&(navigator.clipboard.writeText(B.joinCode),V("會話代碼已複製到剪貼板"),setTimeout(()=>V(""),3e3))};return(0,a.jsxs)("div",{className:"space-y-6",children:[Q&&(0,a.jsxs)(u,{variant:"destructive",children:[(0,a.jsx)(v.Z,{className:"h-4 w-4"}),(0,a.jsx)(h,{children:Q})]}),A&&(0,a.jsxs)(u,{className:"border-green-200 bg-green-50",children:[(0,a.jsx)(d.Z,{className:"h-4 w-4 text-green-600"}),(0,a.jsx)(h,{className:"text-green-800",children:A})]}),B?(0,a.jsxs)(l.Zb,{className:"border-green-200 bg-green-50",children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsxs)(l.ll,{className:"flex items-center gap-2 text-green-800",children:[(0,a.jsx)(d.Z,{className:"h-5 w-5"}),"當前會話：",B.theme]}),(0,a.jsx)(l.SZ,{className:"text-green-700",children:"會話已創建，其他設備可以使用以下信息加入"})]}),(0,a.jsxs)(l.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g,{className:"text-sm font-medium",children:"會話ID"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(i.C,{variant:"secondary",className:"font-mono text-sm",children:B.sessionId}),(0,a.jsx)(r.z,{size:"sm",variant:"outline",onClick:$,children:(0,a.jsx)(D.Z,{className:"h-3 w-3"})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g,{className:"text-sm font-medium",children:"加入代碼"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(i.C,{variant:"default",className:"font-mono text-sm",children:B.joinCode}),(0,a.jsx)(r.z,{size:"sm",variant:"outline",onClick:$,children:(0,a.jsx)(D.Z,{className:"h-3 w-3"})})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g,{className:"text-sm font-medium",children:"QR碼"}),(0,a.jsx)("div",{className:"flex justify-center p-4 bg-white rounded-lg",children:(0,a.jsx)(T.t,{value:P,size:200,level:"M",includeMargin:!0})}),(0,a.jsx)("p",{className:"text-xs text-gray-600 text-center",children:"掃描此QR碼加入會話"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm text-green-700",children:[(0,a.jsxs)("span",{children:["創建時間：",B.createdAt]}),(0,a.jsxs)("span",{children:["連接設備：",B.connectedDevices," 個"]})]})]})]}):(0,a.jsxs)(l.Zb,{className:"border-blue-200 bg-blue-50",children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsxs)(l.ll,{className:"flex items-center gap-2 text-blue-800",children:[(0,a.jsx)(N.Z,{className:"h-5 w-5"}),"創建旅遊團會話"]}),(0,a.jsx)(l.SZ,{className:"text-blue-700",children:"創建一個新的旅遊團會話，讓其他設備可以加入並同步觀看視頻"})]}),(0,a.jsx)(l.aY,{children:_?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(g,{htmlFor:"session-theme",children:"旅遊主題"}),(0,a.jsx)(j.I,{id:"session-theme",placeholder:"例如：Paris Tour, Tokyo Adventure, New York City",value:q,onChange:e=>H(e.target.value),className:"mt-1"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(r.z,{onClick:X,disabled:p||!q.trim(),className:"bg-blue-600 hover:bg-blue-700",children:[p?(0,a.jsx)(w.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(y.Z,{className:"mr-2 h-4 w-4"}),p?"創建中...":"創建會話"]}),(0,a.jsx)(r.z,{variant:"outline",onClick:()=>{L(!1),H("")},children:"取消"})]})]}):(0,a.jsxs)(r.z,{onClick:()=>L(!0),className:"bg-blue-600 hover:bg-blue-700",disabled:!x,children:[(0,a.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"創建旅遊團"]})})]}),B&&(0,a.jsxs)(l.Zb,{children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(Z.Z,{className:"h-5 w-5"}),"設備管理"]}),(0,a.jsx)(l.SZ,{children:"管理已連接的設備，支持Wi-Fi掃描和QR碼連接"})]}),(0,a.jsx)(l.aY,{children:(0,a.jsx)(ei,{sessionCode:o,onDeviceConnected:e=>{let s={id:e.id,name:e.name,type:e.type||e.deviceType||"mobile",status:"connected",lastSeen:new Date,connectionMethod:e.connectionMethod||"wifi",deviceModel:e.deviceModel};I(t=>t.find(s=>s.id===e.id)?t.map(t=>t.id===e.id?{...t,...s,lastSeen:new Date}:t):[...t,s]),V("設備 ".concat(e.deviceModel||e.name," 已通過").concat("wifi"===e.connectionMethod?"Wi-Fi":"QR碼","連接")),"wifi"===e.connectionMethod&&t&&t.emit("device-joined",{deviceId:e.id,deviceName:e.name,deviceType:e.type||e.deviceType||"mobile",connectionMethod:"wifi",deviceModel:e.deviceModel,timestamp:Date.now()})},onDeviceDisconnected:e=>{I(s=>s.filter(s=>s.id!==e)),V("設備已斷開連接"),t&&t.emit("device-left",{deviceId:e,timestamp:Date.now()})},connectedDevices:O.map(e=>({id:e.id,name:e.name,type:e.type,connectionMethod:"bluetooth"===e.connectionMethod?"wifi":e.connectionMethod,status:e.status,lastSeen:e.lastSeen.toLocaleString()}))})})]}),B&&(0,a.jsxs)(l.Zb,{children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(C.Z,{className:"h-5 w-5"}),"視頻播放控制"]}),(0,a.jsx)(l.SZ,{children:"控制所有連接設備的視頻播放"})]}),(0,a.jsxs)(l.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(r.z,{onClick:()=>{var e,s;if(!t||!o)return;let a=(null===(e=J.current)||void 0===e?void 0:e.src)||"https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4";t.emit("play-video",{sessionCode:o,videoId:"demo-video",videoUrl:a,startTime:(null===(s=J.current)||void 0===s?void 0:s.currentTime)||0,timestamp:Date.now()}),Y(e=>({...e,isPlaying:!0})),V("開始播放視頻")},disabled:!o,children:[(0,a.jsx)(C.Z,{className:"mr-2 h-4 w-4"}),"播放"]}),(0,a.jsxs)(r.z,{onClick:()=>{t&&o&&(t.emit("pause-video",{sessionCode:o,timestamp:Date.now()}),Y(e=>({...e,isPlaying:!1})),V("視頻已暫停"))},disabled:!o,variant:"outline",children:[(0,a.jsx)(S.Z,{className:"mr-2 h-4 w-4"}),"暫停"]}),(0,a.jsxs)(r.z,{onClick:()=>{t&&o&&(t.emit("stop-video",{sessionCode:o,timestamp:Date.now()}),Y(e=>({...e,isPlaying:!1,currentTime:0})),J.current&&(J.current.currentTime=0),V("視頻已停止"))},disabled:!o,variant:"outline",children:[(0,a.jsx)(k.Z,{className:"mr-2 h-4 w-4"}),"停止"]})]}),(0,a.jsx)("div",{className:"border rounded-lg p-4",children:(0,a.jsxs)("video",{ref:J,className:"w-full h-64 object-cover rounded",controls:!0,onTimeUpdate:()=>{J.current&&Y(e=>({...e,currentTime:J.current.currentTime}))},children:[(0,a.jsx)("source",{src:"https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4",type:"video/mp4"}),"您的瀏覽器不支持視頻播放"]})})]})]}),(0,a.jsxs)(l.Zb,{children:[(0,a.jsx)(l.Ol,{children:(0,a.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,a.jsx)(R.Z,{className:"h-5 w-5"}),"連接狀態"]})}),(0,a.jsx)(l.aY,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[x?(0,a.jsx)(d.Z,{className:"h-5 w-5 text-green-600"}):(0,a.jsx)(v.Z,{className:"h-5 w-5 text-red-600"}),(0,a.jsx)("span",{className:x?"text-green-600":"text-red-600",children:x?"已連接到服務器":"未連接到服務器"})]}),(0,a.jsx)(i.C,{variant:x?"default":"destructive",children:x?"在線":"離線"})]})})]})]})}function ec(){return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(c.Z,{className:"h-8 w-8 text-blue-600"}),(0,a.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"VR多設備視頻播放系統"}),(0,a.jsxs)(i.C,{variant:"secondary",className:"hidden md:inline-flex items-center",children:[(0,a.jsx)(d.Z,{className:"h-3 w-3 mr-1"}),"控制器模式"]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)(r.z,{variant:"outline",size:"sm",onClick:()=>window.location.href="/",children:"返回首頁"})})]})})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsxs)(l.Zb,{children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsx)(l.ll,{children:"控制器儀表板"}),(0,a.jsx)(l.SZ,{children:"創建會話並控制所有連接設備的視頻播放"})]}),(0,a.jsx)(l.aY,{children:(0,a.jsx)(er,{})})]})})]})}},5974:function(e,s,t){"use strict";t.d(s,{C:function(){return r}});var a=t(7437),n=t(535),l=t(4508);let i=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function r(e){let{className:s,variant:t,...n}=e;return(0,a.jsx)("div",{className:(0,l.cn)(i({variant:t}),s),...n})}},2869:function(e,s,t){"use strict";t.d(s,{z:function(){return d}});var a=t(7437),n=t(2265),l=t(8482),i=t(535),r=t(4508);let c=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,s)=>{let{className:t,variant:n,size:i,asChild:d=!1,...o}=e,m=d?l.g7:"button";return(0,a.jsx)(m,{className:(0,r.cn)(c({variant:n,size:i,className:t})),ref:s,...o})});d.displayName="Button"},6070:function(e,s,t){"use strict";t.d(s,{Ol:function(){return r},SZ:function(){return d},Zb:function(){return i},aY:function(){return o},ll:function(){return c}});var a=t(7437),n=t(2265),l=t(4508);let i=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...n})});i.displayName="Card";let r=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",t),...n})});r.displayName="CardHeader";let c=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("h3",{ref:s,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",t),...n})});c.displayName="CardTitle";let d=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("p",{ref:s,className:(0,l.cn)("text-sm text-muted-foreground",t),...n})});d.displayName="CardDescription";let o=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("p-6 pt-0",t),...n})});o.displayName="CardContent",n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)("div",{ref:s,className:(0,l.cn)("flex items-center p-6 pt-0",t),...n})}).displayName="CardFooter"},5186:function(e,s,t){"use strict";t.d(s,{I:function(){return i}});var a=t(7437),n=t(2265),l=t(4508);let i=n.forwardRef((e,s)=>{let{className:t,type:n,...i}=e;return(0,a.jsx)("input",{type:n,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...i})});i.displayName="Input"},2759:function(e,s,t){"use strict";t.d(s,{E:function(){return r}});var a=t(7437),n=t(2265),l=t(1505),i=t(4508);let r=n.forwardRef((e,s)=>{let{className:t,value:n,...r}=e;return(0,a.jsx)(l.fC,{ref:s,className:(0,i.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...r,children:(0,a.jsx)(l.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(n||0),"%)")}})})});r.displayName=l.fC.displayName},2339:function(e,s,t){"use strict";t.d(s,{SP:function(){return d},dr:function(){return c},mQ:function(){return r},nU:function(){return o}});var a=t(7437),n=t(2265),l=t(3278),i=t(4508);let r=l.fC,c=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.aV,{ref:s,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...n})});c.displayName=l.aV.displayName;let d=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.xz,{ref:s,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...n})});d.displayName=l.xz.displayName;let o=n.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,a.jsx)(l.VY,{ref:s,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...n})});o.displayName=l.VY.displayName},4508:function(e,s,t){"use strict";t.d(s,{cn:function(){return l}});var a=t(1994),n=t(3335);function l(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,n.m6)((0,a.W)(s))}}},function(e){e.O(0,[664,536,680,16,341,236,971,117,744],function(){return e(e.s=9879)}),_N_E=e.O()}]);