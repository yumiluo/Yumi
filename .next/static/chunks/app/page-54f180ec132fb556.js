(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9823:function(e,t,s){Promise.resolve().then(s.bind(s,7021))},7021:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return eh}});var n=s(7437),i=s(2265),a=s(2869),r=s(6070),l=s(2339),c=s(5974),o=s(9897),d=s(9374),u=s(9205);let m=(0,u.Z)("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);var h=s(1671);let x=(0,u.Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),p=(0,u.Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var v=s(3276);let f=(0,u.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var g=s(9227),y=s(1094),b=s(6865),j=s(9202),w=s(5805),N=s(5186),S=s(2489),C=s(1817),k=s(9397),E=s(9322),T=s(5153);let z=(0,u.Z)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),A=(0,u.Z)("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),D=(0,u.Z)("VolumeX",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),O=(0,u.Z)("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),V=(0,u.Z)("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);function I(e){let{videoId:t,title:s,onPlay:l,onPause:o,onStop:d,onSeek:u,onVolumeChange:m,onReady:h,isPlaying:x=!1,currentTime:p=0,duration:f=0,volume:b=100,isMuted:j=!1}=e,w=(0,i.useRef)(null),[N,S]=(0,i.useState)(null),[C,k]=(0,i.useState)(!1),[T,I]=(0,i.useState)(null),[L,R]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(window.YT)Z();else{var e;let t=document.createElement("script");t.src="https://www.youtube.com/iframe_api";let s=document.getElementsByTagName("script")[0];null===(e=s.parentNode)||void 0===e||e.insertBefore(t,s),window.onYouTubeIframeAPIReady=()=>{Z()}}return()=>{N&&N.destroy()}},[t]);let Z=()=>{if(w.current)try{new window.YT.Player(w.current,{height:"360",width:"640",videoId:t,playerVars:{autoplay:0,controls:1,rel:0,showinfo:0,modestbranding:1,enablejsapi:1,origin:window.location.origin,playsinline:1,vr:1,iv_load_policy:3,cc_load_policy:0},events:{onReady:e=>{S(e.target),k(!0),I(null),e.target.setVolume(b),j&&e.target.mute(),null==h||h()},onStateChange:e=>{let t=e.data;1===t?null==l||l():2===t?null==o||o():0===t&&(null==d||d())},onError:e=>{I("播放器錯誤: ".concat(e.data))}}})}catch(e){I("創建播放器失敗: ".concat(e))}},M=e=>{N&&C&&(N.setVolume(e),null==m||m(e))},_=e=>"".concat(Math.floor(e/60),":").concat(Math.floor(e%60).toString().padStart(2,"0"));return T?(0,n.jsx)(r.Zb,{className:"w-full",children:(0,n.jsxs)(r.aY,{className:"p-6 text-center",children:[(0,n.jsx)("div",{className:"text-red-500 mb-4",children:(0,n.jsx)(E.Z,{className:"h-12 w-12 mx-auto"})}),(0,n.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"播放器錯誤"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:T}),(0,n.jsx)(a.z,{onClick:()=>window.location.reload(),children:"重新載入"})]})}):(0,n.jsxs)(r.Zb,{className:"w-full",children:[(0,n.jsxs)(r.Ol,{children:[(0,n.jsxs)(r.ll,{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{children:s}),(0,n.jsx)(c.C,{variant:"outline",children:"YouTube 360\xb0"})]}),(0,n.jsx)(r.SZ,{children:"使用YouTube播放器播放360度旅遊影片"})]}),(0,n.jsxs)(r.aY,{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{ref:w,className:"w-full aspect-video bg-gray-900 rounded-lg overflow-hidden"}),!C&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-75",children:(0,n.jsxs)("div",{className:"text-center text-white",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),(0,n.jsx)("p",{children:"載入YouTube播放器中..."})]})})]}),(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,n.jsx)(a.z,{size:"sm",variant:"outline",onClick:()=>{},disabled:!C,title:"向左旋轉",children:(0,n.jsx)(z,{className:"h-4 w-4"})}),(0,n.jsx)(a.z,{size:"sm",variant:"outline",onClick:()=>{N&&C&&(N.stopVideo(),null==d||d())},disabled:!C,title:"停止",children:(0,n.jsx)(y.Z,{className:"h-4 w-4"})}),(0,n.jsx)(a.z,{size:"sm",onClick:x?()=>{N&&C&&(N.pauseVideo(),null==o||o())}:()=>{N&&C&&(N.playVideo(),null==l||l())},disabled:!C,title:x?"暫停":"播放",children:x?(0,n.jsx)(g.Z,{className:"h-4 w-4"}):(0,n.jsx)(v.Z,{className:"h-4 w-4"})}),(0,n.jsx)(a.z,{size:"sm",variant:"outline",onClick:()=>{},disabled:!C,title:"向右旋轉",children:(0,n.jsx)(A,{className:"h-4 w-4"})})]}),(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,n.jsx)(a.z,{size:"sm",variant:"ghost",onClick:()=>{N&&C&&(j?N.unMute():N.mute())},disabled:!C,title:j?"取消靜音":"靜音",children:j?(0,n.jsx)(D,{className:"h-4 w-4"}):(0,n.jsx)(O,{className:"h-4 w-4"})}),(0,n.jsx)("input",{type:"range",min:"0",max:"100",value:b,onChange:e=>M(parseInt(e.target.value)),disabled:!C,className:"w-24"}),(0,n.jsxs)("span",{className:"text-sm text-gray-600 w-12 text-center",children:[b,"%"]})]}),(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsxs)(a.z,{size:"sm",variant:"outline",onClick:()=>{N&&C&&(L?(N.exitFullscreen(),R(!1)):(N.requestFullscreen(),R(!0)))},disabled:!C,title:L?"退出全螢幕":"全螢幕",children:[(0,n.jsx)(V,{className:"h-4 w-4"}),L?"退出全螢幕":"全螢幕"]})}),C&&(0,n.jsxs)("div",{className:"text-center text-sm text-gray-600",children:[(0,n.jsx)("span",{children:_(p)}),(0,n.jsx)("span",{className:"mx-2",children:"/"}),(0,n.jsx)("span",{children:_(f)})]}),(0,n.jsx)("div",{className:"text-center text-xs text-gray-500 bg-blue-50 p-2 rounded",children:"\uD83D\uDCA1 提示：使用滑鼠拖拽或觸控手勢來旋轉360度影片視角"})]})]})}let L={亞洲:["日本","中國","韓國","泰國","越南","新加坡","馬來西亞","印尼","菲律賓","印度","台灣","香港","澳門","蒙古","北韓","南韓","柬埔寨","寮國","緬甸","文萊","東帝汶","斯里蘭卡","孟加拉","尼泊爾","不丹","馬爾地夫","巴基斯坦","阿富汗","伊朗","伊拉克","科威特","沙烏地阿拉伯","阿曼","葉門","阿聯酋","卡達","巴林","約旦","黎巴嫩","敘利亞","以色列","巴勒斯坦","塞浦路斯","土耳其","喬治亞","亞美尼亞","亞塞拜然","哈薩克","烏茲別克","土庫曼","吉爾吉斯","塔吉克"],歐洲:["法國","德國","英國","義大利","西班牙","荷蘭","比利時","瑞士","奧地利","希臘","葡萄牙","愛爾蘭","丹麥","芬蘭","瑞典","挪威","冰島","波蘭","捷克","斯洛伐克","匈牙利","羅馬尼亞","保加利亞","克羅埃西亞","斯洛維尼亞","波士尼亞","塞爾維亞","蒙特內哥羅","北馬其頓","阿爾巴尼亞","愛沙尼亞","拉脫維亞","立陶宛","白俄羅斯","烏克蘭","摩爾多瓦","俄羅斯","盧森堡","列支敦斯登","摩納哥","安道爾","聖馬利諾","梵蒂岡","馬爾他"],中東:["沙烏地阿拉伯","伊朗","伊拉克","科威特","阿曼","葉門","阿聯酋","卡達","巴林","約旦","黎巴嫩","敘利亞","以色列","巴勒斯坦","塞浦路斯","土耳其","埃及"],非洲:["埃及","摩洛哥","南非","肯亞","坦尚尼亞","奈及利亞","迦納","阿爾及利亞","突尼西亞","利比亞","蘇丹","南蘇丹","衣索比亞","索馬利亞","吉布地","厄利垂亞","烏干達","盧安達","蒲隆地","中非共和國","查德","喀麥隆","加彭","剛果共和國","剛果民主共和國","安哥拉","尚比亞","辛巴威","波札那","納米比亞","馬達加斯加","模里西斯","塞席爾","葛摩","馬利","布吉納法索","尼日","查德","馬利","茅利塔尼亞","塞內加爾","甘比亞","幾內亞比索","幾內亞","獅子山","賴比瑞亞","象牙海岸","多哥","貝南","尼日","喀麥隆","赤道幾內亞","聖多美和普林西比","加彭","剛果共和國","剛果民主共和國","中非共和國","查德","喀麥隆","奈及利亞","尼日","查德","蘇丹","南蘇丹","衣索比亞","厄利垂亞","吉布地","索馬利亞","肯亞","烏干達","盧安達","蒲隆地","坦尚尼亞","馬達加斯加","模里西斯","塞席爾","葛摩","馬約特","留尼旺","聖赫勒拿","阿森松","特里斯坦-達庫尼亞"],北美洲:["美國","加拿大","墨西哥","格陵蘭","百慕達","聖皮埃與密克隆群島"],南美洲:["巴西","阿根廷","智利","秘魯","哥倫比亞","委內瑞拉","厄瓜多","玻利維亞","巴拉圭","烏拉圭","蓋亞那","蘇利南","法屬蓋亞那","福克蘭群島","南喬治亞和南桑威奇群島"],大洋洲:["澳洲","紐西蘭","斐濟","巴布亞紐幾內亞","所羅門群島","萬那杜","新喀里多尼亞","諾福克島","聖誕島","科科斯群島","諾魯","密克羅尼西亞","馬紹爾群島","帛琉","關島","北馬里亞納群島","美屬薩摩亞","東加","薩摩亞","庫克群島","紐埃","托克勞","瓦利斯和富圖納","皮特凱恩群島","法屬波利尼西亞"],北極:["格陵蘭","冰島","挪威","瑞典","芬蘭","俄羅斯","加拿大","美國"],南極:["南極洲"]};function R(e){let t=e.toLowerCase();for(let[e,s]of Object.entries(L))if(s.some(e=>e.toLowerCase()===t))return e;for(let[e,s]of Object.entries(L))if(s.some(e=>t.includes(e.toLowerCase())||e.toLowerCase().includes(t)))return e;return"亞洲"}let Z="vr-travel-videos";class M{static getAllVideos(){try{let e=localStorage.getItem(Z);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return[]}}static addVideo(e){try{let t=this.getAllVideos();if(t.some(t=>t.id===e.id)||t.length>=50)return!1;let s=R(e.country),n={...e,category:s,addedAt:new Date().toISOString(),viewCount:0};return t.unshift(n),localStorage.setItem(Z,JSON.stringify(t)),!0}catch(e){return!1}}static getVideosByCategory(e){return this.getAllVideos().filter(t=>t.category===e)}static getAllCategories(){return Object.keys(L)}static getCategoryStats(){let e=this.getAllVideos(),t={};return Object.keys(L).forEach(s=>{t[s]=e.filter(e=>e.category===s).length}),t}static updateVideo(e,t){try{let s=this.getAllVideos(),n=s.findIndex(t=>t.id===e);if(-1===n)return!1;return t.country&&t.country!==s[n].country&&(t.category=R(t.country)),s[n]={...s[n],...t},localStorage.setItem(Z,JSON.stringify(s)),!0}catch(e){return!1}}static removeVideo(e){try{let t=this.getAllVideos(),s=t.filter(t=>t.id!==e);if(s.length===t.length)return!1;return localStorage.setItem(Z,JSON.stringify(s)),!0}catch(e){return!1}}static getVideoById(e){return this.getAllVideos().find(t=>t.id===e)||null}static getVideosByCountry(e){return this.getAllVideos().filter(t=>t.country===e)}static getVideosByTag(e){return this.getAllVideos().filter(t=>t.tags.some(t=>t.toLowerCase().includes(e.toLowerCase())))}static searchVideos(e){let t=this.getAllVideos(),s=e.toLowerCase();return t.filter(e=>e.title.toLowerCase().includes(s)||e.description.toLowerCase().includes(s)||e.country.toLowerCase().includes(s)||e.category.toLowerCase().includes(s)||e.tags.some(e=>e.toLowerCase().includes(s)))}static incrementViewCount(e){var t;return this.updateVideo(e,{viewCount:((null===(t=this.getVideoById(e))||void 0===t?void 0:t.viewCount)||0)+1})}static getPopularVideos(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this.getAllVideos().sort((e,t)=>t.viewCount-e.viewCount).slice(0,e)}static getRecentVideos(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this.getAllVideos().sort((e,t)=>new Date(t.addedAt).getTime()-new Date(e.addedAt).getTime()).slice(0,e)}static clearAllVideos(){try{return localStorage.removeItem(Z),!0}catch(e){return!1}}static getStorageStats(){let e=this.getAllVideos(),t=[...new Set(e.map(e=>e.country))],s=[...new Set(e.map(e=>e.category))],n=e.reduce((e,t)=>e+t.tags.length,0),i=e.reduce((e,t)=>e+t.viewCount,0);return{totalVideos:e.length,totalCountries:t.length,totalCategories:s.length,totalTags:n,totalViews:i,averageViews:e.length>0?Math.round(i/e.length):0,storageUsage:"".concat(e.length,"/").concat(50),countries:t,categories:s,categoryStats:this.getCategoryStats()}}static hasStorageSpace(){return this.getAllVideos().length<50}static exportVideos(){try{let e=this.getAllVideos();return JSON.stringify(e,null,2)}catch(e){return"[]"}}static importVideos(e){try{let t=JSON.parse(e);if(!Array.isArray(t))throw Error("無效的數據格式");let s=t.filter(e=>e&&"string"==typeof e.id&&"string"==typeof e.title&&"string"==typeof e.embedUrl);if(0===s.length)throw Error("沒有有效的影片數據");if(s.length>50)throw Error("影片數量超過限制 (".concat(50,")"));let n=s.map(e=>({...e,category:e.category||R(e.country||"未知"),addedAt:e.addedAt||new Date().toISOString(),viewCount:e.viewCount||0}));return localStorage.setItem(Z,JSON.stringify(n)),!0}catch(e){return!1}}}let _="AIzaSyDOo1gTzt44lV1bZR5K5l-OThTm8XmBsmQ";function P(e){let{onVideoSelected:t,onClose:s}=e,[l,c]=(0,i.useState)(""),[o,d]=(0,i.useState)([]),[u,m]=(0,i.useState)(!1),[h,p]=(0,i.useState)(null),[f,g]=(0,i.useState)([]),[y,b]=(0,i.useState)(null),[j,w]=(0,i.useState)(!1),[z,A]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=localStorage.getItem("youtube-recent-searches");if(e)try{g(JSON.parse(e))}catch(e){}},[]);let D=e=>{let t=[e,...f.filter(t=>t!==e)].slice(0,5);g(t),localStorage.setItem("youtube-recent-searches",JSON.stringify(t))},O=async e=>{if(e.trim()){if(!_){p("請先設定YouTube API Key"),(0,T.Am)({title:"配置錯誤",description:"請在組件中設定真實的YouTube API Key",variant:"destructive"});return}m(!0),p(null),d([]);try{let t=await fetch("https://www.googleapis.com/youtube/v3/search?part=snippet&q=".concat(encodeURIComponent(e+" 360 VR travel"),"&type=video&videoDefinition=high&maxResults=20&key=").concat(_));if(!t.ok)throw Error("YouTube API錯誤: ".concat(t.status));let s=await t.json();if(!s.items||0===s.items.length){p("沒有找到相關的360度旅遊影片");return}let n=s.items.map(e=>e.id.videoId).join(","),i=await fetch("https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails,statistics,status&id=".concat(n,"&key=").concat(_));if(!i.ok)throw Error("獲取影片詳情失敗: ".concat(i.status));let a=(await i.json()).items.filter(e=>{let t=e.snippet.title.toLowerCase(),s=e.snippet.description.toLowerCase(),n=e.snippet.tags||[];return t.includes("360")||t.includes("vr")||s.includes("360")||s.includes("vr")||n.some(e=>e.toLowerCase().includes("360")||e.toLowerCase().includes("vr"))}).map(e=>{var t,s,n;let i=V(e.snippet.title,e.snippet.description),a=L(e.contentDetails.duration),r="https://www.youtube.com/embed/".concat(e.id,"?rel=0&enablejsapi=1&playsinline=1&vr=1");return{id:e.id,title:e.snippet.title,description:e.snippet.description,thumbnail:(null===(t=e.snippet.thumbnails.high)||void 0===t?void 0:t.url)||(null===(s=e.snippet.thumbnails.medium)||void 0===s?void 0:s.url),duration:a,country:i,category:R(i),tags:e.snippet.tags||[],embedUrl:r,publishedAt:e.snippet.publishedAt,channelTitle:e.snippet.channelTitle,addedAt:new Date().toISOString(),viewCount:0,embeddable:(null===(n=e.status)||void 0===n?void 0:n.embeddable)===!0}});if(0===a.length){p("沒有找到符合條件的360度旅遊影片");return}d(a),D(e),(0,T.Am)({title:"搜索完成",description:"找到 ".concat(a.length," 個360度旅遊影片")})}catch(e){p("搜索失敗: ".concat(e instanceof Error?e.message:"未知錯誤")),(0,T.Am)({title:"搜索失敗",description:e instanceof Error?e.message:"未知錯誤",variant:"destructive"})}finally{m(!1)}}},V=(e,t)=>{let s=(e+" "+t).toLowerCase();for(let e of["日本","中國","韓國","泰國","越南","新加坡","馬來西亞","印尼","菲律賓","印度","法國","德國","英國","義大利","西班牙","荷蘭","比利時","瑞士","奧地利","希臘","埃及","摩洛哥","南非","肯亞","坦尚尼亞","奈及利亞","迦納","美國","加拿大","墨西哥","巴西","阿根廷","智利","秘魯","哥倫比亞","澳洲","紐西蘭","斐濟","巴布亞紐幾內亞"])if(s.includes(e.toLowerCase()))return e;return s.includes("tokyo")||s.includes("東京")?"日本":s.includes("paris")||s.includes("巴黎")?"法國":s.includes("london")||s.includes("倫敦")?"英國":s.includes("new york")||s.includes("紐約")?"美國":s.includes("sydney")||s.includes("雪梨")?"澳洲":"未知地區"},L=e=>{let t=e.match(/PT(\d+H)?(\d+M)?(\d+S)?/);if(!t)return"未知";let s=t[1]?parseInt(t[1].replace("H","")):0,n=t[2]?parseInt(t[2].replace("M","")):0,i=t[3]?parseInt(t[3].replace("S","")):0;return s>0?"".concat(s,":").concat(n.toString().padStart(2,"0"),":").concat(i.toString().padStart(2,"0")):"".concat(n,":").concat(i.toString().padStart(2,"0"))},Z=()=>{l.trim()&&O(l.trim())},P=e=>{b(e),w(!0),A(!1);try{M.addVideo(e)?(0,T.Am)({title:"視頻已添加",description:"".concat(e.title," 已自動分類到 ").concat(e.category," 並存儲到本地")}):(0,T.Am)({title:"視頻已存在",description:"此視頻已在您的收藏中",variant:"default"})}catch(e){(0,T.Am)({title:"存儲失敗",description:"無法將視頻存儲到本地",variant:"destructive"})}t(e),setTimeout(()=>{w(!1)},2e3)},Y=e=>{c(e),O(e)};return y?(0,n.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold",children:"播放360度旅遊影片"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(a.z,{variant:"outline",size:"sm",onClick:()=>{b(null),w(!1),A(!1)},children:"返回搜索"}),(0,n.jsx)(a.z,{variant:"ghost",size:"sm",onClick:s,children:(0,n.jsx)(S.Z,{className:"h-4 w-4"})})]})]}),(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsxs)("div",{className:"mb-4 p-4 bg-blue-50 rounded-lg",children:[(0,n.jsx)("h3",{className:"font-semibold text-lg mb-2",children:y.title}),(0,n.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[(0,n.jsxs)("span",{children:["地區: ",y.country]}),(0,n.jsxs)("span",{children:["時長: ",y.duration]}),(0,n.jsxs)("span",{children:["頻道: ",y.channelTitle]})]})]}),(0,n.jsxs)("div",{className:"relative",children:[j&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-75 z-10 rounded-lg",children:(0,n.jsxs)("div",{className:"text-center text-white",children:[(0,n.jsx)(C.Z,{className:"h-16 w-16 animate-spin mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-lg",children:"正在載入視頻..."}),(0,n.jsx)("p",{className:"text-sm opacity-75",children:"請稍候，這可能需要幾秒鐘"})]})}),(0,n.jsxs)("div",{className:"mb-2 p-2 bg-yellow-50 border border-yellow-50 rounded text-xs text-yellow-800",children:[(0,n.jsx)("strong",{children:"調試信息:"})," Video ID: ",y.id," | 標題: ",y.title]}),(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)("iframe",{width:"100%",height:"400",src:"https://www.youtube.com/embed/".concat(y.id,"?rel=0&enablejsapi=1&playsinline=1&vr=1"),title:y.title,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0})}),(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("h4",{className:"text-sm font-medium mb-2",children:"高級播放器（實驗性）:"}),(0,n.jsx)(I,{videoId:y.id,title:y.title,onPlay:()=>{A(!0),w(!1)},onPause:()=>{A(!1)},onStop:()=>{A(!1),w(!1)},onReady:()=>{w(!1)},isPlaying:z})]})]}),(0,n.jsxs)("div",{className:"mt-6 flex justify-center gap-4",children:[(0,n.jsxs)(a.z,{onClick:()=>t(y),className:"bg-blue-600 hover:bg-blue-700",children:[(0,n.jsx)(k.Z,{className:"mr-2 h-4 w-4"}),"添加到播放列表"]}),(0,n.jsxs)(a.z,{variant:"outline",onClick:()=>window.open("https://www.youtube.com/watch?v=".concat(y.id),"_blank"),children:[(0,n.jsx)(v.Z,{className:"mr-2 h-4 w-4"}),"在YouTube中觀看"]})]})]})]})}):(0,n.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold",children:"從YouTube搜索VR/360度旅遊影片"}),(0,n.jsx)(a.z,{variant:"ghost",size:"sm",onClick:s,children:"✕"})]}),(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsxs)("div",{className:"flex gap-2 mb-6",children:[(0,n.jsx)(N.I,{placeholder:"輸入搜索關鍵詞，如：360 VR travel Japan",value:l,onChange:e=>c(e.target.value),onKeyPress:e=>"Enter"===e.key&&Z(),className:"flex-1"}),(0,n.jsxs)(a.z,{onClick:Z,disabled:u||!l.trim(),children:[u?(0,n.jsx)(C.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,n.jsx)(x,{className:"mr-2 h-4 w-4"}),"搜索"]})]}),f.length>0&&(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"最近搜索:"}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:f.map((e,t)=>(0,n.jsx)(a.z,{variant:"outline",size:"sm",onClick:()=>Y(e),className:"text-xs",children:e},t))})]}),h&&(0,n.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(E.Z,{className:"h-5 w-5 text-red-500 mr-2"}),(0,n.jsx)("span",{className:"text-red-700",children:h})]})}),o.length>0&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold",children:["搜索結果 (",o.length,")"]}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto",children:o.map(e=>(0,n.jsxs)(r.Zb,{className:"hover:shadow-md transition-shadow",children:[(0,n.jsx)(r.Ol,{className:"p-4",children:(0,n.jsx)("img",{src:e.thumbnail,alt:e.title,className:"w-full h-32 object-cover rounded"})}),(0,n.jsxs)(r.aY,{className:"p-4",children:[(0,n.jsx)(r.ll,{className:"text-sm font-semibold mb-2 line-clamp-2",children:e.title}),(0,n.jsxs)("div",{className:"space-y-2 text-xs text-gray-600",children:[(0,n.jsxs)("p",{children:["地區: ",e.country]}),(0,n.jsxs)("p",{children:["時長: ",e.duration]}),(0,n.jsxs)("p",{children:["頻道: ",e.channelTitle]})]}),(0,n.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,n.jsxs)(a.z,{size:"sm",onClick:()=>P(e),className:"flex-1 bg-blue-600 hover:bg-blue-700",children:[(0,n.jsx)(v.Z,{className:"mr-1 h-3 w-3"}),"播放影片"]}),(0,n.jsxs)(a.z,{size:"sm",variant:"outline",onClick:()=>window.open("https://www.youtube.com/watch?v=".concat(e.id),"_blank"),children:[(0,n.jsx)(v.Z,{className:"mr-1 h-3 w-3"}),"預覽"]})]})]})]},e.id))})]}),u&&(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)(C.Z,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),(0,n.jsx)("p",{className:"text-gray-600",children:"正在搜索YouTube VR/360度旅遊影片..."})]}),!u&&0===o.length&&!h&&(0,n.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,n.jsx)(x,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,n.jsx)("p",{children:"輸入關鍵詞開始搜索360度旅遊影片"}),(0,n.jsx)("p",{className:"text-sm mt-2",children:"建議搜索：360 VR travel Japan, 360 VR travel France 等"})]})]})]})})}let Y=(0,u.Z)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),F=(0,u.Z)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),U=e=>{let{isVisible:t,isMobileDevice:s,isVRHeadset:i}=e;return t?(0,n.jsx)("div",{className:"absolute inset-0 z-20 flex items-center justify-center bg-black bg-opacity-50 transition-opacity duration-1000",children:(0,n.jsxs)("div",{className:"text-center text-white bg-black bg-opacity-70 p-6 rounded-lg max-w-md",children:[(0,n.jsx)("div",{className:"text-4xl mb-4",children:"\uD83C\uDFA5"}),(0,n.jsx)("h3",{className:"text-xl font-bold mb-3",children:"VR 360\xb0 沉浸式體驗"}),(0,n.jsx)("div",{className:"space-y-2 text-sm opacity-90",children:s||i?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{children:"• 轉動頭部來控制360度視角"}),(0,n.jsx)("p",{children:"• 支持陀螺儀和設備方向感應"}),(0,n.jsx)("p",{children:"• 自動適配手機和VR頭顯"}),(0,n.jsx)("p",{children:"• 點擊屏幕或按返回鍵退出VR"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{children:"• 使用滑鼠拖拽來旋轉360度視角"}),(0,n.jsx)("p",{children:"• 點擊全屏按鈕獲得最佳VR體驗"}),(0,n.jsx)("p",{children:"• 支持VR頭顯設備"}),(0,n.jsx)("p",{children:"• 按ESC鍵或懸停右上角退出VR模式"})]})}),(0,n.jsx)("div",{className:"mt-4 text-xs opacity-75",children:"提示將在3秒後自動消失..."})]})}):null};function W(e){let{videoId:t,title:s,embedUrl:l,onPlay:o,onPause:d,onStop:u,onSeek:m,onVolumeChange:h,isPlaying:x=!1,currentTime:p=0,duration:f=0,volume:b=100,isMuted:j=!1}=e,w=(0,i.useRef)(null),[N,S]=(0,i.useState)(null),[C,k]=(0,i.useState)(!1),[T,A]=(0,i.useState)(null),[I,L]=(0,i.useState)(!1),[R,Z]=(0,i.useState)(!1),[M,_]=(0,i.useState)(!0),[P,W]=(0,i.useState)(!1),[q,J]=(0,i.useState)(!1),[B,H]=(0,i.useState)(!1),[Q,G]=(0,i.useState)({alpha:0,beta:0,gamma:0}),[K,X]=(0,i.useState)({x:0,y:0,z:0}),[$,ee]=(0,i.useState)(!0);(0,i.useEffect)(()=>{(()=>{let e=navigator.userAgent.toLowerCase();W(/android|iphone|ipad|ipod|blackberry|windows phone/i.test(e)),J(navigator.getVRDisplays||window.VRFrameData||/vr|oculus|htc vive|pico/i.test(e))})()},[]),(0,i.useEffect)(()=>{if(R&&$){let e=setTimeout(()=>{ee(!1)},3e3);return()=>clearTimeout(e)}},[R,$]);let et=async()=>{try{if("undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission){let e=await DeviceOrientationEvent.requestPermission();"granted"===e&&H(!0)}else H(!0)}catch(e){}},es=e=>{if(!B)return;let{alpha:t,beta:s,gamma:n}=e;G({alpha:t||0,beta:s||0,gamma:n||0});let i=(s||0)-90,a=t||0,r=n||0;X({x:i,y:a,z:r}),en(i,a,r)},en=(e,t,s)=>{if(N&&R)try{if(w.current){let e=w.current.querySelector("iframe");e&&e.contentWindow&&e.contentWindow.postMessage({event:"command",func:"seekTo",args:[0,!0]},"*")}}catch(e){}};(0,i.useEffect)(()=>(window.YT&&window.YT.Player?ei():(()=>{if(window.YT)ei();else{var e;let t=document.createElement("script");t.src="https://www.youtube.com/iframe_api";let s=document.getElementsByTagName("script")[0];null===(e=s.parentNode)||void 0===e||e.insertBefore(t,s),window.onYouTubeIframeAPIReady=()=>{ei()}}})(),()=>{N&&N.destroy()}),[t]),(0,i.useEffect)(()=>{let e=e=>{"Escape"===e.key&&R&&er()},t=()=>{document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||!R||(Z(!1),document.body.style.overflow="auto",document.documentElement.style.overflow="auto",document.body.classList.remove("vr-mode"))};return document.addEventListener("keydown",e),document.addEventListener("fullscreenchange",t),document.addEventListener("webkitfullscreenchange",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("MSFullscreenChange",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("fullscreenchange",t),document.removeEventListener("webkitfullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),document.removeEventListener("MSFullscreenChange",t)}},[R]),(0,i.useEffect)(()=>{if(R&&B){let e=e=>{es(e)};return window.addEventListener("deviceorientation",e),()=>{window.removeEventListener("deviceorientation",e)}}},[R,B]),(0,i.useEffect)(()=>{R&&(P||q)&&et()},[R,P,q]);let ei=()=>{if(w.current)try{N&&(N.destroy(),S(null),k(!1)),new window.YT.Player(w.current,{height:"360",width:"640",videoId:t,playerVars:{autoplay:0,controls:1,rel:0,showinfo:0,modestbranding:1,enablejsapi:1,origin:window.location.origin,playsinline:1,vr:1,iv_load_policy:3,cc_load_policy:0,fs:1,disablekb:0,loop:0,playlist:t,host:"https://www.youtube.com",widget_referrer:window.location.origin},events:{onReady:e=>{S(e.target),k(!0),A(null),null==o||o()},onStateChange:e=>{e.data===window.YT.PlayerState.PLAYING?null==o||o():e.data===window.YT.PlayerState.PAUSED?null==d||d():e.data===window.YT.PlayerState.ENDED&&(null==u||u())},onError:e=>{if(101===e.data||150===e.data){setTimeout(()=>{ei()},2e3);return}let t="播放器錯誤";switch(e.data){case 2:t="無效的視頻ID";break;case 5:t="HTML5播放器錯誤";break;case 100:t="視頻不存在或已被刪除";break;case 101:case 150:t="視頻無法嵌入播放，正在重試...";break;default:t="播放器錯誤: ".concat(e.data)}A(t)}}})}catch(e){A("創建播放器失敗，請檢查網絡連接")}},ea=e=>{N&&C&&(N.setVolume(e),null==h||h(e))},er=()=>{Z(!R),R?(document.body.style.overflow="auto",document.documentElement.style.overflow="auto",document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),document.body.classList.remove("vr-mode"),H(!1)):(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen(),document.body.classList.add("vr-mode"),ee(!0),(P||q)&&et())},el=e=>"".concat(Math.floor(e/60),":").concat(Math.floor(e%60).toString().padStart(2,"0"));return T?(0,n.jsx)(r.Zb,{className:"w-full",children:(0,n.jsxs)(r.aY,{className:"p-6 text-center",children:[(0,n.jsx)("div",{className:"text-red-500 mb-4",children:(0,n.jsx)(E.Z,{className:"h-12 w-12 mx-auto"})}),(0,n.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"播放器錯誤"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:T}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("h4",{className:"text-sm font-medium mb-2",children:"備用播放器:"}),(0,n.jsx)("iframe",{width:"100%",height:"300",src:"https://www.youtube.com/embed/".concat(t,"?rel=0&enablejsapi=1&playsinline=1&vr=1"),title:s,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0})]}),(0,n.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,n.jsx)(a.z,{onClick:()=>window.location.reload(),children:"重新載入"}),(0,n.jsx)(a.z,{onClick:()=>A(null),variant:"outline",children:"重試播放器"})]})]})}):R?(0,n.jsxs)("div",{className:"fixed inset-0 z-50 bg-black",children:[(0,n.jsx)("div",{className:"w-full h-full relative",children:(0,n.jsx)("iframe",{src:"https://www.youtube.com/embed/".concat(t,"?autoplay=1&rel=0&modestbranding=1&playsinline=1&vr=1&enablejsapi=1&controls=1&fs=1&iv_load_policy=3&cc_load_policy=0&showinfo=0&origin=").concat(window.location.origin),title:s,className:"absolute inset-0 w-full h-full",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen",allowFullScreen:!0,style:{border:"none",margin:0,padding:0,display:"block"}})}),(0,n.jsx)(U,{isVisible:$,isMobileDevice:P,isVRHeadset:q}),!P&&(0,n.jsx)("div",{className:"absolute top-4 right-4 z-10 opacity-0 hover:opacity-100 transition-opacity duration-300",children:(0,n.jsxs)(a.z,{onClick:er,variant:"outline",size:"sm",className:"bg-black bg-opacity-70 text-white border-white hover:bg-opacity-90",children:[(0,n.jsx)(Y,{className:"mr-2 h-4 w-4"}),"退出VR"]})}),(P||q)&&(0,n.jsx)("div",{className:"absolute inset-0 z-10",onClick:()=>{er()},style:{pointerEvents:"auto"}}),B&&(0,n.jsxs)("div",{className:"absolute bottom-4 left-4 z-20 text-white text-xs bg-black bg-opacity-50 p-2 rounded",children:[(0,n.jsx)("div",{children:"頭部追蹤已啟用"}),(0,n.jsxs)("div",{children:["X: ",K.x.toFixed(1),"\xb0"]}),(0,n.jsxs)("div",{children:["Y: ",K.y.toFixed(1),"\xb0"]}),(0,n.jsxs)("div",{children:["Z: ",K.z.toFixed(1),"\xb0"]})]})]}):(0,n.jsxs)(r.Zb,{className:"w-full",children:[(0,n.jsxs)(r.Ol,{children:[(0,n.jsxs)(r.ll,{className:"flex items-center justify-between",children:[(0,n.jsx)("span",{children:s}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(c.C,{variant:"outline",children:"YouTube 360\xb0"}),(0,n.jsx)(c.C,{variant:"outline",children:"VR Ready"})]})]}),(0,n.jsx)(r.SZ,{children:"使用A-Frame VR播放器播放360度旅遊影片"})]}),(0,n.jsxs)(r.aY,{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{ref:w,className:"w-full aspect-video bg-gray-900 rounded-lg overflow-hidden"}),!C&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-75",children:(0,n.jsxs)("div",{className:"text-center text-white",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),(0,n.jsx)("p",{children:"載入YouTube播放器中..."})]})})]}),(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,n.jsx)(a.z,{size:"sm",variant:"outline",onClick:()=>{},disabled:!C,title:"向左旋轉",children:(0,n.jsx)(z,{className:"h-4 w-4"})}),(0,n.jsx)(a.z,{size:"sm",variant:"outline",onClick:()=>{N&&C&&(N.stopVideo(),null==u||u())},disabled:!C,title:"停止",children:(0,n.jsx)(y.Z,{className:"h-4 w-4"})}),(0,n.jsx)(a.z,{size:"sm",onClick:x?()=>{N&&C&&(N.pauseVideo(),null==d||d())}:()=>{N&&C&&(N.playVideo(),null==o||o())},disabled:!C,title:x?"暫停":"播放",children:x?(0,n.jsx)(g.Z,{className:"h-4 w-4"}):(0,n.jsx)(v.Z,{className:"h-4 w-4"})}),(0,n.jsx)(a.z,{size:"sm",variant:"outline",onClick:()=>{},disabled:!C,title:"向右旋轉",children:(0,n.jsx)(z,{className:"h-4 w-4"})})]}),(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsxs)(a.z,{size:"lg",onClick:er,disabled:!C,className:"bg-purple-600 hover:bg-purple-700 text-white",children:[(0,n.jsx)(F,{className:"mr-2 h-4 w-4"}),"進入VR模式"]})}),(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,n.jsx)(a.z,{size:"sm",variant:"ghost",onClick:()=>{N&&C&&(j?N.unMute():N.mute())},disabled:!C,title:j?"取消靜音":"靜音",children:j?(0,n.jsx)(D,{className:"h-4 w-4"}):(0,n.jsx)(O,{className:"h-4 w-4"})}),(0,n.jsx)("input",{type:"range",min:"0",max:"100",value:b,onChange:e=>ea(parseInt(e.target.value)),disabled:!C,className:"w-24"}),(0,n.jsxs)("span",{className:"text-sm text-gray-600 w-12 text-center",children:[b,"%"]})]}),(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsxs)(a.z,{size:"sm",variant:"outline",onClick:()=>{N&&C&&(I?(N.exitFullscreen(),L(!1)):(N.requestFullscreen(),L(!0)))},disabled:!C,title:I?"退出全螢幕":"全螢幕",children:[(0,n.jsx)(V,{className:"h-4 w-4"}),I?"退出全螢幕":"全螢幕"]})}),C&&(0,n.jsxs)("div",{className:"text-center text-sm text-gray-600",children:[(0,n.jsx)("span",{children:el(p)}),(0,n.jsx)("span",{className:"mx-2",children:"/"}),(0,n.jsx)("span",{children:el(f)})]}),(0,n.jsx)("div",{className:"text-center text-xs text-gray-500 bg-blue-50 p-2 rounded",children:'\uD83D\uDCA1 提示：點擊"進入VR模式"體驗360度沉浸式觀看，使用滑鼠拖拽或VR控制器旋轉視角'}),(0,n.jsx)("div",{className:"text-center",children:(0,n.jsxs)(a.z,{size:"sm",variant:"ghost",onClick:()=>_(!M),className:"text-gray-500",children:[M?(0,n.jsx)(Y,{className:"h-4 w-4"}):(0,n.jsx)(F,{className:"h-4 w-4"}),M?"隱藏控制":"顯示控制"]})})]})]})}var q=s(2759),J=s(9388),B=s(3388);let H=(0,u.Z)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);var Q=s(2431);let G=(0,u.Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var K=s(2926);let X=(0,u.Z)("Bluetooth",[["path",{d:"m7 7 10 10-5 5V2l5 5L7 17",key:"1q5490"}]]);var $=s(1085);class ee extends $.EventEmitter{async connect(){var e;if(this.isConnecting||(null===(e=this.ws)||void 0===e?void 0:e.readyState)===WebSocket.OPEN)return!0;this.isConnecting=!0;try{return this.ws=new WebSocket(this.config.url),new Promise(e=>{let t=setTimeout(()=>{this.emit("error",Error("Connection timeout")),e(!1)},this.config.timeout);this.ws.onopen=()=>{clearTimeout(t),this.isConnecting=!1,this.reconnectAttempts=0,this.emit("connected"),this.startHeartbeat(),this.flushMessageQueue(),e(!0)},this.ws.onclose=t=>{this.isConnecting=!1,this.stopHeartbeat(),this.emit("disconnected",t),this.scheduleReconnect(),e(!1)},this.ws.onerror=t=>{this.isConnecting=!1,this.emit("error",t),e(!1)},this.ws.onmessage=e=>{try{let t=JSON.parse(e.data);this.emit("message",t),this.emit(t.type,t.data)}catch(e){this.emit("error",Error("Invalid message format"))}}})}catch(e){return this.isConnecting=!1,this.emit("error",e),!1}}send(e,t,s){var n;let i={type:e,data:t,timestamp:Date.now(),id:s};return(null===(n=this.ws)||void 0===n?void 0:n.readyState)===WebSocket.OPEN?(this.ws.send(JSON.stringify(i)),!0):(this.messageQueue.push(i),!1)}async sendWithResponse(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;return new Promise((n,i)=>{let a=Math.random().toString(36).substr(2,9),r=setTimeout(()=>{this.removeListener("response:".concat(a),n),i(Error("Response timeout"))},s);this.once("response:".concat(a),e=>{clearTimeout(r),n(e)}),this.send(e,t,a)})}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.stopHeartbeat(),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}getConnectionState(){if(!this.ws)return"disconnected";switch(this.ws.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"connected";case WebSocket.CLOSING:return"closing";case WebSocket.CLOSED:return"closed";default:return"unknown"}}isConnected(){var e;return(null===(e=this.ws)||void 0===e?void 0:e.readyState)===WebSocket.OPEN}startHeartbeat(){this.heartbeatTimer=setInterval(()=>{this.isConnected()&&this.send("heartbeat",{timestamp:Date.now()})},this.config.heartbeatInterval)}stopHeartbeat(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}scheduleReconnect(){if(this.reconnectAttempts>=this.config.maxReconnectAttempts){this.emit("maxReconnectAttemptsReached");return}this.reconnectTimer=setTimeout(()=>{this.reconnectAttempts++,this.connect()},this.config.reconnectInterval*Math.pow(2,this.reconnectAttempts))}flushMessageQueue(){for(;this.messageQueue.length>0;){var e;let t=this.messageQueue.shift();null===(e=this.ws)||void 0===e||e.send(JSON.stringify(t))}}createConnectionPool(e){return e.forEach(e=>{if(!this.connectionPool.has(e)){let t=new WebSocket(e);this.connectionPool.set(e,t)}}),this.connectionPool}getConnectionPoolStatus(){let e={};return this.connectionPool.forEach((t,s)=>{e[s]=this.getConnectionState()}),e}constructor(e={}){super(),this.ws=null,this.reconnectAttempts=0,this.heartbeatTimer=null,this.reconnectTimer=null,this.isConnecting=!1,this.messageQueue=[],this.connectionPool=new Map,this.config={url:e.url||"ws://localhost:3001",reconnectInterval:e.reconnectInterval||1e3,maxReconnectAttempts:e.maxReconnectAttempts||10,heartbeatInterval:e.heartbeatInterval||3e4,timeout:e.timeout||5e3}}}let et=new ee;class es extends $.EventEmitter{initializeWebSocket(){et.on("connected",()=>{this.emit("websocketConnected"),this.syncDeviceStates()}),et.on("disconnected",()=>{this.emit("websocketDisconnected")}),et.on("deviceDiscovered",e=>{this.addDevice(e)}),et.on("deviceStatusChanged",e=>{this.updateDeviceStatus(e.deviceId,e.status,e.metadata)})}setupEventHandlers(){et.on("message",e=>{switch(e.type){case"deviceList":this.updateDeviceList(e.data);break;case"deviceUpdate":this.updateDevice(e.data);break;case"deviceRemoved":this.removeDevice(e.data.deviceId)}})}async scanDevices(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.scanInProgress)throw Error("Device scan already in progress");this.scanInProgress=!0,this.emit("scanStarted");try{let t=await et.sendWithResponse("scanDevices",{methods:e.methods||["wifi","bluetooth"],timeout:e.timeout||1e4,filterTypes:e.filterTypes});if(t.success)return this.updateDeviceList(t.devices),this.emit("scanCompleted",t.devices),t.devices;throw Error(t.error||"Device scan failed")}catch(e){throw this.emit("scanError",e),e}finally{this.scanInProgress=!1,this.emit("scanStopped")}}async connectDevice(e){let t=this.devices.get(e);if(!t)return{success:!1,device:{},error:"Device not found"};if("connected"===t.status)return{success:!0,device:t,connectionId:e};try{this.updateDeviceStatus(e,"connecting");let s=await et.sendWithResponse("connectDevice",{deviceId:e,deviceType:t.type,connectionMethod:t.connectionMethod});if(s.success)return this.updateDeviceStatus(e,"connected"),this.activeConnections.set(e,t),this.emit("deviceConnected",t),{success:!0,device:t,connectionId:s.connectionId};return this.updateDeviceStatus(e,"error"),{success:!1,device:t,error:s.error}}catch(s){return this.updateDeviceStatus(e,"error"),{success:!1,device:t,error:s instanceof Error?s.message:"Connection failed"}}}async disconnectDevice(e){let t=this.devices.get(e);if(!t||"connected"!==t.status)return!1;try{var s;if((await et.sendWithResponse("disconnectDevice",{deviceId:e,connectionId:null===(s=this.activeConnections.get(e))||void 0===s?void 0:s.id})).success)return this.updateDeviceStatus(e,"disconnected"),this.activeConnections.delete(e),this.emit("deviceDisconnected",t),!0;return!1}catch(e){return!1}}getDevices(){return Array.from(this.devices.values())}getConnectedDevices(){return Array.from(this.activeConnections.values())}getDeviceStatus(e){let t=this.devices.get(e);return(null==t?void 0:t.status)||null}addDevice(e){let t={id:e.id,name:e.name,type:e.type,ip:e.ip,macAddress:e.macAddress,status:"discovered",capabilities:e.capabilities||[],batteryLevel:e.batteryLevel,lastSeen:new Date,connectionMethod:e.connectionMethod,metadata:e.metadata};this.devices.set(t.id,t),this.emit("deviceAdded",t)}updateDevice(e){let t=this.devices.get(e.id);if(t){let s={...t,...e};this.devices.set(e.id,s),this.emit("deviceUpdated",s)}}updateDeviceStatus(e,t,s){let n=this.devices.get(e);n&&(n.status=t,n.lastSeen=new Date,s&&(n.metadata={...n.metadata,...s}),this.devices.set(e,n),this.emit("deviceStatusChanged",{deviceId:e,status:t,device:n}))}removeDevice(e){let t=this.devices.get(e);t&&(this.devices.delete(e),this.activeConnections.delete(e),this.emit("deviceRemoved",t))}updateDeviceList(e){e.forEach(e=>{this.addDevice(e)})}async syncDeviceStates(){try{let e=await et.sendWithResponse("getDeviceStates",{});e.success&&e.devices.forEach(e=>{this.updateDevice(e)})}catch(e){}}getDeviceCapabilities(e){return Array.from(this.deviceCapabilities.get(e)||[])}deviceSupports(e,t){let s=this.deviceCapabilities.get(e);return(null==s?void 0:s.has(t))||!1}getConnectionStats(){let e=Array.from(this.devices.values());return{totalDevices:e.length,connectedDevices:e.filter(e=>"connected"===e.status).length,disconnectedDevices:e.filter(e=>"disconnected"===e.status).length,errorDevices:e.filter(e=>"error"===e.status).length}}cleanupOfflineDevices(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=new Date,s=6e4*e;this.devices.forEach((e,n)=>{t.getTime()-e.lastSeen.getTime()>s&&this.removeDevice(n)})}reset(){this.devices.clear(),this.activeConnections.clear(),this.connectionPool.clear(),this.deviceCapabilities.clear(),this.scanInProgress=!1,this.emit("reset")}constructor(){super(),this.devices=new Map,this.activeConnections=new Map,this.scanInProgress=!1,this.connectionPool=new Map,this.deviceCapabilities=new Map,this.initializeWebSocket(),this.setupEventHandlers()}}let en=new es,ei=0,ea=new Map,er=e=>{if(ea.has(e))return;let t=setTimeout(()=>{ea.delete(e),ed({type:"REMOVE_TOAST",toastId:e})},1e6);ea.set(e,t)},el=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?er(s):e.toasts.forEach(e=>{er(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},ec=[],eo={toasts:[]};function ed(e){eo=el(eo,e),ec.forEach(e=>{e(eo)})}function eu(e){let{...t}=e,s=(ei=(ei+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>ed({type:"DISMISS_TOAST",toastId:s});return ed({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||n()}}}),{id:s,dismiss:n,update:e=>ed({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function em(){let[e,t]=(0,i.useState)([]),[s,d]=(0,i.useState)({isScanning:!1,progress:0,currentMethod:"",discoveredCount:0,errorCount:0}),[u,p]=(0,i.useState)("disconnected"),[v,f]=(0,i.useState)("all"),[g,y]=(0,i.useState)(!1);(0,i.useEffect)(()=>((async()=>{try{await et.connect()&&(p("connected"),eu({title:"連接成功",description:"WebSocket連接已建立",variant:"default"}))}catch(e){p("error"),eu({title:"連接失敗",description:"無法連接到服務器",variant:"destructive"})}})(),et.on("connected",()=>{p("connected"),eu({title:"重新連接成功",description:"WebSocket連接已恢復",variant:"default"})}),et.on("disconnected",()=>{p("disconnected"),eu({title:"連接斷開",description:"WebSocket連接已斷開",variant:"destructive"})}),en.on("deviceAdded",e=>{t(t=>t.find(t=>t.id===e.id)?t:[...t,e])}),en.on("deviceUpdated",e=>{t(t=>t.map(t=>t.id===e.id?e:t))}),en.on("deviceRemoved",e=>{t(t=>t.filter(t=>t.id!==e.id))}),en.on("scanStarted",()=>{d(e=>({...e,isScanning:!0,progress:0}))}),en.on("scanCompleted",e=>{d(t=>({...t,isScanning:!1,progress:100,discoveredCount:e.length})),eu({title:"掃描完成",description:"發現 ".concat(e.length," 個設備"),variant:"default"})}),en.on("scanError",e=>{d(e=>({...e,isScanning:!1,errorCount:e.errorCount+1})),eu({title:"掃描錯誤",description:e.message||"設備掃描失敗",variant:"destructive"})}),()=>{et.removeAllListeners(),en.removeAllListeners()}),[]),(0,i.useEffect)(()=>{if(!g)return;let e=setInterval(()=>{"connected"!==u||s.isScanning||S()},3e4);return()=>clearInterval(e)},[g,u,s.isScanning]);let j=(0,i.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["wifi","bluetooth"];if(!s.isScanning)try{d(t=>({...t,isScanning:!0,progress:0,currentMethod:e.join(", "),discoveredCount:0,errorCount:0}));let s=setInterval(()=>{d(e=>e.progress<90?{...e,progress:e.progress+10}:e)},200),n=await en.scanDevices({methods:e,timeout:1e4});clearInterval(s),d(e=>({...e,progress:100})),t(n),eu({title:"掃描完成",description:"發現 ".concat(n.length," 個設備"),variant:"default"})}catch(e){d(e=>({...e,isScanning:!1,errorCount:e.errorCount+1})),eu({title:"掃描失敗",description:e instanceof Error?e.message:"未知錯誤",variant:"destructive"})}finally{setTimeout(()=>{d(e=>({...e,isScanning:!1}))},1e3)}},[s.isScanning]),w=(0,i.useCallback)(async e=>{try{let t=await en.connectDevice(e);t.success?eu({title:"連接成功",description:"".concat(t.device.name," 已連接"),variant:"default"}):eu({title:"連接失敗",description:t.error||"無法連接到設備",variant:"destructive"})}catch(e){eu({title:"連接錯誤",description:e instanceof Error?e.message:"未知錯誤",variant:"destructive"})}},[]),N=(0,i.useCallback)(async e=>{try{await en.disconnectDevice(e)?eu({title:"斷開成功",description:"設備已斷開連接",variant:"default"}):eu({title:"斷開失敗",description:"無法斷開設備連接",variant:"destructive"})}catch(e){eu({title:"斷開錯誤",description:e instanceof Error?e.message:"未知錯誤",variant:"destructive"})}},[]),S=(0,i.useCallback)(async()=>{try{let e=en.getDevices();t(e)}catch(e){}},[]),C=(0,i.useMemo)(()=>"all"===v?e:e.filter(e=>{switch(v){case"vr":return"vr"===e.type;case"mobile":return"mobile"===e.type;case"desktop":return"desktop"===e.type;case"connected":return"connected"===e.status;case"discovered":return"discovered"===e.status;default:return!0}}),[e,v]),k=(0,i.useMemo)(()=>en.getConnectionStats(),[e]),E=e=>{switch(e){case"connected":return(0,n.jsx)(h.Z,{className:"h-4 w-4 text-green-500"});case"connecting":return(0,n.jsx)(m,{className:"h-4 w-4 text-yellow-500 animate-pulse"});case"error":return(0,n.jsx)(J.Z,{className:"h-4 w-4 text-red-500"});case"discovered":return(0,n.jsx)(b.Z,{className:"h-4 w-4 text-blue-500"});default:return(0,n.jsx)(J.Z,{className:"h-4 w-4 text-gray-500"})}},T=e=>{switch(e){case"vr":case"desktop":default:return(0,n.jsx)(o.Z,{className:"h-4 w-4"});case"mobile":case"tablet":return(0,n.jsx)(B.Z,{className:"h-4 w-4"})}};return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)(r.Zb,{children:[(0,n.jsxs)(r.Ol,{children:[(0,n.jsxs)(r.ll,{className:"flex items-center gap-2",children:[(0,n.jsx)(H,{className:"h-5 w-5"}),"設備掃描器"]}),(0,n.jsx)(r.SZ,{children:"發現和連接VR設備、移動設備和桌面設備"})]}),(0,n.jsxs)(r.aY,{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(c.C,{variant:"connected"===u?"default":"destructive",children:"connected"===u?"已連接":"未連接"}),(0,n.jsx)("span",{className:"text-sm text-muted-foreground",children:"connected"===u?"WebSocket連接正常":"無法連接到服務器"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)(a.z,{variant:"outline",size:"sm",onClick:S,disabled:s.isScanning,children:[(0,n.jsx)(Q.Z,{className:"h-4 w-4"}),"刷新"]}),(0,n.jsxs)(a.z,{variant:"outline",size:"sm",onClick:()=>y(!g),className:g?"bg-primary text-primary-foreground":"",children:[(0,n.jsx)(G,{className:"h-4 w-4"}),"自動刷新"]})]})]}),s.isScanning&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,n.jsxs)("span",{children:["正在掃描: ",s.currentMethod]}),(0,n.jsxs)("span",{children:[s.progress,"%"]})]}),(0,n.jsx)(q.E,{value:s.progress,className:"w-full"})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsxs)(a.z,{onClick:()=>j(["wifi"]),disabled:s.isScanning||"connected"!==u,className:"flex-1",children:[(0,n.jsx)(K.Z,{className:"h-4 w-4 mr-2"}),"掃描WiFi設備"]}),(0,n.jsxs)(a.z,{onClick:()=>j(["bluetooth"]),disabled:s.isScanning||"connected"!==u,className:"flex-1",children:[(0,n.jsx)(X,{className:"h-4 w-4 mr-2"}),"掃描藍牙設備"]}),(0,n.jsxs)(a.z,{onClick:()=>j(["wifi","bluetooth"]),disabled:s.isScanning||"connected"!==u,className:"flex-1",children:[(0,n.jsx)(x,{className:"h-4 w-4 mr-2"}),"掃描所有設備"]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-4 gap-4 text-center",children:[(0,n.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-primary",children:k.totalDevices}),(0,n.jsx)("div",{className:"text-xs text-muted-foreground",children:"總設備"})]}),(0,n.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-600",children:k.connectedDevices}),(0,n.jsx)("div",{className:"text-xs text-muted-foreground",children:"已連接"})]}),(0,n.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:k.disconnectedDevices}),(0,n.jsx)("div",{className:"text-xs text-muted-foreground",children:"未連接"})]}),(0,n.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-red-600",children:k.errorDevices}),(0,n.jsx)("div",{className:"text-xs text-muted-foreground",children:"錯誤"})]})]})]})]}),(0,n.jsxs)(r.Zb,{children:[(0,n.jsxs)(r.Ol,{children:[(0,n.jsx)(r.ll,{children:"設備列表"}),(0,n.jsxs)(r.SZ,{children:["發現的設備 (",C.length,")"]})]}),(0,n.jsx)(r.aY,{children:(0,n.jsxs)(l.mQ,{value:v,onValueChange:f,children:[(0,n.jsxs)(l.dr,{className:"grid w-full grid-cols-6",children:[(0,n.jsx)(l.SP,{value:"all",children:"全部"}),(0,n.jsx)(l.SP,{value:"vr",children:"VR設備"}),(0,n.jsx)(l.SP,{value:"mobile",children:"移動設備"}),(0,n.jsx)(l.SP,{value:"desktop",children:"桌面設備"}),(0,n.jsx)(l.SP,{value:"connected",children:"已連接"}),(0,n.jsx)(l.SP,{value:"discovered",children:"已發現"})]}),(0,n.jsx)(l.nU,{value:v,className:"mt-4",children:0===C.length?(0,n.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"all"===v?"暫無設備":"暫無".concat(v,"設備")}):(0,n.jsx)("div",{className:"grid gap-4",children:C.map(e=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[T(e.type),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-medium",children:e.name}),(0,n.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.ip&&"IP: ".concat(e.ip),e.macAddress&&" • MAC: ".concat(e.macAddress)]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,n.jsx)(c.C,{variant:"outline",className:"text-xs",children:e.type.toUpperCase()}),(0,n.jsx)(c.C,{variant:"outline",className:"text-xs",children:e.connectionMethod}),e.batteryLevel&&(0,n.jsxs)(c.C,{variant:"outline",className:"text-xs",children:["電池: ",e.batteryLevel,"%"]})]})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[E(e.status),(0,n.jsx)("span",{className:"text-sm capitalize",children:e.status})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:["discovered"===e.status&&(0,n.jsx)(a.z,{size:"sm",onClick:()=>w(e.id),disabled:s.isScanning,children:"連接"}),"connected"===e.status&&(0,n.jsx)(a.z,{size:"sm",variant:"outline",onClick:()=>N(e.id),disabled:s.isScanning,children:"斷開"})]})]})]},e.id))})})]})})]})]})}function eh(){let[e,t]=(0,i.useState)(null),[u,N]=(0,i.useState)([]),[S,C]=(0,i.useState)([]),[k,E]=(0,i.useState)(!1),[T,z]=(0,i.useState)(!1),[A,D]=(0,i.useState)(null),[O,V]=(0,i.useState)("stopped"),[I,L]=(0,i.useState)(null),[R,Z]=(0,i.useState)(!1),[_,Y]=(0,i.useState)(!1),[F,U]=(0,i.useState)("all"),[q,J]=(0,i.useState)("dashboard"),[B,H]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(()=>{try{let e=localStorage.getItem("vr-travel-videos");if(e){let t=JSON.parse(e),s=t.filter(e=>e.embedUrl&&e.embedUrl.includes("youtube.com/embed"));s.length!==t.length&&localStorage.setItem("vr-travel-videos",JSON.stringify(s))}}catch(e){}})();let e=localStorage.getItem("user");if(e)try{t(JSON.parse(e)),Q()}catch(e){localStorage.removeItem("user")}},[]);let Q=async()=>{try{let e=M.getAllVideos(),t=await fetch("http://localhost:3001/api/devices"),s=e.map(e=>({id:e.id,title:e.title,category:e.country,type:"youtube",duration:e.duration,thumbnail:e.thumbnail,embedUrl:e.embedUrl,country:e.country,tags:e.tags,addedAt:e.addedAt,viewCount:e.viewCount}));if(C(s),t.ok){let e=await t.json();N(e.data)}}catch(e){C(M.getAllVideos().map(e=>({id:e.id,title:e.title,category:e.country,type:"youtube",duration:e.duration,thumbnail:e.thumbnail,embedUrl:e.embedUrl,country:e.country,tags:e.tags,addedAt:e.addedAt,viewCount:e.viewCount})))}},G=async(e,s)=>{try{let n=await fetch("http://localhost:5001/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s})}),i=await n.json();if(i.success){localStorage.setItem("token",i.token),localStorage.setItem("jwt_token",i.token);let e={id:i.user.id,email:i.user.email,username:i.user.email.split("@")[0],role:"controller"===i.user.role?"admin":"user"};t(e),localStorage.setItem("user",JSON.stringify(e)),await Q()}else alert(i.message||"登錄失敗")}catch(e){alert("登錄失敗: "+e.message)}},K=async(e,t,s)=>{try{if(t!==s){alert("密碼不匹配");return}if(t.length<6){alert("密碼至少需要6個字符");return}let n=await fetch("http://localhost:5001/api/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),i=await n.json();i.success?(alert(i.message||"註冊成功，請登錄"),H(!1)):alert(i.message||"註冊失敗")}catch(e){alert("註冊失敗: "+e.message)}},X=async()=>{try{let e={id:"guest",username:"訪客",email:"",role:"guest"};t(e),localStorage.setItem("user",JSON.stringify(e)),await Q()}catch(e){alert("訪客登錄失敗: "+e.message)}},$=e=>{try{M.removeVideo(e)&&Q()}catch(e){}},ee=async e=>{try{if(D(e),V("playing"),0===u.length){eu({title:"視頻播放中",description:"".concat(e.title," 正在播放（預覽模式）")});return}let t=u.find(e=>"connected"===e.status);if(!t){eu({title:"視頻播放中",description:"".concat(e.title," 正在播放（預覽模式）")});return}try{(await fetch("http://localhost:3001/api/play",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceId:t.id,videoId:e.id})})).ok?eu({title:"播放成功",description:"".concat(e.title," 正在設備 ").concat(t.name," 上播放")}):eu({title:"本地播放",description:"".concat(e.title," 正在本地播放")})}catch(t){eu({title:"本地播放",description:"".concat(e.title," 正在本地播放")})}}catch(e){eu({title:"播放失敗",description:"無法播放視頻，請重試",variant:"destructive"})}},et=async()=>{try{(await fetch("http://localhost:3001/api/pause",{method:"POST",headers:{"Content-Type":"application/json"}})).ok?V("paused"):alert("暫停失敗")}catch(e){alert("暫停失敗: "+e)}},es=async()=>{try{(await fetch("http://localhost:3001/api/stop",{method:"POST",headers:{"Content-Type":"application/json"}})).ok?(D(null),V("stopped")):alert("停止失敗")}catch(e){alert("停止失敗: "+e)}},en=async e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s)try{let e=new FormData;e.append("video",s),e.append("title",s.name),e.append("category","上傳"),e.append("description","用戶上傳的視頻文件");let t=await fetch("http://localhost:3001/api/upload",{method:"POST",body:e});t.ok?(await t.json(),await Q(),alert("上傳成功: "+s.name)):alert("上傳失敗")}catch(e){alert("上傳失敗: "+e.message)}},ei=async()=>{try{let e=Date.now(),t=!1,n=0;try{(await fetch("http://localhost:5001/api/health")).ok&&(t=!0,n=Date.now()-e)}catch(e){}let i=!1;try{let{io:e}=await s.e(680).then(s.bind(s,8680)),t=e("http://localhost:5001",{transports:["polling","websocket"],timeout:5e3,forceNew:!0});await new Promise((e,s)=>{let n=setTimeout(()=>{s(Error("WebSocket連接超時"))},5e3);t.on("connect",()=>{clearTimeout(n),i=!0,t.disconnect(),e(!0)}),t.on("connect_error",e=>{clearTimeout(n),s(e)})})}catch(e){}let a={network:{connected:t,latency:n||0},websocket:{connected:i},webgl:{webgl1:!!document.createElement("canvas").getContext("webgl"),webgl2:!!document.createElement("canvas").getContext("webgl2")},webrtc:!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)};L(a)}catch(e){L({network:{connected:!1,latency:0},websocket:{connected:!1},webgl:{webgl1:!1,webgl2:!1},webrtc:!1,error:e instanceof Error?e.message:String(e)})}};return e?(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,n.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,n.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,n.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(o.Z,{className:"h-8 w-8 text-blue-600"}),(0,n.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"VR視頻管理系統"}),(0,n.jsx)(c.C,{variant:T?"default":"secondary",children:T?"已連接":"未連接"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsxs)("span",{className:"text-sm text-gray-600",children:["歡迎, ",e.username]}),(0,n.jsx)(a.z,{variant:"outline",size:"sm",onClick:()=>{localStorage.removeItem("user"),t(null)},children:"登出"})]})]})})}),(0,n.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,n.jsxs)(l.mQ,{value:q,onValueChange:J,className:"space-y-6",children:[(0,n.jsxs)(l.dr,{className:"grid w-full grid-cols-5",children:[(0,n.jsx)(l.SP,{value:"dashboard",children:"儀表板"}),(0,n.jsx)(l.SP,{value:"devices",children:"設備管理"}),(0,n.jsx)(l.SP,{value:"videos",children:"視頻管理"}),(0,n.jsx)(l.SP,{value:"control",children:"播放控制"}),(0,n.jsx)(l.SP,{value:"diagnostics",children:"系統診斷"})]}),(0,n.jsxs)(l.nU,{value:"dashboard",className:"space-y-6",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,n.jsxs)(r.Zb,{children:[(0,n.jsxs)(r.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,n.jsx)(r.ll,{className:"text-sm font-medium",children:"連接設備"}),(0,n.jsx)(o.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,n.jsxs)(r.aY,{children:[(0,n.jsx)("div",{className:"text-2xl font-bold",children:u.length}),(0,n.jsxs)("p",{className:"text-xs text-muted-foreground",children:[u.filter(e=>"connected"===e.status).length," 在線"]})]})]}),(0,n.jsxs)(r.Zb,{children:[(0,n.jsxs)(r.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,n.jsx)(r.ll,{className:"text-sm font-medium",children:"視頻庫"}),(0,n.jsx)(d.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,n.jsxs)(r.aY,{children:[(0,n.jsx)("div",{className:"text-2xl font-bold",children:S.length}),(0,n.jsxs)("p",{className:"text-xs text-muted-foreground",children:[S.filter(e=>"local"===e.type).length," 本地,"," ",S.filter(e=>"youtube"===e.type).length," YouTube"]})]})]}),(0,n.jsxs)(r.Zb,{children:[(0,n.jsxs)(r.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,n.jsx)(r.ll,{className:"text-sm font-medium",children:"播放狀態"}),(0,n.jsx)(m,{className:"h-4 w-4 text-muted-foreground"})]}),(0,n.jsxs)(r.aY,{children:[(0,n.jsx)("div",{className:"text-2xl font-bold capitalize",children:O}),(0,n.jsx)("p",{className:"text-xs text-muted-foreground",children:A?A.title:"無播放內容"})]})]}),(0,n.jsxs)(r.Zb,{children:[(0,n.jsxs)(r.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,n.jsx)(r.ll,{className:"text-sm font-medium",children:"系統狀態"}),(0,n.jsx)(h.Z,{className:"h-4 w-4 text-green-500"})]}),(0,n.jsxs)(r.aY,{children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-600",children:"正常"}),(0,n.jsx)("p",{className:"text-xs text-muted-foreground",children:"所有服務運行中"})]})]})]}),A&&(0,n.jsxs)(r.Zb,{children:[(0,n.jsx)(r.Ol,{children:(0,n.jsx)(r.ll,{children:"當前播放"})}),(0,n.jsx)(r.aY,{children:(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)("img",{src:A.thumbnail||"/placeholder.svg",alt:A.title,className:"w-24 h-16 object-cover rounded"}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("h3",{className:"font-semibold",children:A.title}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:A.category}),(0,n.jsx)(c.C,{variant:"outline",children:O})]})]})})]})]}),(0,n.jsx)(l.nU,{value:"devices",className:"space-y-6",children:(0,n.jsx)(em,{})}),(0,n.jsxs)(l.nU,{value:"videos",className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold",children:"視頻管理"}),(0,n.jsxs)("div",{className:"space-x-2",children:[(0,n.jsxs)(a.z,{variant:"outline",onClick:()=>Y(!0),className:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100",children:[(0,n.jsx)(x,{className:"mr-2 h-4 w-4"}),"搜索YouTube VR影片"]}),(0,n.jsx)("input",{type:"file",accept:"video/*",onChange:en,className:"hidden",id:"video-upload"}),(0,n.jsxs)(a.z,{onClick:()=>{var e;return null===(e=document.getElementById("video-upload"))||void 0===e?void 0:e.click()},children:[(0,n.jsx)(p,{className:"mr-2 h-4 w-4"}),"上傳視頻"]})]})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,n.jsx)(a.z,{variant:"outline",size:"sm",onClick:()=>{U("all"),Q()},className:"".concat("all"===F?"bg-blue-50 border-blue-200 text-blue-700":""),children:"全部"}),["亞洲","歐洲","中東","非洲","北美洲","南美洲","大洋洲","北極","南極"].map(e=>(0,n.jsx)(a.z,{variant:"outline",size:"sm",onClick:()=>{U(e),C(M.getAllVideos().filter(t=>t.country===e).map(e=>({id:e.id,title:e.title,category:e.country,type:"youtube",duration:e.duration,thumbnail:e.thumbnail,embedUrl:e.embedUrl,country:e.country,tags:e.tags,addedAt:e.addedAt,viewCount:e.viewCount})))},className:"".concat(F===e?"bg-blue-50 border-blue-200 text-blue-700":""),children:e},e))]}),(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(e=>(0,n.jsxs)(r.Zb,{className:"hover:shadow-md transition-shadow",children:[(0,n.jsx)(r.Ol,{className:"p-4",children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("img",{src:e.thumbnail||"/placeholder.svg",alt:e.title,className:"w-full h-32 object-cover rounded"}),"youtube"===e.type&&(0,n.jsx)(c.C,{className:"absolute top-2 right-2 bg-red-600",children:"YouTube"}),void 0!==e.viewCount&&e.viewCount>0&&(0,n.jsxs)("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded",children:["\uD83D\uDC41 ",e.viewCount]})]})}),(0,n.jsxs)(r.aY,{className:"p-4",children:[(0,n.jsx)("h3",{className:"font-semibold mb-2 line-clamp-2 text-sm",children:e.title}),(0,n.jsxs)("div",{className:"space-y-1 text-xs text-gray-600",children:[(0,n.jsxs)("p",{children:["地區: ",e.category]}),(0,n.jsxs)("p",{children:["時長: ",e.duration]}),(0,n.jsxs)("p",{children:["類型: ","youtube"===e.type?"YouTube 360\xb0":"本地文件"]}),e.addedAt&&(0,n.jsxs)("p",{children:["添加: ",new Date(e.addedAt).toLocaleDateString()]}),e.tags&&e.tags.length>0&&(0,n.jsx)("div",{className:"flex flex-wrap gap-1 mt-2",children:e.tags.slice(0,3).map((e,t)=>(0,n.jsx)(c.C,{variant:"outline",className:"text-xs",children:e},t))})]}),(0,n.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,n.jsxs)(a.z,{size:"sm",onClick:()=>{ee(e),J("control")},className:"flex-1",children:[(0,n.jsx)(v.Z,{className:"mr-1 h-3 w-3"}),"播放"]}),"youtube"===e.type&&(0,n.jsx)(a.z,{size:"sm",variant:"outline",onClick:()=>$(e.id),className:"text-red-600 hover:text-red-700",children:(0,n.jsx)(f,{className:"h-3 w-3"})})]})]})]},e.id))}),0===S.length&&(0,n.jsx)(r.Zb,{children:(0,n.jsxs)(r.aY,{className:"text-center py-12",children:[(0,n.jsx)(d.Z,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"沒有YouTube VR影片"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:"請搜索並添加YouTube VR/360度旅遊影片"}),(0,n.jsxs)(a.z,{onClick:()=>Y(!0),className:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100",children:[(0,n.jsx)(x,{className:"mr-2 h-4 w-4"}),"搜索YouTube VR影片"]})]})})]}),(0,n.jsxs)(l.nU,{value:"control",className:"space-y-6",children:[(0,n.jsxs)(r.Zb,{children:[(0,n.jsxs)(r.Ol,{children:[(0,n.jsx)(r.ll,{children:"播放控制面板"}),(0,n.jsx)(r.SZ,{children:"控制所有連接設備的視頻播放"})]}),(0,n.jsxs)(r.aY,{children:[(0,n.jsxs)("div",{className:"flex justify-center space-x-4 mb-6",children:[(0,n.jsx)(a.z,{size:"lg",disabled:!A||0===u.length,onClick:()=>"playing"===O?et():A&&ee(A),children:"playing"===O?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g.Z,{className:"mr-2 h-5 w-5"}),"暫停"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.Z,{className:"mr-2 h-5 w-5"}),"播放"]})}),(0,n.jsxs)(a.z,{size:"lg",variant:"outline",disabled:!A,onClick:es,children:[(0,n.jsx)(y.Z,{className:"mr-2 h-5 w-5"}),"停止"]}),(0,n.jsxs)(a.z,{size:"lg",variant:"destructive",disabled:0===u.length,onClick:()=>{es()},children:[(0,n.jsx)(b.Z,{className:"mr-2 h-5 w-5"}),"緊急停止"]})]}),A&&(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-2",children:A.title}),(0,n.jsx)(c.C,{variant:"outline",children:O})]}),0===u.length&&(0,n.jsx)("div",{className:"text-center text-gray-500",children:(0,n.jsx)("p",{children:"請先連接VR設備才能進行播放控制"})})]})]}),(0,n.jsxs)(r.Zb,{children:[(0,n.jsxs)(r.Ol,{children:[(0,n.jsxs)(r.ll,{className:"flex items-center gap-2",children:[(0,n.jsx)(j.Z,{className:"h-5 w-5"}),"VR旅遊團同步播放"]}),(0,n.jsx)(r.SZ,{children:"創建旅遊團，與朋友一起同步觀看VR 360度旅遊視頻"})]}),(0,n.jsxs)(r.aY,{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,n.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[(0,n.jsx)(w.Z,{className:"h-8 w-8 text-blue-600 mx-auto mb-2"}),(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:u.length}),(0,n.jsx)("div",{className:"text-sm text-blue-600",children:"連接設備"})]}),(0,n.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[(0,n.jsx)(d.Z,{className:"h-8 w-8 text-green-600 mx-auto mb-2"}),(0,n.jsx)("div",{className:"text-2xl font-bold text-green-600",children:S.length}),(0,n.jsx)("div",{className:"text-sm text-green-600",children:"可用視頻"})]}),(0,n.jsxs)("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[(0,n.jsx)(j.Z,{className:"h-8 w-8 text-purple-600 mx-auto mb-2"}),(0,n.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:"0"}),(0,n.jsx)("div",{className:"text-sm text-purple-600",children:"活躍旅遊團"})]})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-3 justify-center",children:[(0,n.jsxs)(a.z,{size:"lg",onClick:()=>Y(!0),className:"bg-blue-600 hover:bg-blue-700",children:[(0,n.jsx)(x,{className:"mr-2 h-4 w-4"}),"搜索旅遊視頻"]}),(0,n.jsxs)(a.z,{size:"lg",variant:"outline",onClick:()=>{eu({title:"旅遊團功能",description:"VR旅遊團功能已整合到現有系統中"})},children:[(0,n.jsx)(w.Z,{className:"mr-2 h-4 w-4"}),"創建旅遊團"]}),(0,n.jsxs)(a.z,{size:"lg",variant:"outline",disabled:!A,onClick:()=>{A&&eu({title:"開始旅遊團",description:"已選擇視頻: ".concat(A.title)})},children:[(0,n.jsx)(v.Z,{className:"mr-2 h-4 w-4"}),"開始同步播放"]})]}),(0,n.jsxs)("div",{className:"text-center text-sm text-gray-600 bg-gray-50 p-4 rounded-lg",children:[(0,n.jsx)("p",{className:"font-medium mb-2",children:"\uD83D\uDCA1 VR旅遊團功能說明"}),(0,n.jsx)("p",{children:"• 搜索並選擇VR 360度旅遊視頻"}),(0,n.jsx)("p",{children:"• 創建旅遊團邀請朋友加入"}),(0,n.jsx)("p",{children:"• 所有參與者同步觀看同一視頻"}),(0,n.jsx)("p",{children:"• 支持實時聊天和互動"})]})]})]}),A&&"youtube"===A.type&&A.embedUrl&&(0,n.jsx)(W,{videoId:A.id,title:A.title,embedUrl:A.embedUrl,onPlay:()=>V("playing"),onPause:()=>V("paused"),onStop:()=>V("stopped"),isPlaying:"playing"===O})]}),(0,n.jsxs)(l.nU,{value:"diagnostics",className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold",children:"系統診斷"}),(0,n.jsxs)(a.z,{onClick:ei,children:[(0,n.jsx)(m,{className:"mr-2 h-4 w-4"}),"運行診斷"]})]}),I&&(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,n.jsxs)(r.Zb,{children:[(0,n.jsx)(r.Ol,{children:(0,n.jsx)(r.ll,{children:"網絡連接"})}),(0,n.jsx)(r.aY,{children:(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"API連接:"}),(0,n.jsx)(c.C,{variant:I.network.connected?"default":"destructive",children:I.network.connected?"正常":"異常"})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"延遲:"}),(0,n.jsxs)("span",{children:[I.network.latency,"ms"]})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"WebSocket:"}),(0,n.jsx)(c.C,{variant:I.websocket.connected?"default":"destructive",children:I.websocket.connected?"正常":"異常"})]})]})})]}),(0,n.jsxs)(r.Zb,{children:[(0,n.jsx)(r.Ol,{children:(0,n.jsx)(r.ll,{children:"瀏覽器支持"})}),(0,n.jsx)(r.aY,{children:(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"WebGL 1.0:"}),(0,n.jsx)(c.C,{variant:I.webgl.webgl1?"default":"secondary",children:I.webgl.webgl1?"支持":"不支持"})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"WebGL 2.0:"}),(0,n.jsx)(c.C,{variant:I.webgl.webgl2?"default":"secondary",children:I.webgl.webgl2?"支持":"不支持"})]}),(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("span",{children:"WebRTC:"}),(0,n.jsx)(c.C,{variant:I.webrtc?"default":"secondary",children:I.webrtc?"支持":"不支持"})]})]})})]})]})]})]})}),_&&(0,n.jsx)(P,{onVideoSelected:e=>{try{Q(),eu({title:"視頻已添加",description:"".concat(e.title," 已自動分類到 ").concat(e.category," 並存儲到本地")})}catch(e){eu({title:"處理失敗",description:"無法處理選中的YouTube影片",variant:"destructive"})}},onClose:()=>Y(!1)})]}):(0,n.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:(0,n.jsxs)(r.Zb,{className:"w-full max-w-md",children:[(0,n.jsxs)(r.Ol,{className:"text-center",children:[(0,n.jsx)(r.ll,{className:"text-2xl font-bold text-gray-900",children:"VR視頻管理系統"}),(0,n.jsx)(r.SZ,{children:B?"創建新帳戶":"請登錄或以訪客身份繼續"})]}),(0,n.jsx)(r.aY,{className:"space-y-4",children:B?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("input",{type:"email",placeholder:"郵箱地址",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",id:"register-email"}),(0,n.jsx)("input",{type:"password",placeholder:"密碼（至少6個字符）",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",id:"register-password"}),(0,n.jsx)("input",{type:"password",placeholder:"確認密碼",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",id:"register-confirm-password"})]}),(0,n.jsx)(a.z,{className:"w-full",onClick:()=>{K(document.getElementById("register-email").value,document.getElementById("register-password").value,document.getElementById("register-confirm-password").value)},children:"註冊"}),(0,n.jsx)("div",{className:"text-center",children:(0,n.jsx)(a.z,{variant:"link",className:"text-blue-600 hover:text-blue-800",onClick:()=>H(!1),children:"已有帳戶？點擊登錄"})})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("input",{type:"email",placeholder:"郵箱地址",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",id:"login-email"}),(0,n.jsx)("input",{type:"password",placeholder:"密碼",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",id:"login-password"})]}),(0,n.jsx)(a.z,{className:"w-full",onClick:()=>{G(document.getElementById("login-email").value,document.getElementById("login-password").value)},children:"登錄"}),(0,n.jsx)(a.z,{variant:"outline",className:"w-full bg-transparent",onClick:X,children:"訪客模式"}),(0,n.jsx)("div",{className:"text-center",children:(0,n.jsx)(a.z,{variant:"link",className:"text-blue-600 hover:text-blue-800",onClick:()=>H(!0),children:"沒有帳戶？點擊註冊"})})]})})]})})}},5974:function(e,t,s){"use strict";s.d(t,{C:function(){return l}});var n=s(7437),i=s(535),a=s(4508);let r=(0,i.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:s,...i}=e;return(0,n.jsx)("div",{className:(0,a.cn)(r({variant:s}),t),...i})}},2869:function(e,t,s){"use strict";s.d(t,{z:function(){return o}});var n=s(7437),i=s(2265),a=s(8482),r=s(535),l=s(4508);let c=(0,r.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=i.forwardRef((e,t)=>{let{className:s,variant:i,size:r,asChild:o=!1,...d}=e,u=o?a.g7:"button";return(0,n.jsx)(u,{className:(0,l.cn)(c({variant:i,size:r,className:s})),ref:t,...d})});o.displayName="Button"},6070:function(e,t,s){"use strict";s.d(t,{Ol:function(){return l},SZ:function(){return o},Zb:function(){return r},aY:function(){return d},ll:function(){return c}});var n=s(7437),i=s(2265),a=s(4508);let r=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...i})});r.displayName="Card";let l=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",s),...i})});l.displayName="CardHeader";let c=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,n.jsx)("h3",{ref:t,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",s),...i})});c.displayName="CardTitle";let o=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,n.jsx)("p",{ref:t,className:(0,a.cn)("text-sm text-muted-foreground",s),...i})});o.displayName="CardDescription";let d=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("p-6 pt-0",s),...i})});d.displayName="CardContent",i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,n.jsx)("div",{ref:t,className:(0,a.cn)("flex items-center p-6 pt-0",s),...i})}).displayName="CardFooter"},5186:function(e,t,s){"use strict";s.d(t,{I:function(){return r}});var n=s(7437),i=s(2265),a=s(4508);let r=i.forwardRef((e,t)=>{let{className:s,type:i,...r}=e;return(0,n.jsx)("input",{type:i,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...r})});r.displayName="Input"},2759:function(e,t,s){"use strict";s.d(t,{E:function(){return l}});var n=s(7437),i=s(2265),a=s(1505),r=s(4508);let l=i.forwardRef((e,t)=>{let{className:s,value:i,...l}=e;return(0,n.jsx)(a.fC,{ref:t,className:(0,r.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...l,children:(0,n.jsx)(a.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(i||0),"%)")}})})});l.displayName=a.fC.displayName},2339:function(e,t,s){"use strict";s.d(t,{SP:function(){return o},dr:function(){return c},mQ:function(){return l},nU:function(){return d}});var n=s(7437),i=s(2265),a=s(3278),r=s(4508);let l=a.fC,c=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,n.jsx)(a.aV,{ref:t,className:(0,r.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...i})});c.displayName=a.aV.displayName;let o=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,n.jsx)(a.xz,{ref:t,className:(0,r.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...i})});o.displayName=a.xz.displayName;let d=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,n.jsx)(a.VY,{ref:t,className:(0,r.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...i})});d.displayName=a.VY.displayName},5153:function(e,t,s){"use strict";s.d(t,{Am:function(){return u},pm:function(){return m}});var n=s(2265);let i=0,a=new Map,r=e=>{if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);a.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?r(s):e.toasts.forEach(e=>{r(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},c=[],o={toasts:[]};function d(e){o=l(o,e),c.forEach(e=>{e(o)})}function u(e){let{...t}=e,s=(i=(i+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>d({type:"DISMISS_TOAST",toastId:s});return d({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||n()}}}),{id:s,dismiss:n,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function m(){let[e,t]=n.useState(o);return n.useEffect(()=>(c.push(t),()=>{let e=c.indexOf(t);e>-1&&c.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},4508:function(e,t,s){"use strict";s.d(t,{cn:function(){return a}});var n=s(1994),i=s(3335);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.m6)((0,n.W)(t))}},1085:function(e){!function(){"use strict";var t={864:function(e){var t,s="object"==typeof Reflect?Reflect:null,n=s&&"function"==typeof s.apply?s.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)};t=s&&"function"==typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise(function(s,n){var i;function a(s){e.removeListener(t,r),n(s)}function r(){"function"==typeof e.removeListener&&e.removeListener("error",a),s([].slice.call(arguments))}p(e,t,r,{once:!0}),"error"!==t&&(i={once:!0},"function"==typeof e.on&&p(e,"error",a,i))})},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var r=10;function l(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function o(e,t,s,n){if(l(s),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,s.listener?s.listener:s),a=e._events),r=a[t]),void 0===r)r=a[t]=s,++e._eventsCount;else if("function"==typeof r?r=a[t]=n?[s,r]:[r,s]:n?r.unshift(s):r.push(s),(i=c(e))>0&&r.length>i&&!r.warned){r.warned=!0;var i,a,r,o=Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=t,o.count=r.length,console&&console.warn&&console.warn(o)}return e}function d(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,s){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:s},i=d.bind(n);return i.listener=s,n.wrapFn=i,i}function m(e,t,s){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?s?[i.listener||i]:[i]:s?function(e){for(var t=Array(e.length),s=0;s<t.length;++s)t[s]=e[s].listener||e[s];return t}(i):x(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var s=t[e];if("function"==typeof s)return 1;if(void 0!==s)return s.length}return 0}function x(e,t){for(var s=Array(t),n=0;n<t;++n)s[n]=e[n];return s}function p(e,t,s,n){if("function"==typeof e.on)n.once?e.once(t,s):e.on(t,s);else if("function"==typeof e.addEventListener)e.addEventListener(t,function i(a){n.once&&e.removeEventListener(t,i),s(a)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return r},set:function(e){if("number"!=typeof e||e<0||i(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");r=e}}),a.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var i="error"===e,a=this._events;if(void 0!==a)i=i&&void 0===a.error;else if(!i)return!1;if(i){if(t.length>0&&(r=t[0]),r instanceof Error)throw r;var r,l=Error("Unhandled error."+(r?" ("+r.message+")":""));throw l.context=r,l}var c=a[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else for(var o=c.length,d=x(c,o),s=0;s<o;++s)n(d[s],this,t);return!0},a.prototype.addListener=function(e,t){return o(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return o(this,e,t,!0)},a.prototype.once=function(e,t){return l(t),this.on(e,u(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,u(this,e,t)),this},a.prototype.removeListener=function(e,t){var s,n,i,a,r;if(l(t),void 0===(n=this._events)||void 0===(s=n[e]))return this;if(s===t||s.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,s.listener||t));else if("function"!=typeof s){for(i=-1,a=s.length-1;a>=0;a--)if(s[a]===t||s[a].listener===t){r=s[a].listener,i=a;break}if(i<0)return this;0===i?s.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(s,i),1===s.length&&(n[e]=s[0]),void 0!==n.removeListener&&this.emit("removeListener",e,r||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,s,n;if(void 0===(s=this._events))return this;if(void 0===s.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==s[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete s[e]),this;if(0==arguments.length){var i,a=Object.keys(s);for(n=0;n<a.length;++n)"removeListener"!==(i=a[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=s[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return m(this,e,!0)},a.prototype.rawListeners=function(e){return m(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},a.prototype.listenerCount=h,a.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}},s={};function n(e){var i=s[e];if(void 0!==i)return i.exports;var a=s[e]={exports:{}},r=!0;try{t[e](a,a.exports,n),r=!1}finally{r&&delete s[e]}return a.exports}n.ab="//";var i=n(864);e.exports=i}()}},function(e){e.O(0,[536,16,971,117,744],function(){return e(e.s=9823)}),_N_E=e.O()}]);